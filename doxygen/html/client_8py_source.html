<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Task List Generator Backend: /home/johannesk/code/tests/tlgbe/gp/client.py Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Task List Generator Backend
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('client_8py.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">/home/johannesk/code/tests/tlgbe/gp/client.py</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><pre class="fragment"><a name="l00001"></a><a class="code" href="namespacegp_1_1client.html">00001</a> <span class="stringliteral">&quot;&quot;&quot;Graph Processor Client Library by Daniel Kinzler</span>
<a name="l00002"></a>00002 <span class="stringliteral">Translated from PHP to Python by Philipp Zedler</span>
<a name="l00003"></a>00003 <span class="stringliteral">Copyright (c) 2011 by Wikimedia Deutschland e.V.</span>
<a name="l00004"></a>00004 <span class="stringliteral">All rights reserved.</span>
<a name="l00005"></a>00005 <span class="stringliteral"></span>
<a name="l00006"></a>00006 <span class="stringliteral">Redistribution and use in source and binary forms, with or without</span>
<a name="l00007"></a>00007 <span class="stringliteral">modification, are permitted provided that the following conditions are met:</span>
<a name="l00008"></a>00008 <span class="stringliteral">  * Redistributions of source code must retain the above copyright</span>
<a name="l00009"></a>00009 <span class="stringliteral">    notice, this list of conditions and the following disclaimer.</span>
<a name="l00010"></a>00010 <span class="stringliteral">  * Redistributions in binary form must reproduce the above copyright</span>
<a name="l00011"></a>00011 <span class="stringliteral">    notice, this list of conditions and the following disclaimer in the</span>
<a name="l00012"></a>00012 <span class="stringliteral">    documentation and/or other materials provided with the distribution.</span>
<a name="l00013"></a>00013 <span class="stringliteral">  * Neither the name of Wikimedia Deutschland nor the</span>
<a name="l00014"></a>00014 <span class="stringliteral">    names of its contributors may be used to endorse or promote products</span>
<a name="l00015"></a>00015 <span class="stringliteral">    derived from this software without specific prior written permission.</span>
<a name="l00016"></a>00016 <span class="stringliteral"></span>
<a name="l00017"></a>00017 <span class="stringliteral">THIS SOFTWARE IS PROVIDED BY WIKIMEDIA DEUTSCHLAND &#39;&#39;AS IS&#39;&#39; AND ANY</span>
<a name="l00018"></a>00018 <span class="stringliteral">EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED</span>
<a name="l00019"></a>00019 <span class="stringliteral">WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE</span>
<a name="l00020"></a>00020 <span class="stringliteral">DISCLAIMED. IN NO EVENT SHALL WIKIMEDIA DEUTSCHLAND BE LIABLE FOR ANY</span>
<a name="l00021"></a>00021 <span class="stringliteral">DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES</span>
<a name="l00022"></a>00022 <span class="stringliteral">(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;</span>
<a name="l00023"></a>00023 <span class="stringliteral">LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND</span>
<a name="l00024"></a>00024 <span class="stringliteral">ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span>
<a name="l00025"></a>00025 <span class="stringliteral">(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS</span>
<a name="l00026"></a>00026 <span class="stringliteral">SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00027"></a>00027 <span class="stringliteral"></span>
<a name="l00028"></a>00028 <span class="stringliteral"></span>
<a name="l00029"></a>00029 <span class="stringliteral">NOTE: This software is not released as a product. It was written primarily for</span>
<a name="l00030"></a>00030 <span class="stringliteral">Wikimedia Deutschland&#39;s own use, and is made public as is, in the hope it may</span>
<a name="l00031"></a>00031 <span class="stringliteral">be useful. Wikimedia Deutschland may at any time discontinue developing or</span>
<a name="l00032"></a>00032 <span class="stringliteral">supporting this software. There is no guarantee any new versions or even fixes</span>
<a name="l00033"></a>00033 <span class="stringliteral">for security issues will be released.</span>
<a name="l00034"></a>00034 <span class="stringliteral"></span>
<a name="l00035"></a>00035 <span class="stringliteral">This version of the Graph Processor Client Library</span>
<a name="l00036"></a>00036 <span class="stringliteral">is a Python interface to a GraphServ or GraphCore instance. </span>
<a name="l00037"></a>00037 <span class="stringliteral"></span>
<a name="l00038"></a>00038 <span class="stringliteral">@author    Daniel Kinzler &lt;daniel.kinzler@wikimedia.de&gt;</span>
<a name="l00039"></a>00039 <span class="stringliteral">@author    Philipp Zedler &lt;zedler@itp.tu-berlin.de&gt; (translation)</span>
<a name="l00040"></a>00040 <span class="stringliteral">@copyright 2011, Wikimedia Deutschland</span>
<a name="l00041"></a>00041 <span class="stringliteral"></span>
<a name="l00042"></a>00042 <span class="stringliteral">@package   WikiTalk #? Stimmt das?</span>
<a name="l00043"></a>00043 <span class="stringliteral"></span>
<a name="l00044"></a>00044 <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00045"></a>00045 
<a name="l00046"></a>00046 <span class="keyword">import</span> re
<a name="l00047"></a>00047 <span class="keyword">import</span> os
<a name="l00048"></a>00048 <span class="keyword">import</span> socket
<a name="l00049"></a>00049 <span class="keyword">import</span> time
<a name="l00050"></a>00050 <span class="keyword">import</span> subprocess
<a name="l00051"></a>00051 <span class="keyword">import</span> inspect
<a name="l00052"></a>00052 <span class="keyword">import</span> types
<a name="l00053"></a>00053 
<a name="l00054"></a>00054 LINEBREAK = <span class="stringliteral">&quot;\r\n&quot;</span>
<a name="l00055"></a>00055 <span class="stringliteral">&quot;&quot;&quot;Linebreak to use when talking to GraphServ or GraphCore instances.</span>
<a name="l00056"></a>00056 <span class="stringliteral">   This is \\r\\n per spec. but \\n alone should also work.&quot;&quot;&quot;</span>
<a name="l00057"></a>00057 
<a name="l00058"></a>00058 PORT = 6666
<a name="l00059"></a>00059 <span class="stringliteral">&quot;&quot;&quot;Default GraphServ port&quot;&quot;&quot;</span>
<a name="l00060"></a>00060 
<a name="l00061"></a>00061 CLIENT_PROTOCOL_VERSION = 4
<a name="l00062"></a>00062 <span class="stringliteral">&quot;&quot;&quot;Implemented GraphServ protocol version. May be used to determin which</span>
<a name="l00063"></a>00063 <span class="stringliteral">   features are supported. Is not used to validate the peer&#39;s protocol version,</span>
<a name="l00064"></a>00064 <span class="stringliteral">   see MIN_PROTOCOL_VERSION and MAX_PROTOCOL_VERSION for that.&quot;&quot;&quot;</span>
<a name="l00065"></a>00065 
<a name="l00066"></a>00066 MIN_PROTOCOL_VERSION = 2.0
<a name="l00067"></a>00067 <span class="stringliteral">&quot;&quot;&quot;Minimum GraphServ protocol version. If GraphServ (resp. GraphCore)</span>
<a name="l00068"></a>00068 <span class="stringliteral">   reports a lower protocol version, the connection will be aborted.&quot;&quot;&quot;</span>
<a name="l00069"></a>00069 
<a name="l00070"></a>00070 MAX_PROTOCOL_VERSION = 4.99
<a name="l00071"></a>00071 <span class="stringliteral">&quot;&quot;&quot;Maximum GraphServ protocol version. If GraphServ (resp. GraphCore)</span>
<a name="l00072"></a>00072 <span class="stringliteral">   reports a higher protocol version, the connection will be aborted.&quot;&quot;&quot;</span>
<a name="l00073"></a>00073 
<a name="l00074"></a>00074 
<a name="l00075"></a>00075 <span class="keyword">def </span>__function__ (shift = 1): <span class="comment">#XXX: wtf?</span>
<a name="l00076"></a>00076     caller = inspect.stack()[shift]
<a name="l00077"></a>00077     <span class="keywordflow">return</span> caller[3]
<a name="l00078"></a>00078 
<a name="l00079"></a><a class="code" href="classgp_1_1client_1_1gp_exception.html">00079</a> <span class="keyword">class </span><a class="code" href="classgp_1_1client_1_1gp_exception.html">gpException</a>(Exception):
<a name="l00080"></a>00080     <span class="stringliteral">&quot;&quot;&quot;Base class for exceptions in this module.&quot;&quot;&quot;</span>
<a name="l00081"></a><a class="code" href="classgp_1_1client_1_1gp_exception.html#aa33d31fd30b83d6b70a38c067a36fd7e">00081</a>     <span class="keyword">def </span><a class="code" href="classgp_1_1client_1_1gp_exception.html#aa33d31fd30b83d6b70a38c067a36fd7e">__init__</a>(self, msg):
<a name="l00082"></a>00082         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00083"></a>00083 <span class="stringliteral">        @param msg: the message to be displayed in case of an exception</span>
<a name="l00084"></a>00084 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l00085"></a>00085         self.<a class="code" href="classgp_1_1client_1_1gp_exception.html#a690a16dfefdae4930cd8d0a17dad33bd">msg</a> = msg
<a name="l00086"></a>00086 
<a name="l00087"></a><a class="code" href="classgp_1_1client_1_1gp_exception.html#ad717e060446d453c2241c2e337a049de">00087</a>     <span class="keyword">def </span><a class="code" href="classgp_1_1client_1_1gp_exception.html#ad717e060446d453c2241c2e337a049de">__str__</a>(self):
<a name="l00088"></a>00088         <span class="stringliteral">&quot;&quot;&quot;Show type and name in the error message.&quot;&quot;&quot;</span>
<a name="l00089"></a>00089         <span class="keywordflow">return</span> type(self).__name__ + <span class="stringliteral">&quot;: &quot;</span> + self.<a class="code" href="classgp_1_1client_1_1gp_exception.html#a690a16dfefdae4930cd8d0a17dad33bd">msg</a>
<a name="l00090"></a>00090 
<a name="l00091"></a><a class="code" href="classgp_1_1client_1_1gp_exception.html#a25863adf999e0561ef09ad6e64ff3fdd">00091</a>     <span class="keyword">def </span><a class="code" href="classgp_1_1client_1_1gp_exception.html#a25863adf999e0561ef09ad6e64ff3fdd">getMessage</a>(self):
<a name="l00092"></a>00092         <span class="stringliteral">&quot;&quot;&quot;Returns the error message.&quot;&quot;&quot;</span>
<a name="l00093"></a>00093         <span class="keywordflow">return</span> self.<a class="code" href="classgp_1_1client_1_1gp_exception.html#a690a16dfefdae4930cd8d0a17dad33bd">msg</a>
<a name="l00094"></a>00094 
<a name="l00095"></a>00095 
<a name="l00096"></a><a class="code" href="classgp_1_1client_1_1gp_processor_exception.html">00096</a> <span class="keyword">class </span><a class="code" href="classgp_1_1client_1_1gp_processor_exception.html">gpProcessorException</a>(<a class="code" href="classgp_1_1client_1_1gp_exception.html">gpException</a>):
<a name="l00097"></a>00097     <span class="stringliteral">&quot;&quot;&quot;Exceptions for errors reported by the remote grap database&quot;&quot;&quot;</span>
<a name="l00098"></a>00098     <span class="keyword">def </span>__init__(self, status, msg, command=False ):
<a name="l00099"></a>00099         <span class="keywordflow">if</span> command:
<a name="l00100"></a>00100             msg = msg + <span class="stringliteral">&quot; Command was %s&quot;</span> % command
<a name="l00101"></a>00101         gpException.__init__(self, msg)
<a name="l00102"></a>00102         self.<a class="code" href="classgp_1_1client_1_1gp_processor_exception.html#a10b7272df50c77d21fa04c547fa40ffc">command</a> = command
<a name="l00103"></a>00103         self.<a class="code" href="classgp_1_1client_1_1gp_processor_exception.html#a06dedd755c0d5772401251d992b99ca7">status</a> = status
<a name="l00104"></a>00104         <span class="comment">#? self.status wird nirgendwo ausgegeben.</span>
<a name="l00105"></a>00105 
<a name="l00106"></a>00106 
<a name="l00107"></a><a class="code" href="classgp_1_1client_1_1gp_protocol_exception.html">00107</a> <span class="keyword">class </span><a class="code" href="classgp_1_1client_1_1gp_protocol_exception.html">gpProtocolException</a>(<a class="code" href="classgp_1_1client_1_1gp_exception.html">gpException</a>):
<a name="l00108"></a>00108     <span class="stringliteral">&quot;&quot;&quot;Exception for the communication with the remote graph database.&quot;&quot;&quot;</span>
<a name="l00109"></a>00109     <span class="keywordflow">pass</span>
<a name="l00110"></a>00110 
<a name="l00111"></a>00111 
<a name="l00112"></a><a class="code" href="classgp_1_1client_1_1gp_client_exception.html">00112</a> <span class="keyword">class </span>gpClientException( gpException ):
<a name="l00113"></a>00113     <span class="stringliteral">&quot;&quot;&quot;Exception when gpClient encounters a problem on the client side.&quot;&quot;&quot;</span>
<a name="l00114"></a>00114     <span class="keywordflow">pass</span>
<a name="l00115"></a>00115 
<a name="l00116"></a>00116 
<a name="l00117"></a><a class="code" href="classgp_1_1client_1_1gp_usage_exception.html">00117</a> <span class="keyword">class </span><a class="code" href="classgp_1_1client_1_1gp_usage_exception.html">gpUsageException</a>( <a class="code" href="classgp_1_1client_1_1gp_client_exception.html">gpClientException</a> ):
<a name="l00118"></a>00118     <span class="stringliteral">&quot;&quot;&quot;Exception raised when gpClient is used incorrectly.&quot;&quot;&quot;</span>
<a name="l00119"></a>00119     <span class="keywordflow">pass</span>
<a name="l00120"></a>00120 
<a name="l00121"></a>00121 
<a name="l00122"></a>00122 
<a name="l00123"></a>00123 
<a name="l00124"></a>00124 
<a name="l00125"></a><a class="code" href="classgp_1_1client_1_1_data_source.html">00125</a> <span class="keyword">class </span><a class="code" href="classgp_1_1client_1_1_data_source.html">DataSource</a> (object):
<a name="l00126"></a>00126     <span class="stringliteral">&quot;&quot;&quot;Represents an interator of rows in a tabular data set.</span>
<a name="l00127"></a>00127 <span class="stringliteral"></span>
<a name="l00128"></a>00128 <span class="stringliteral">    Data sources are used in the gpClient framework to represent origin of</span>
<a name="l00129"></a>00129 <span class="stringliteral">    a data transfer. Typically, a data source is used to provide data to a</span>
<a name="l00130"></a>00130 <span class="stringliteral">    GraphCore command, such as add_arcs. Derived classes must implement the</span>
<a name="l00131"></a>00131 <span class="stringliteral">    next() method, which returns one row of data after another.</span>
<a name="l00132"></a>00132 <span class="stringliteral"></span>
<a name="l00133"></a>00133 <span class="stringliteral">    &quot;&quot;&quot;</span>
<a name="l00134"></a><a class="code" href="classgp_1_1client_1_1_data_source.html#a572de422bf0aec90cf5cca6e23968796">00134</a>     <span class="keyword">def </span><a class="code" href="classgp_1_1client_1_1_data_source.html#a572de422bf0aec90cf5cca6e23968796">__iter__</a>(self):
<a name="l00135"></a>00135         <span class="stringliteral">&quot;&quot;&quot;Return the iterator object. Required for the iterator protocol.&quot;&quot;&quot;</span>
<a name="l00136"></a>00136         <span class="keywordflow">return</span> self
<a name="l00137"></a>00137 
<a name="l00138"></a><a class="code" href="classgp_1_1client_1_1_data_source.html#acae72204aea728905d96742da8a5ff78">00138</a>     <span class="keyword">def </span><a class="code" href="classgp_1_1client_1_1_data_source.html#acae72204aea728905d96742da8a5ff78">next</a>( self ):
<a name="l00139"></a>00139         <span class="stringliteral">&quot;&quot;&quot;Returns the next row.</span>
<a name="l00140"></a>00140 <span class="stringliteral"></span>
<a name="l00141"></a>00141 <span class="stringliteral">        The row is represented as an indexed array. Successive calls on the</span>
<a name="l00142"></a>00142 <span class="stringliteral">        same data source should return rows of the same size, with the same</span>
<a name="l00143"></a>00143 <span class="stringliteral">        array keys.</span>
<a name="l00144"></a>00144 <span class="stringliteral">        @return an array representing the next row.</span>
<a name="l00145"></a>00145 <span class="stringliteral">    </span>
<a name="l00146"></a>00146 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l00147"></a>00147         <span class="keywordflow">raise</span> NotImplementedError( <span class="stringliteral">&quot;`next()&#39; not implemented by %s&quot;</span> % self.__class__ )
<a name="l00148"></a>00148     
<a name="l00149"></a><a class="code" href="classgp_1_1client_1_1_data_source.html#a3b389a277d818029f04f675230e41b0c">00149</a>     <span class="keyword">def </span><a class="code" href="classgp_1_1client_1_1_data_source.html#a3b389a277d818029f04f675230e41b0c">close</a>( self ):
<a name="l00150"></a>00150         <span class="stringliteral">&quot;&quot;&quot; Close the data source and free resources allocated by this object.</span>
<a name="l00151"></a>00151 <span class="stringliteral"></span>
<a name="l00152"></a>00152 <span class="stringliteral">        close() should always be called when a data source is no longer</span>
<a name="l00153"></a>00153 <span class="stringliteral">        needed, usually on the same level as the data source object was</span>
<a name="l00154"></a>00154 <span class="stringliteral">        created. After close() has been called on a data source object,</span>
<a name="l00155"></a>00155 <span class="stringliteral">        the behavior of calling next() on that object is undefined.</span>
<a name="l00156"></a>00156 <span class="stringliteral">    </span>
<a name="l00157"></a>00157 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l00158"></a>00158         <span class="keywordflow">pass</span>    <span class="comment"># noop</span>
<a name="l00159"></a>00159         
<a name="l00160"></a><a class="code" href="classgp_1_1client_1_1_data_source.html#aa4927c82539e9406d2d2ce457bec8525">00160</a>     <span class="keyword">def </span><a class="code" href="classgp_1_1client_1_1_data_source.html#aa4927c82539e9406d2d2ce457bec8525">drain</a>( self ): <span class="comment">#TODO: PORT TO PHP</span>
<a name="l00161"></a>00161         <span class="stringliteral">&quot;&quot;&quot; Drains the source and returns all data rows as an array.</span>
<a name="l00162"></a>00162 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l00163"></a>00163         
<a name="l00164"></a>00164         data = []
<a name="l00165"></a>00165         
<a name="l00166"></a>00166         <span class="keywordflow">for</span> r <span class="keywordflow">in</span> self:
<a name="l00167"></a>00167             data.append(r)
<a name="l00168"></a>00168             
<a name="l00169"></a>00169         self.<a class="code" href="classgp_1_1client_1_1_data_source.html#a3b389a277d818029f04f675230e41b0c">close</a>()
<a name="l00170"></a>00170         <span class="keywordflow">return</span> data
<a name="l00171"></a>00171 
<a name="l00172"></a>00172 
<a name="l00173"></a><a class="code" href="classgp_1_1client_1_1_null_source.html">00173</a> <span class="keyword">class </span><a class="code" href="classgp_1_1client_1_1_null_source.html">NullSource</a>( <a class="code" href="classgp_1_1client_1_1_data_source.html">DataSource</a> ):
<a name="l00174"></a>00174     <span class="stringliteral">&quot;&quot;&quot;An empty data source.&quot;&quot;&quot;</span>
<a name="l00175"></a>00175     
<a name="l00176"></a><a class="code" href="classgp_1_1client_1_1_null_source.html#ad5b65d471fd289949b5105f7435c82d5">00176</a>     <span class="keyword">def </span><a class="code" href="classgp_1_1client_1_1_null_source.html#ad5b65d471fd289949b5105f7435c82d5">next</a>( self ):
<a name="l00177"></a>00177         <span class="stringliteral">&quot;&quot;&quot;Stop the iteration.&quot;&quot;&quot;</span>
<a name="l00178"></a>00178         <span class="keywordflow">raise</span> StopIteration()
<a name="l00179"></a>00179     
<a name="l00180"></a>00180     instance = <span class="keywordtype">None</span>
<a name="l00181"></a>00181     <span class="stringliteral">&quot;&quot;&quot;kind of singleton instance of NullSource&quot;&quot;&quot;</span>
<a name="l00182"></a>00182 
<a name="l00183"></a>00183 NullSource.instance = <a class="code" href="classgp_1_1client_1_1_null_source.html">NullSource</a>()
<a name="l00184"></a>00184 <span class="stringliteral">&quot;&quot;&quot;A global variable of the module containing a NullSource instance.</span>
<a name="l00185"></a>00185 <span class="stringliteral"></span>
<a name="l00186"></a>00186 <span class="stringliteral">It hould be used in order to avoid the costs of crating new instaces</span>
<a name="l00187"></a>00187 <span class="stringliteral">which are not necessary for this class.</span>
<a name="l00188"></a>00188 <span class="stringliteral"></span>
<a name="l00189"></a>00189 <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00190"></a>00190 
<a name="l00191"></a>00191 
<a name="l00192"></a><a class="code" href="classgp_1_1client_1_1_array_source.html">00192</a> <span class="keyword">class </span><a class="code" href="classgp_1_1client_1_1_array_source.html">ArraySource</a>( <a class="code" href="classgp_1_1client_1_1_data_source.html">DataSource</a> ):
<a name="l00193"></a>00193     <span class="stringliteral">&quot;&quot;&quot;A data source that iterates over an array.</span>
<a name="l00194"></a>00194 <span class="stringliteral"></span>
<a name="l00195"></a>00195 <span class="stringliteral">    This is useful to use programmatically generated data as the input</span>
<a name="l00196"></a>00196 <span class="stringliteral">    to some GraphCore command.</span>
<a name="l00197"></a>00197 <span class="stringliteral"></span>
<a name="l00198"></a>00198 <span class="stringliteral">    The ArraySource maintains a current index pointing into the data</span>
<a name="l00199"></a>00199 <span class="stringliteral">    array. Every call to next() increments that index to the next row.</span>
<a name="l00200"></a>00200 <span class="stringliteral"></span>
<a name="l00201"></a>00201 <span class="stringliteral">    &quot;&quot;&quot;</span>
<a name="l00202"></a>00202 
<a name="l00203"></a><a class="code" href="classgp_1_1client_1_1_array_source.html#a496729aaffda29b0da973431fd3f9041">00203</a>     <span class="keyword">def </span><a class="code" href="classgp_1_1client_1_1_array_source.html#a496729aaffda29b0da973431fd3f9041">__init__</a>( self, data ):  
<a name="l00204"></a>00204         <span class="stringliteral">&quot;&quot;&quot; Initializes a ArraySource from the table contained in data.</span>
<a name="l00205"></a>00205 <span class="stringliteral">   </span>
<a name="l00206"></a>00206 <span class="stringliteral">        @param data: a list of lists or tuples, each representing a</span>
<a name="l00207"></a>00207 <span class="stringliteral">               row in the data source. If the list contains integers</span>
<a name="l00208"></a>00208 <span class="stringliteral">               or strings, they are wrapped and returned as one-tuples.</span>
<a name="l00209"></a>00209 <span class="stringliteral"></span>
<a name="l00210"></a>00210 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l00211"></a>00211         self.<a class="code" href="classgp_1_1client_1_1_array_source.html#ac2dc8fddf3cfcd8d9d67ec2ce7c70a42">data</a> = data
<a name="l00212"></a>00212         self.<a class="code" href="classgp_1_1client_1_1_array_source.html#acaaeaed89e5e0ef267eba891ce152f2a">data_length</a> = len(data)
<a name="l00213"></a>00213         self.<a class="code" href="classgp_1_1client_1_1_array_source.html#a80575c75b0abe7ecf17b384c48e5fad3">index</a> = 0
<a name="l00214"></a>00214          
<a name="l00215"></a><a class="code" href="classgp_1_1client_1_1_array_source.html#ac989fd20a71798bec60023aa5ab9a3e3">00215</a>     <span class="keyword">def </span><a class="code" href="classgp_1_1client_1_1_array_source.html#ac989fd20a71798bec60023aa5ab9a3e3">next</a>( self ):
<a name="l00216"></a>00216         <span class="stringliteral">&quot;&quot;&quot;Return the next row of the list provided to the constructor.&quot;&quot;&quot;</span>
<a name="l00217"></a>00217         <span class="keywordflow">if</span> self.<a class="code" href="classgp_1_1client_1_1_array_source.html#a80575c75b0abe7ecf17b384c48e5fad3">index</a> &lt; self.<a class="code" href="classgp_1_1client_1_1_array_source.html#acaaeaed89e5e0ef267eba891ce152f2a">data_length</a>:
<a name="l00218"></a>00218             row = self.<a class="code" href="classgp_1_1client_1_1_array_source.html#ac2dc8fddf3cfcd8d9d67ec2ce7c70a42">data</a>[self.<a class="code" href="classgp_1_1client_1_1_array_source.html#a80575c75b0abe7ecf17b384c48e5fad3">index</a>]
<a name="l00219"></a>00219             self.<a class="code" href="classgp_1_1client_1_1_array_source.html#a80575c75b0abe7ecf17b384c48e5fad3">index</a> = self.<a class="code" href="classgp_1_1client_1_1_array_source.html#a80575c75b0abe7ecf17b384c48e5fad3">index</a> + 1
<a name="l00220"></a>00220             
<a name="l00221"></a>00221             <span class="keywordflow">if</span> <span class="keywordflow">not</span> isinstance(row, (list,tuple)):
<a name="l00222"></a>00222                 <span class="keywordflow">if</span> <span class="keywordflow">not</span> isinstance(row, (str, unicode, int, long)):
<a name="l00223"></a>00223                     <span class="keywordflow">raise</span> <a class="code" href="classgp_1_1client_1_1gp_usage_exception.html">gpUsageException</a>(<span class="stringliteral">&quot;data must consist of strings or integers&quot;</span>)
<a name="l00224"></a>00224                     
<a name="l00225"></a>00225                 row = (row, )
<a name="l00226"></a>00226             <span class="keywordflow">return</span> row
<a name="l00227"></a>00227         <span class="keywordflow">else</span>:
<a name="l00228"></a>00228             <span class="keywordflow">raise</span> StopIteration()
<a name="l00229"></a>00229  
<a name="l00230"></a><a class="code" href="classgp_1_1client_1_1_array_source.html#a3187cfa92f82d98aecf56bb8fc32b662">00230</a>     <span class="keyword">def </span><a class="code" href="classgp_1_1client_1_1_array_source.html#a3187cfa92f82d98aecf56bb8fc32b662">makeSink</a>(self):
<a name="l00231"></a>00231         <span class="stringliteral">&quot;&quot;&quot;Returns a new instance of ArraySink.</span>
<a name="l00232"></a>00232 <span class="stringliteral"></span>
<a name="l00233"></a>00233 <span class="stringliteral">        The sink can be used to write to and to fill the data list of</span>
<a name="l00234"></a>00234 <span class="stringliteral">        this ArraySource.</span>
<a name="l00235"></a>00235 <span class="stringliteral">   </span>
<a name="l00236"></a>00236 <span class="stringliteral">        &quot;&quot;&quot;</span> 
<a name="l00237"></a>00237         <span class="keywordflow">return</span> <a class="code" href="classgp_1_1client_1_1_array_sink.html">ArraySink</a>(self.<a class="code" href="classgp_1_1client_1_1_array_source.html#ac2dc8fddf3cfcd8d9d67ec2ce7c70a42">data</a>)
<a name="l00238"></a>00238      
<a name="l00239"></a>00239 
<a name="l00240"></a><a class="code" href="classgp_1_1client_1_1_limited_source.html">00240</a> <span class="keyword">class </span><a class="code" href="classgp_1_1client_1_1_limited_source.html">LimitedSource</a>( <a class="code" href="classgp_1_1client_1_1_data_source.html">DataSource</a> ): <span class="comment">#TODO: PORT to PHP</span>
<a name="l00241"></a>00241     <span class="stringliteral">&quot;&quot;&quot;A data source that wraps another data source to limit the number</span>
<a name="l00242"></a>00242 <span class="stringliteral">    of rows returned from it.</span>
<a name="l00243"></a>00243 <span class="stringliteral"></span>
<a name="l00244"></a>00244 <span class="stringliteral">    This is useful to limit the number of arcs transmitted graphserv in</span>
<a name="l00245"></a>00245 <span class="stringliteral">    a single command.</span>
<a name="l00246"></a>00246 <span class="stringliteral">    &quot;&quot;&quot;</span>
<a name="l00247"></a>00247 
<a name="l00248"></a><a class="code" href="namespacegp_1_1client.html#a327675923b97516d9d072c0c423f06b5">00248</a>     <span class="keyword">def </span><a class="code" href="namespacegp_1_1client.html#a327675923b97516d9d072c0c423f06b5">__init__</a>( self, src, limit ):  
<a name="l00249"></a>00249         <span class="stringliteral">&quot;&quot;&quot; Initializes a LimitedSource using the given original data source.</span>
<a name="l00250"></a>00250 <span class="stringliteral">   </span>
<a name="l00251"></a>00251 <span class="stringliteral">        @param src: a DataSource object</span>
<a name="l00252"></a>00252 <span class="stringliteral">        @param limit: the number of rows to return.</span>
<a name="l00253"></a>00253 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l00254"></a>00254         
<a name="l00255"></a>00255         self.source = src
<a name="l00256"></a>00256         self.limit = limit
<a name="l00257"></a>00257         self.index = 0
<a name="l00258"></a>00258          
<a name="l00259"></a><a class="code" href="namespacegp_1_1client.html#a0dadab112fc7727734c7c2a73a2eb12a">00259</a>     <span class="keyword">def </span><a class="code" href="namespacegp_1_1client.html#a0dadab112fc7727734c7c2a73a2eb12a">next</a>( self ):
<a name="l00260"></a>00260 
<a name="l00261"></a>00261         <span class="stringliteral">&quot;&quot;&quot;Return the next row of the DataSource provided to the constructor.&quot;&quot;&quot;</span>
<a name="l00262"></a>00262         
<a name="l00263"></a>00263         <span class="keywordflow">if</span> self.index &lt; self.limit:
<a name="l00264"></a>00264             row = self.source.next()
<a name="l00265"></a>00265             self.index = self.index + 1
<a name="l00266"></a>00266             
<a name="l00267"></a>00267             <span class="keywordflow">return</span> row
<a name="l00268"></a>00268         <span class="keywordflow">else</span>:
<a name="l00269"></a>00269             <span class="keywordflow">raise</span> StopIteration()
<a name="l00270"></a>00270             
<a name="l00271"></a><a class="code" href="namespacegp_1_1client.html#a97c78748bcca8dabe6a3052eca2a82b0">00271</a>     <span class="keyword">def </span><a class="code" href="namespacegp_1_1client.html#a97c78748bcca8dabe6a3052eca2a82b0">limit_reached</a>( self ):
<a name="l00272"></a>00272         <span class="stringliteral">&quot;&quot;&quot; returns True if next() has already been called sucessfully as many times</span>
<a name="l00273"></a>00273 <span class="stringliteral">            as allowed by the limit parameter passed to the constructor. After</span>
<a name="l00274"></a>00274 <span class="stringliteral">            iterating over this LimitedSource instance (i.e. after StopIteration()</span>
<a name="l00275"></a>00275 <span class="stringliteral">            has been thrown by next()), this method may be used to determine</span>
<a name="l00276"></a>00276 <span class="stringliteral">            whether there may be more data in the original data source. If </span>
<a name="l00277"></a>00277 <span class="stringliteral">            iteration was terminated but limit_reached() returns false, then the</span>
<a name="l00278"></a>00278 <span class="stringliteral">            original source was depleted and there is no more data available from it.</span>
<a name="l00279"></a>00279 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l00280"></a>00280         
<a name="l00281"></a>00281         <span class="keywordflow">return</span> ( self.index &gt;= self.limit )
<a name="l00282"></a>00282  
<a name="l00283"></a><a class="code" href="classgp_1_1client_1_1_pipe_source.html">00283</a> <span class="keyword">class </span><a class="code" href="classgp_1_1client_1_1_pipe_source.html">PipeSource</a>( <a class="code" href="classgp_1_1client_1_1_data_source.html">DataSource</a> ):
<a name="l00284"></a>00284     <span class="stringliteral">&quot;&quot;&quot;Data source based on a file handle.</span>
<a name="l00285"></a>00285 <span class="stringliteral"></span>
<a name="l00286"></a>00286 <span class="stringliteral">    Each line read from the file handle is interpreted as (and converted</span>
<a name="l00287"></a>00287 <span class="stringliteral">    to) a data row.</span>
<a name="l00288"></a>00288 <span class="stringliteral">    Note: calling close() on a PipeSource does *not* close the</span>
<a name="l00289"></a>00289 <span class="stringliteral">    underlying file handle. The idea is that the handle should be closed</span>
<a name="l00290"></a>00290 <span class="stringliteral">    by the same code that also opened the file.</span>
<a name="l00291"></a>00291 <span class="stringliteral"></span>
<a name="l00292"></a>00292 <span class="stringliteral">    &quot;&quot;&quot;</span>
<a name="l00293"></a><a class="code" href="classgp_1_1client_1_1_pipe_source.html#a053d36f5d7972b1b3384b0f9416e22ef">00293</a>     <span class="keyword">def </span><a class="code" href="classgp_1_1client_1_1_pipe_source.html#a053d36f5d7972b1b3384b0f9416e22ef">__init__</a>( self, hin ):
<a name="l00294"></a>00294         <span class="stringliteral">&quot;&quot;&quot;Initializes a new PipeSource</span>
<a name="l00295"></a>00295 <span class="stringliteral">    </span>
<a name="l00296"></a>00296 <span class="stringliteral">        @param resource hin a handle of an open file that allows read</span>
<a name="l00297"></a>00297 <span class="stringliteral">        access, as returned by file() or ... #? translate fsockopen()!</span>
<a name="l00298"></a>00298 <span class="stringliteral">    </span>
<a name="l00299"></a>00299 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l00300"></a>00300         self.<a class="code" href="classgp_1_1client_1_1_pipe_source.html#aae092d0af0ae10e8a54203e1dadec507">hin</a> = hin
<a name="l00301"></a>00301         
<a name="l00302"></a><a class="code" href="classgp_1_1client_1_1_pipe_source.html#ab34aee2aa5cca302ce852575fe968e6e">00302</a>     <span class="keyword">def </span><a class="code" href="classgp_1_1client_1_1_pipe_source.html#ab34aee2aa5cca302ce852575fe968e6e">next</a>(self):
<a name="l00303"></a>00303         <span class="stringliteral">&quot;&quot;&quot;Returns the next line from the file handle (using readline).</span>
<a name="l00304"></a>00304 <span class="stringliteral"></span>
<a name="l00305"></a>00305 <span class="stringliteral">        The line is split using Connection.splitRow() and the result is</span>
<a name="l00306"></a>00306 <span class="stringliteral">        returned as the next row.</span>
<a name="l00307"></a>00307 <span class="stringliteral">   </span>
<a name="l00308"></a>00308 <span class="stringliteral">        @return array the next data row, extracted from the next line</span>
<a name="l00309"></a>00309 <span class="stringliteral">                read from the file handle.</span>
<a name="l00310"></a>00310 <span class="stringliteral">   </span>
<a name="l00311"></a>00311 <span class="stringliteral">        &quot;&quot;&quot;</span> 
<a name="l00312"></a>00312         s = self.hin.readline()
<a name="l00313"></a>00313         s = s.strip()
<a name="l00314"></a>00314         <span class="keywordflow">if</span> s:
<a name="l00315"></a>00315             row = Connection.splitRow( s )
<a name="l00316"></a>00316             <span class="keywordflow">return</span> row
<a name="l00317"></a>00317         <span class="keywordflow">else</span>:
<a name="l00318"></a>00318             <span class="keywordflow">raise</span> StopIteration()
<a name="l00319"></a>00319 
<a name="l00320"></a>00320 
<a name="l00321"></a><a class="code" href="classgp_1_1client_1_1_file_source.html">00321</a> <span class="keyword">class </span><a class="code" href="classgp_1_1client_1_1_file_source.html">FileSource</a>( <a class="code" href="classgp_1_1client_1_1_pipe_source.html">PipeSource</a> ):
<a name="l00322"></a>00322     <span class="stringliteral">&quot;&quot;&quot;Data source based on reading from a file.</span>
<a name="l00323"></a>00323 <span class="stringliteral"></span>
<a name="l00324"></a>00324 <span class="stringliteral">    Extends PipeSource to handle an actual local file.</span>
<a name="l00325"></a>00325 <span class="stringliteral"> </span>
<a name="l00326"></a>00326 <span class="stringliteral">    Note: calling close() on a FileSource *does* close the</span>
<a name="l00327"></a>00327 <span class="stringliteral">    underlying file handle. The idea is that the handle should be closed</span>
<a name="l00328"></a>00328 <span class="stringliteral">    by the same code that also opened the file.</span>
<a name="l00329"></a>00329 <span class="stringliteral"></span>
<a name="l00330"></a>00330 <span class="stringliteral">    &quot;&quot;&quot;</span>    
<a name="l00331"></a><a class="code" href="classgp_1_1client_1_1_file_source.html#a8956ad295e185ba656061ffe5786c6d6">00331</a>     <span class="keyword">def </span><a class="code" href="classgp_1_1client_1_1_file_source.html#a8956ad295e185ba656061ffe5786c6d6">__init__</a>(self, path, mode=&#39;r&#39;):
<a name="l00332"></a>00332         <span class="stringliteral">&quot;&quot;&quot;Creates a data source for reading from the given file.</span>
<a name="l00333"></a>00333 <span class="stringliteral"></span>
<a name="l00334"></a>00334 <span class="stringliteral">        The file is opened using file(path, mode).</span>
<a name="l00335"></a>00335 <span class="stringliteral">    </span>
<a name="l00336"></a>00336 <span class="stringliteral">        @param string path the path of the file to read from</span>
<a name="l00337"></a>00337 <span class="stringliteral">        @param string mode (default: &#39;</span><span class="stringliteral">r&#39;) the mode with which the file</span>
<a name="l00338"></a>00338 <span class="stringliteral">               should be opened.</span>
<a name="l00339"></a>00339 <span class="stringliteral">        @throws gpClientException </span><span class="keywordflow">if</span> file() failed to open the file
<a name="l00340"></a>00340                 given by path.
<a name="l00341"></a>00341     
<a name="l00342"></a>00342         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00343"></a>00343 <span class="stringliteral">        self.mode = mode</span>
<a name="l00344"></a>00344 <span class="stringliteral">        self.path = path</span>
<a name="l00345"></a>00345 <span class="stringliteral">        </span>
<a name="l00346"></a>00346 <span class="stringliteral">        try:</span>
<a name="l00347"></a>00347 <span class="stringliteral">            handle = file( self.path, self.mode )</span>
<a name="l00348"></a>00348 <span class="stringliteral">        except IOError:</span>
<a name="l00349"></a>00349 <span class="stringliteral">            raise gpClientException( &quot;failed to open &quot; + self.path )</span>
<a name="l00350"></a>00350 <span class="stringliteral">        PipeSource.__init__(self, handle)</span>
<a name="l00351"></a>00351 <span class="stringliteral">         </span>
<a name="l00352"></a><a class="code" href="classgp_1_1client_1_1_file_source.html#a30608ce0ffd6f215819b2f6e22bf41c5">00352</a> <span class="stringliteral">    def close(self):  </span>
<a name="l00353"></a>00353 <span class="stringliteral">        &quot;&quot;&quot;</span>Close the file handle.<span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00354"></a>00354 <span class="stringliteral">        self.hin.close()</span>
<a name="l00355"></a>00355 <span class="stringliteral">         </span>
<a name="l00356"></a>00356 <span class="stringliteral">     </span>
<a name="l00357"></a>00357 <span class="stringliteral"></span>
<a name="l00358"></a>00358 <span class="stringliteral"></span>
<a name="l00359"></a>00359 <span class="stringliteral"></span>
<a name="l00360"></a><a class="code" href="classgp_1_1client_1_1_data_sink.html">00360</a> <span class="stringliteral">class DataSink(object): #abstract</span>
<a name="l00361"></a>00361 <span class="stringliteral">    &quot;&quot;&quot;</span>Abstract base <span class="keyword">class </span>for <span class="stringliteral">&quot;data sinks&quot;</span>.
<a name="l00362"></a>00362 
<a name="l00363"></a>00363     The gpClient framework uses data sink objects to represent the
<a name="l00364"></a>00364     endpoint of a data transfer. That <span class="keywordflow">is</span>, a data sink accepts one row
<a name="l00365"></a>00365     of tabular data after another, <span class="keywordflow">and</span> handles them <span class="keywordflow">in</span> some way.
<a name="l00366"></a>00366     How the row <span class="keywordflow">is</span> processed <span class="keywordflow">is</span> specific to the concrete implementation. 
<a name="l00367"></a>00367     
<a name="l00368"></a>00368     <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00369"></a><a class="code" href="namespacegp_1_1client.html#ad3fc7d4569a527dd793995eab6cebefe">00369</a> <span class="stringliteral">    def putRow(self, row):</span>
<a name="l00370"></a>00370 <span class="stringliteral">        raise NotImplementedError( &quot;`putRow()&#39; called in abstract class&quot; )</span>
<a name="l00371"></a>00371 <span class="stringliteral">    </span>
<a name="l00372"></a><a class="code" href="namespacegp_1_1client.html#aeb2f2a1e3723e72b1ad6652d24e9daf6">00372</a> <span class="stringliteral">    def flush(self):</span>
<a name="l00373"></a>00373 <span class="stringliteral">        &quot;&quot;&quot;</span>Write buffered data.
<a name="l00374"></a>00374 
<a name="l00375"></a>00375         In case any output has been buffered (<span class="keywordflow">or</span> some other kind of
<a name="l00376"></a>00376         action has been deferred), it should be written now (resp.
<a name="l00377"></a>00377         deferred actions should be performed <span class="keywordflow">and</span> made permanent).
<a name="l00378"></a>00378     
<a name="l00379"></a>00379         The default implementation of this method does nothing. Any
<a name="l00380"></a>00380         subclass that applies any kind of buffereing to the output
<a name="l00381"></a>00381         should override it to make all pending changes permanent.
<a name="l00382"></a>00382     
<a name="l00383"></a>00383         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00384"></a>00384 <span class="stringliteral">        </span>
<a name="l00385"></a>00385 <span class="stringliteral">        pass</span>
<a name="l00386"></a>00386 <span class="stringliteral">    </span>
<a name="l00387"></a><a class="code" href="namespacegp_1_1client.html#a2282dee0388ca4811cb47dd4de1ae966">00387</a> <span class="stringliteral">    def close(self):</span>
<a name="l00388"></a>00388 <span class="stringliteral">        &quot;&quot;&quot;</span>Close this data output <span class="keywordflow">and</span> releases allocated resources.
<a name="l00389"></a>00389 
<a name="l00390"></a>00390         The behavior of calls to <a class="code" href="namespacegp_1_1client.html#ad3fc7d4569a527dd793995eab6cebefe">putRow</a>() <span class="keywordflow">is</span> undefined after <a class="code" href="namespacegp_1_1client.html#a2282dee0388ca4811cb47dd4de1ae966">close</a>()
<a name="l00391"></a>00391         was called on the same object.
<a name="l00392"></a>00392     
<a name="l00393"></a>00393         The default implementation of this method calls <a class="code" href="namespacegp_1_1client.html#aeb2f2a1e3723e72b1ad6652d24e9daf6">flush</a>(). Any
<a name="l00394"></a>00394         subclass that allocates any external resources should override
<a name="l00395"></a>00395         this method to release those resources.
<a name="l00396"></a>00396    
<a name="l00397"></a>00397         <span class="stringliteral">&quot;&quot;&quot; </span>
<a name="l00398"></a>00398 <span class="stringliteral">        </span>
<a name="l00399"></a>00399 <span class="stringliteral">        self.flush()</span>
<a name="l00400"></a>00400 <span class="stringliteral">         </span>
<a name="l00401"></a>00401 <span class="stringliteral">     </span>
<a name="l00402"></a><a class="code" href="classgp_1_1client_1_1_null_sink.html">00402</a> <span class="stringliteral">class NullSink( DataSink ):</span>
<a name="l00403"></a>00403 <span class="stringliteral">    &quot;&quot;&quot;</span>A data sink that simply ignores all incoming data.<span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00404"></a>00404 <span class="stringliteral">        </span>
<a name="l00405"></a>00405 <span class="stringliteral">    def putRow(self, row):</span>
<a name="l00406"></a>00406 <span class="stringliteral">        pass</span>
<a name="l00407"></a>00407 <span class="stringliteral">        </span>
<a name="l00408"></a>00408 <span class="stringliteral">    def flush(self):</span>
<a name="l00409"></a>00409 <span class="stringliteral">        pass</span>
<a name="l00410"></a>00410 <span class="stringliteral"></span>
<a name="l00411"></a>00411 <span class="stringliteral">    instance = None</span>
<a name="l00412"></a>00412 <span class="stringliteral"></span>
<a name="l00413"></a>00413 <span class="stringliteral">NullSink.instance = NullSink()</span>
<a name="l00414"></a>00414 <span class="stringliteral">&quot;&quot;&quot;</span>A <span class="keyword">global</span> variable of the module containing a NullSink instance.
<a name="l00415"></a>00415 
<a name="l00416"></a>00416 It hould be used <span class="keywordflow">in</span> order to avoid the costs of crating new instaces
<a name="l00417"></a>00417 which are <span class="keywordflow">not</span> necessary <span class="keywordflow">for</span> this <span class="keyword">class</span>.
<a name="l00418"></a>00418 
<a name="l00419"></a>00419 <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00420"></a>00420 <span class="stringliteral"></span>
<a name="l00421"></a><a class="code" href="classgp_1_1client_1_1_array_sink.html">00421</a> <span class="stringliteral">class ArraySink(DataSink):</span>
<a name="l00422"></a>00422 <span class="stringliteral">    &quot;&quot;&quot;</span>A data sink that appends each row to a data array.
<a name="l00423"></a>00423 
<a name="l00424"></a>00424     This <span class="keywordflow">is</span> typically used to make the data returned <span class="keyword">from</span> a GraphCore
<a name="l00425"></a>00425     command available <span class="keywordflow">for</span> programmatic processing. It should however <span class="keywordflow">not</span>
<a name="l00426"></a>00426     be used <span class="keywordflow">in</span> situations where large amounts of data are expected to be
<a name="l00427"></a>00427     returned.
<a name="l00428"></a>00428 
<a name="l00429"></a>00429     <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00430"></a><a class="code" href="classgp_1_1client_1_1_array_sink.html#a88e86ad1bd7f5a150edea3553b7b92b3">00430</a> <span class="stringliteral">    def __init__(self, data=None):     #? data war Zeiger!</span>
<a name="l00431"></a>00431 <span class="stringliteral">        &quot;&quot;&quot;</span>Initializes a new ArraySink.
<a name="l00432"></a>00432     
<a name="l00433"></a>00433         @param array data (optional) an array the rows
<a name="l00434"></a>00434                should be appended to. If <span class="keywordflow">not</span> given, a new array will be
<a name="l00435"></a>00435                created, <span class="keywordflow">and</span> can be accessed using the <a class="code" href="classgp_1_1client_1_1_array_sink.html#ae6521199d4bc9fb54286b052c5f3e1d1">getData</a>() method.
<a name="l00436"></a>00436     
<a name="l00437"></a>00437         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00438"></a>00438 <span class="stringliteral">        </span>
<a name="l00439"></a>00439 <span class="stringliteral">        if data is None:</span>
<a name="l00440"></a>00440 <span class="stringliteral">            #NOTE: don&#39;t use [] as a default param, otherwise we&#39;ll be </span>
<a name="l00441"></a>00441 <span class="stringliteral">            #      using the same list instance for all calls!</span>
<a name="l00442"></a>00442 <span class="stringliteral">            data = []</span>
<a name="l00443"></a>00443 <span class="stringliteral">        </span>
<a name="l00444"></a>00444 <span class="stringliteral">        self.data = data</span>
<a name="l00445"></a>00445 <span class="stringliteral">         </span>
<a name="l00446"></a><a class="code" href="classgp_1_1client_1_1_array_sink.html#adc84b189f5d09883c30488673e92fdab">00446</a> <span class="stringliteral">    def putRow(self, row):</span>
<a name="l00447"></a>00447 <span class="stringliteral">        &quot;&quot;&quot;</span>Appends the given row to the table maintained by this ArraySink.
<a name="l00448"></a>00448 
<a name="l00449"></a>00449         The data can be accessed using the <a class="code" href="classgp_1_1client_1_1_array_sink.html#ae6521199d4bc9fb54286b052c5f3e1d1">getData</a>() method.
<a name="l00450"></a>00450 
<a name="l00451"></a>00451         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00452"></a>00452 <span class="stringliteral">        </span>
<a name="l00453"></a>00453 <span class="stringliteral">        self.data.append(row)</span>
<a name="l00454"></a>00454 <span class="stringliteral">         </span>
<a name="l00455"></a><a class="code" href="classgp_1_1client_1_1_array_sink.html#ae6521199d4bc9fb54286b052c5f3e1d1">00455</a> <span class="stringliteral">    def getData(self):</span>
<a name="l00456"></a>00456 <span class="stringliteral">        &quot;&quot;&quot;</span>Returns the array that contains this ArraySink<span class="stringliteral">&#39;s tabular data.</span>
<a name="l00457"></a>00457 <span class="stringliteral"></span>
<a name="l00458"></a>00458 <span class="stringliteral">        This method </span><span class="keywordflow">is</span> typically used to access the data collected by this
<a name="l00459"></a>00459         data sink.
<a name="l00460"></a>00460     
<a name="l00461"></a>00461         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00462"></a>00462 <span class="stringliteral">        return self.data</span>
<a name="l00463"></a>00463 <span class="stringliteral">         </span>
<a name="l00464"></a><a class="code" href="classgp_1_1client_1_1_array_sink.html#aafd13f71175a1ea2e86032cc2cd24d49">00464</a> <span class="stringliteral">    def makeSource(self):</span>
<a name="l00465"></a>00465 <span class="stringliteral">        &quot;&quot;&quot;</span>Return a new instance of ArraySource.
<a name="l00466"></a>00466 
<a name="l00467"></a>00467         It may be used to read the rows <span class="keyword">from</span> the array of tabular data
<a name="l00468"></a>00468         maintained by this ArraySink.
<a name="l00469"></a>00469     
<a name="l00470"></a>00470         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00471"></a>00471 <span class="stringliteral">        return ArraySource(self.data)</span>
<a name="l00472"></a>00472 <span class="stringliteral">         </span>
<a name="l00473"></a><a class="code" href="classgp_1_1client_1_1_array_sink.html#a5b4dcde9cda88e52f4d0a06e65d9d239">00473</a> <span class="stringliteral">    def getMap(self):</span>
<a name="l00474"></a>00474 <span class="stringliteral">        &quot;&quot;&quot;</span>Return the maintained tabular data <span class="keyword">as</span> an associative array.
<a name="l00475"></a>00475 
<a name="l00476"></a>00476         This only works <span class="keywordflow">for</span> two column data, where each column <span class="keywordflow">is</span>
<a name="l00477"></a>00477         interpreted <span class="keyword">as</span> a pair of key <span class="keywordflow">and</span> value. The first column <span class="keywordflow">is</span>
<a name="l00478"></a>00478         used <span class="keyword">as</span> the key <span class="keywordflow">and</span> the second column <span class="keywordflow">is</span> used <span class="keyword">as</span> the value.
<a name="l00479"></a>00479      
<a name="l00480"></a>00480         @rtype:  dictionary
<a name="l00481"></a>00481         @<span class="keywordflow">return</span>: an associative array created under the assumption
<a name="l00482"></a>00482                  that the tabular data <span class="keywordflow">in</span> this ArraySink consists of
<a name="l00483"></a>00483                  key value pairs.
<a name="l00484"></a>00484 
<a name="l00485"></a>00485         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00486"></a>00486 <span class="stringliteral">        return pairs2map(self.data)</span>
<a name="l00487"></a>00487 <span class="stringliteral"></span>
<a name="l00488"></a>00488 <span class="stringliteral"></span>
<a name="l00489"></a><a class="code" href="classgp_1_1client_1_1_pipe_sink.html">00489</a> <span class="stringliteral">class PipeSink (DataSink):</span>
<a name="l00490"></a>00490 <span class="stringliteral">    &quot;&quot;&quot;</span>Data sink based on a file handle.
<a name="l00491"></a>00491 
<a name="l00492"></a>00492     Each data row <span class="keywordflow">is</span> written <span class="keyword">as</span> a line to the file handle.
<a name="l00493"></a>00493 
<a name="l00494"></a>00494     Note: calling <a class="code" href="namespacegp_1_1client.html#a2282dee0388ca4811cb47dd4de1ae966">close</a>() on a PipeSink does *<span class="keywordflow">not</span>* close the
<a name="l00495"></a>00495     underlying file handle. The idea <span class="keywordflow">is</span> that the handle should be closed
<a name="l00496"></a>00496     by the same code that also opened the file.
<a name="l00497"></a>00497 
<a name="l00498"></a>00498     <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00499"></a>00499 <span class="stringliteral">    </span>
<a name="l00500"></a><a class="code" href="classgp_1_1client_1_1_pipe_sink.html#acff76c726655bebc90de958190f1103e">00500</a> <span class="stringliteral">    def __init__(self, hout, linebreak=None):</span>
<a name="l00501"></a>00501 <span class="stringliteral">        &quot;&quot;&quot;</span>Initializes a new pipe sink with the given file handle.
<a name="l00502"></a>00502 
<a name="l00503"></a>00503         @param resource $hout a file handle that can be written to, such <span class="keyword">as</span> 
<a name="l00504"></a>00504                returned by fopen <span class="keywordflow">or</span> fsockopen.
<a name="l00505"></a>00505         @param string $linebreak character(s) to use to separate rows <span class="keywordflow">in</span> the
<a name="l00506"></a>00506                output (default: LINEBREAK)
<a name="l00507"></a>00507     
<a name="l00508"></a>00508         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00509"></a>00509 <span class="stringliteral">        if not linebreak:</span>
<a name="l00510"></a>00510 <span class="stringliteral">            linebreak = LINEBREAK</span>
<a name="l00511"></a>00511 <span class="stringliteral">        self.hout = hout</span>
<a name="l00512"></a>00512 <span class="stringliteral">        self.linebreak = linebreak</span>
<a name="l00513"></a>00513 <span class="stringliteral">         </span>
<a name="l00514"></a><a class="code" href="classgp_1_1client_1_1_pipe_sink.html#a1f0b170d4fd4a593fa962b04e60a7062">00514</a> <span class="stringliteral">    def putRow(self, row):</span>
<a name="l00515"></a>00515 <span class="stringliteral">        &quot;&quot;&quot;</span>Writes the given data row to the file handle.
<a name="l00516"></a>00516 
<a name="l00517"></a>00517         Connection.joinRow() <span class="keywordflow">is</span> used to encode the data row into a
<a name="l00518"></a>00518         line of text. PipeTransport.send_to() <span class="keywordflow">is</span> used to write the
<a name="l00519"></a>00519         line to the file handle.
<a name="l00520"></a>00520      
<a name="l00521"></a>00521         Note that the rows passed to successive calls to <a class="code" href="classgp_1_1client_1_1_pipe_sink.html#a1f0b170d4fd4a593fa962b04e60a7062">putRow</a>() should
<a name="l00522"></a>00522         have the same number of fields <span class="keywordflow">and</span> use the same array keys.
<a name="l00523"></a>00523      
<a name="l00524"></a>00524         @type row:  list/tuple of int/str types
<a name="l00525"></a>00525         @param row: representation of a data row.
<a name="l00526"></a>00526     
<a name="l00527"></a>00527         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00528"></a>00528 <span class="stringliteral">        s = Connection.joinRow(row)</span>
<a name="l00529"></a>00529 <span class="stringliteral">        PipeTransport.send_to(self.hout, s + self.linebreak)</span>
<a name="l00530"></a>00530 <span class="stringliteral">         </span>
<a name="l00531"></a><a class="code" href="classgp_1_1client_1_1_pipe_sink.html#a1d1bbdc275f674bdb24245d06318bcbc">00531</a> <span class="stringliteral">    def flush(self):</span>
<a name="l00532"></a>00532 <span class="stringliteral">        &quot;&quot;&quot;</span>Flushes any pending data on the file handle (using fflush).<span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00533"></a>00533 <span class="stringliteral">        self.hout.flush()</span>
<a name="l00534"></a>00534 <span class="stringliteral">         </span>
<a name="l00535"></a>00535 <span class="stringliteral">     </span>
<a name="l00536"></a><a class="code" href="classgp_1_1client_1_1_file_sink.html">00536</a> <span class="stringliteral">class FileSink (PipeSink):</span>
<a name="l00537"></a>00537 <span class="stringliteral">    &quot;&quot;&quot;</span>Data sink based on writing to a file.
<a name="l00538"></a>00538 
<a name="l00539"></a>00539     Extends PipeSink to handle an actual local file.
<a name="l00540"></a>00540 
<a name="l00541"></a>00541     Note: calling <a class="code" href="classgp_1_1client_1_1_file_sink.html#ab32e6cda461d6bf17a9c6900396282fe">close</a>() on a FileSink *does* close the underlying
<a name="l00542"></a>00542     file handle. The idea <span class="keywordflow">is</span> that the handle should be closed by the
<a name="l00543"></a>00543     same code that also opened the file.
<a name="l00544"></a>00544 
<a name="l00545"></a>00545     <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00546"></a>00546 <span class="stringliteral">    </span>
<a name="l00547"></a><a class="code" href="classgp_1_1client_1_1_file_sink.html#a1b4cc37d5fc4c5fdf959f5c177a60708">00547</a> <span class="stringliteral">    def __init__(self, path, append=False, linebreak=None):</span>
<a name="l00548"></a>00548 <span class="stringliteral">        &quot;&quot;&quot;</span>Creates a new FileSink around the given file.
<a name="l00549"></a>00549 
<a name="l00550"></a>00550         The file given by path <span class="keywordflow">is</span> opened using file().
<a name="l00551"></a>00551      
<a name="l00552"></a>00552         @param string path the path to the local file to write to.
<a name="l00553"></a>00553         @param boolean append whether to append to the file, <span class="keywordflow">or</span> override it
<a name="l00554"></a>00554         @param string linebreak character(s) to use to separate lines <span class="keywordflow">in</span> the
<a name="l00555"></a>00555                resulting file (default: os.linesep)
<a name="l00556"></a>00556         @throws gpClientException <span class="keywordflow">if</span> the file could <span class="keywordflow">not</span> be opened.
<a name="l00557"></a>00557     
<a name="l00558"></a>00558         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00559"></a>00559 <span class="stringliteral">        if append == True:</span>
<a name="l00560"></a>00560 <span class="stringliteral">            self.mode = &#39;a&#39;</span>
<a name="l00561"></a>00561 <span class="stringliteral">        elif append == False:</span>
<a name="l00562"></a>00562 <span class="stringliteral">            self.mode = &#39;w&#39;</span>
<a name="l00563"></a>00563 <span class="stringliteral">        else:</span>
<a name="l00564"></a>00564 <span class="stringliteral">            self.mode = append</span>
<a name="l00565"></a>00565 <span class="stringliteral">        if not linebreak:</span>
<a name="l00566"></a>00566 <span class="stringliteral">            linebreak = os.linesep</span>
<a name="l00567"></a>00567 <span class="stringliteral">        self.path = path</span>
<a name="l00568"></a>00568 <span class="stringliteral">        try:</span>
<a name="l00569"></a>00569 <span class="stringliteral">            h = file(self.path, self.mode)</span>
<a name="l00570"></a>00570 <span class="stringliteral">        except Error:</span>
<a name="l00571"></a>00571 <span class="stringliteral">            raise gpClientException( &quot;failed to open %s&quot; % self.path )</span>
<a name="l00572"></a>00572 <span class="stringliteral">        PipeSink.__init__(self, h, linebreak )</span>
<a name="l00573"></a>00573 <span class="stringliteral">         </span>
<a name="l00574"></a><a class="code" href="classgp_1_1client_1_1_file_sink.html#ab32e6cda461d6bf17a9c6900396282fe">00574</a> <span class="stringliteral">    def close(self):</span>
<a name="l00575"></a>00575 <span class="stringliteral">        &quot;&quot;&quot;</span>closes the file handle (after flushing it).<span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00576"></a>00576 <span class="stringliteral">        PipeSink.close(self)</span>
<a name="l00577"></a>00577 <span class="stringliteral">        self.hout.close()</span>
<a name="l00578"></a>00578 <span class="stringliteral"></span>
<a name="l00579"></a>00579 <span class="stringliteral"></span>
<a name="l00580"></a>00580 <span class="stringliteral"></span>
<a name="l00581"></a>00581 <span class="stringliteral"></span>
<a name="l00582"></a>00582 <span class="stringliteral"></span>
<a name="l00583"></a><a class="code" href="classgp_1_1client_1_1_transport.html">00583</a> <span class="stringliteral">class Transport(object): # abstract</span>
<a name="l00584"></a>00584 <span class="stringliteral">    &quot;&quot;&quot;</span>Abstract base <span class="keyword">class </span>of all transports used by the gpClient framework.
<a name="l00585"></a>00585 
<a name="l00586"></a>00586     A transport abstracts the way the framework communicates with the
<a name="l00587"></a>00587     remote peer (i.e. the instance of GraphServ resp. GrahCore). It
<a name="l00588"></a>00588     also implements to logic to connect to the remote instance.
<a name="l00589"></a>00589 
<a name="l00590"></a>00590     <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00591"></a>00591 <span class="stringliteral"></span>
<a name="l00592"></a><a class="code" href="namespacegp_1_1client.html#a327675923b97516d9d072c0c423f06b5">00592</a> <span class="stringliteral">    def __init__(self, *otherArguments):</span>
<a name="l00593"></a>00593 <span class="stringliteral">        &quot;&quot;&quot;</span>The constructor.<span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00594"></a>00594 <span class="stringliteral">        self.closed = False</span>
<a name="l00595"></a>00595 <span class="stringliteral">        self.debug = False</span>
<a name="l00596"></a>00596 <span class="stringliteral">        self._eof = False</span>
<a name="l00597"></a>00597 <span class="stringliteral">    </span>
<a name="l00598"></a><a class="code" href="namespacegp_1_1client.html#a477c2648f2f13a071a2606eeaed6a7f2">00598</a> <span class="stringliteral">    def trace(self, context, msg, obj=&#39;nothing878423really&#39;):</span>
<a name="l00599"></a>00599 <span class="stringliteral">        &quot;&quot;&quot;</span>Trace an error.<span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00600"></a>00600 <span class="stringliteral">        if ( self.debug ):</span>
<a name="l00601"></a>00601 <span class="stringliteral">            if obj != &#39;nothing878423really&#39;:</span>
<a name="l00602"></a>00602 <span class="stringliteral">                msg = msg + &#39;: &#39; + re.sub(&#39;\s+&#39;, &#39; &#39;, str(obj))</span>
<a name="l00603"></a>00603 <span class="stringliteral">                </span>
<a name="l00604"></a>00604 <span class="stringliteral">            print &quot;[Transport] %s: %s&quot; % (context, msg)</span>
<a name="l00605"></a>00605 <span class="stringliteral">    </span>
<a name="l00606"></a><a class="code" href="namespacegp_1_1client.html#a5459d37657fe0baca1e6aaf2bb585974">00606</a> <span class="stringliteral">    def isClosed(self):</span>
<a name="l00607"></a>00607 <span class="stringliteral">        &quot;&quot;&quot;</span>Return <span class="keyword">True</span> <span class="keywordflow">if</span> this Transport <span class="keywordflow">is</span> closed, e.g. with <a class="code" href="namespacegp_1_1client.html#a2282dee0388ca4811cb47dd4de1ae966">close</a>()<span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00608"></a>00608 <span class="stringliteral">        return self.closed</span>
<a name="l00609"></a>00609 <span class="stringliteral">    </span>
<a name="l00610"></a>00610 <span class="stringliteral">    def close(self):</span>
<a name="l00611"></a>00611 <span class="stringliteral">        &quot;&quot;&quot;</span>Closes this Transport
<a name="l00612"></a>00612 
<a name="l00613"></a>00613         Disconnect <span class="keyword">from</span> the peer <span class="keywordflow">and</span> free any resources that this object
<a name="l00614"></a>00614         may have allocated. After <a class="code" href="namespacegp_1_1client.html#a2282dee0388ca4811cb47dd4de1ae966">close</a>() has been called, <a class="code" href="namespacegp_1_1client.html#a5459d37657fe0baca1e6aaf2bb585974">isClosed</a>()
<a name="l00615"></a>00615         must always <span class="keywordflow">return</span> <span class="keyword">True</span> when called on the same object.
<a name="l00616"></a>00616         The default implementation just marks this object <span class="keyword">as</span> closed.
<a name="l00617"></a>00617     
<a name="l00618"></a>00618         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00619"></a>00619 <span class="stringliteral">        self.closed = True</span>
<a name="l00620"></a>00620 <span class="stringliteral">         </span>
<a name="l00621"></a><a class="code" href="namespacegp_1_1client.html#a35acc688674fce2a6dc3d49f4f3a4030">00621</a> <span class="stringliteral">    def connect(self):</span>
<a name="l00622"></a>00622 <span class="stringliteral">        &quot;&quot;&quot;</span>Connects this gptransport to its peer.
<a name="l00623"></a>00623 
<a name="l00624"></a>00624         Its peer <span class="keywordflow">is</span> the remote instance of GraphServ resp. graphCore.
<a name="l00625"></a>00625         The information required to connect <span class="keywordflow">is</span> typically provided to the
<a name="l00626"></a>00626         constructor of the respective subclass.
<a name="l00627"></a>00627 
<a name="l00628"></a>00628         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00629"></a>00629 <span class="stringliteral">        raise NotImplementedError(&quot;`connect()&#39; not implemented by %s&quot; % self.__class__)</span>
<a name="l00630"></a>00630 <span class="stringliteral">    </span>
<a name="l00631"></a><a class="code" href="namespacegp_1_1client.html#a80aa2a47dafa6a2cb03b74de3da70197">00631</a> <span class="stringliteral">    def send(self, s):</span>
<a name="l00632"></a>00632 <span class="stringliteral">        &quot;&quot;&quot;</span>Sends a string to the peer.
<a name="l00633"></a>00633 
<a name="l00634"></a>00634         This <span class="keywordflow">is</span> the an operation of the line based communication protocol.
<a name="l00635"></a>00635     
<a name="l00636"></a>00636         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00637"></a>00637 <span class="stringliteral">        raise NotImplementedError(&quot;`send()&#39; not implemented by %s&quot; % self.__class__)</span>
<a name="l00638"></a>00638 <span class="stringliteral">    </span>
<a name="l00639"></a><a class="code" href="namespacegp_1_1client.html#ae1c4f92d11fb06edcdf49b641fa133e5">00639</a> <span class="stringliteral">    def receive(self):</span>
<a name="l00640"></a>00640 <span class="stringliteral">        &quot;&quot;&quot;</span>Receives a string <span class="keyword">from</span> the peer.
<a name="l00641"></a>00641 
<a name="l00642"></a>00642         This <span class="keywordflow">is</span> the a operation of the line based communication protocol.
<a name="l00643"></a>00643 
<a name="l00644"></a>00644         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00645"></a>00645 <span class="stringliteral">        raise NotImplementedError(&quot;`receive()&#39; not implemented by %s&quot; % self.__class__)</span>
<a name="l00646"></a>00646 <span class="stringliteral">    </span>
<a name="l00647"></a><a class="code" href="namespacegp_1_1client.html#a96acb626d4f27a4734f393381ffa031e">00647</a> <span class="stringliteral">    def eof(self):</span>
<a name="l00648"></a>00648 <span class="stringliteral">        &quot;&quot;&quot;</span><span class="keyword">True</span> after detection of end of data stream <span class="keyword">from</span> the peer<span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00649"></a>00649 <span class="stringliteral">        return self._eof</span>
<a name="l00650"></a>00650 <span class="stringliteral">    </span>
<a name="l00651"></a><a class="code" href="namespacegp_1_1client.html#a936d804098eac9115d5e995c69d688b4">00651</a> <span class="stringliteral">    def make_source(self):</span>
<a name="l00652"></a>00652 <span class="stringliteral">        &quot;&quot;&quot;</span>Creates an instance of DataSource
<a name="l00653"></a>00653 
<a name="l00654"></a>00654         <span class="keywordflow">for</span> reading data <span class="keyword">from</span> the current position <span class="keywordflow">in</span> the data stream
<a name="l00655"></a>00655         coming <span class="keyword">from</span> the peer.
<a name="l00656"></a>00656     
<a name="l00657"></a>00657         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00658"></a>00658 <span class="stringliteral">        raise NotImplementedError(&quot;`make_source()&#39; not implemented by %s&quot; % self.__class__)</span>
<a name="l00659"></a>00659 <span class="stringliteral">    </span>
<a name="l00660"></a><a class="code" href="namespacegp_1_1client.html#a9bf187790b4fb1a911203c0ea9704edf">00660</a> <span class="stringliteral">    def make_sink(self):</span>
<a name="l00661"></a>00661 <span class="stringliteral">        &quot;&quot;&quot;</span>Create an instance of DataSink
<a name="l00662"></a>00662 
<a name="l00663"></a>00663         <span class="keywordflow">for</span> writing data to the data stream going to the peer.
<a name="l00664"></a>00664     
<a name="l00665"></a>00665         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00666"></a>00666 <span class="stringliteral">        raise NotImplementedError(&quot;`make_sink()&#39; not implemented by %s&quot; % self.__class__)</span>
<a name="l00667"></a>00667 <span class="stringliteral"> </span>
<a name="l00668"></a><a class="code" href="namespacegp_1_1client.html#a7bad879eeb390e3359f7c7097002c2cf">00668</a> <span class="stringliteral">    def checkPeer(self): </span>
<a name="l00669"></a>00669 <span class="stringliteral">        &quot;&quot;&quot;</span>Attempts to check <span class="keywordflow">if</span> the peer <span class="keywordflow">is</span> still responding. 
<a name="l00670"></a>00670 
<a name="l00671"></a>00671         A static function.
<a name="l00672"></a>00672         The default implementation does nothing.
<a name="l00673"></a>00673 
<a name="l00674"></a>00674         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00675"></a>00675 <span class="stringliteral">        pass   # noop</span>
<a name="l00676"></a>00676 <span class="stringliteral">          </span>
<a name="l00677"></a><a class="code" href="namespacegp_1_1client.html#a5d6745b8cae3773df63fde671ddb3137">00677</a> <span class="stringliteral">    def setDebug(self,debug):</span>
<a name="l00678"></a>00678 <span class="stringliteral">        &quot;&quot;&quot;</span>Sets the debug mode on this transport object.
<a name="l00679"></a>00679 
<a name="l00680"></a>00680         When debugging <span class="keywordflow">is</span> enabled, details about all data send <span class="keywordflow">or</span>
<a name="l00681"></a>00681         received <span class="keywordflow">is</span> deumpted to stdout. 
<a name="l00682"></a>00682     
<a name="l00683"></a>00683         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00684"></a>00684 <span class="stringliteral">        self.debug = debug</span>
<a name="l00685"></a>00685 <span class="stringliteral"></span>
<a name="l00686"></a>00686 <span class="stringliteral"></span>
<a name="l00687"></a><a class="code" href="classgp_1_1client_1_1_pipe_transport.html">00687</a> <span class="stringliteral">class PipeTransport(Transport): # abstract</span>
<a name="l00688"></a>00688 <span class="stringliteral">    &quot;&quot;&quot;</span>Abstract base <span class="keywordflow">for</span> file handle based implementations of Transport.<span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00689"></a>00689 <span class="stringliteral"></span>
<a name="l00690"></a><a class="code" href="namespacegp_1_1client.html#a327675923b97516d9d072c0c423f06b5">00690</a> <span class="stringliteral">    def __init__(self):</span>
<a name="l00691"></a>00691 <span class="stringliteral">        self.hout = None</span>
<a name="l00692"></a>00692 <span class="stringliteral">        self.hin = None</span>
<a name="l00693"></a>00693 <span class="stringliteral">        </span>
<a name="l00694"></a>00694 <span class="stringliteral">        self.out_chunk_size = None</span>
<a name="l00695"></a>00695 <span class="stringliteral">        </span>
<a name="l00696"></a>00696 <span class="stringliteral">        Transport.__init__(self)</span>
<a name="l00697"></a>00697 <span class="stringliteral">    </span>
<a name="l00698"></a>00698 <span class="stringliteral">    @staticmethod</span>
<a name="l00699"></a>00699 <span class="stringliteral">    def send_to(hout, s, chunk_size = None):</span>
<a name="l00700"></a>00700 <span class="stringliteral">        &quot;&quot;&quot;</span>Utility function <span class="keywordflow">for</span> sending data to a file handle.
<a name="l00701"></a>00701 
<a name="l00702"></a>00702         This <span class="keywordflow">is</span> essentially a wrapper around file.write(), which makes sure
<a name="l00703"></a>00703         that s <span class="keywordflow">is</span> written <span class="keywordflow">in</span> its entirety. After s was written out using
<a name="l00704"></a>00704         file.write(), file.flush() <span class="keywordflow">is</span> called to commit all data to the peer.
<a name="l00705"></a>00705 
<a name="l00706"></a>00706         @param resource hout: the file handle to write to
<a name="l00707"></a>00707         @param string s: the data to write
<a name="l00708"></a>00708         @<span class="keywordflow">raise</span> gpProtocolException <span class="keywordflow">if</span> writing fails.
<a name="l00709"></a>00709     
<a name="l00710"></a>00710         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00711"></a>00711 <span class="stringliteral">        try:</span>
<a name="l00712"></a>00712 <span class="stringliteral">            if chunk_size: # write small chunks</span>
<a name="l00713"></a>00713 <span class="stringliteral">                i = 0</span>
<a name="l00714"></a>00714 <span class="stringliteral">                while i &lt;= len(s):</span>
<a name="l00715"></a>00715 <span class="stringliteral">                    hout.write(s[i:i+chunk_size])</span>
<a name="l00716"></a>00716 <span class="stringliteral">                    hout.flush()            # try to write the buffer</span>
<a name="l00717"></a>00717 <span class="stringliteral">                    i += chunk_size</span>
<a name="l00718"></a>00718 <span class="stringliteral">            else: # write all at once</span>
<a name="l00719"></a>00719 <span class="stringliteral">                hout.write(s)</span>
<a name="l00720"></a>00720 <span class="stringliteral">                hout.flush()            # try to write the buffer</span>
<a name="l00721"></a>00721 <span class="stringliteral">        except IOError:</span>
<a name="l00722"></a>00722 <span class="stringliteral">            raise gpClientException(</span>
<a name="l00723"></a>00723 <span class="stringliteral">              &quot;failed to send data to peer, broken pipe! &quot;</span>
<a name="l00724"></a>00724 <span class="stringliteral">              + &quot;(Writing to the file failed.)&quot;)</span>
<a name="l00725"></a>00725 <span class="stringliteral">        except:</span>
<a name="l00726"></a>00726 <span class="stringliteral">            raise gpClientException( &quot;failed to send data to peer, broken pipe! &quot;</span>
<a name="l00727"></a>00727 <span class="stringliteral">              + &quot;(A strange error occured.)&quot;)</span>
<a name="l00728"></a>00728 <span class="stringliteral">            raise</span>
<a name="l00729"></a>00729 <span class="stringliteral">         </span>
<a name="l00730"></a>00730 <span class="stringliteral">    def send(self, s):</span>
<a name="l00731"></a>00731 <span class="stringliteral">        &quot;&quot;&quot;</span>Sends the given data string to the peer
<a name="l00732"></a>00732 
<a name="l00733"></a>00733         by writing it to the output file handle created by the <a class="code" href="namespacegp_1_1client.html#a35acc688674fce2a6dc3d49f4f3a4030">connect</a>()
<a name="l00734"></a>00734         method. Uses PipeTransport.send_to() to send the data.
<a name="l00735"></a>00735     
<a name="l00736"></a>00736         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00737"></a>00737 <span class="stringliteral">        return PipeTransport.send_to(self.hout, s, self.out_chunk_size)</span>
<a name="l00738"></a>00738 <span class="stringliteral">    </span>
<a name="l00739"></a>00739 <span class="stringliteral">    def receive(self):</span>
<a name="l00740"></a>00740 <span class="stringliteral">        &quot;&quot;&quot;</span>Receives a string of data <span class="keyword">from</span> the peer
<a name="l00741"></a>00741         by reading a line <span class="keyword">from</span> the input file handle created by the
<a name="l00742"></a>00742         <a class="code" href="namespacegp_1_1client.html#a35acc688674fce2a6dc3d49f4f3a4030">connect</a>() method. Uses readline to send the data. 
<a name="l00743"></a>00743     
<a name="l00744"></a>00744         @todo: remove hardcoded limit of 1024 bytes per line!
<a name="l00745"></a>00745         <span class="comment">#? Here any problem?</span>
<a name="l00746"></a>00746     
<a name="l00747"></a>00747         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00748"></a>00748 <span class="stringliteral">        re = self.hin.readline()</span>
<a name="l00749"></a>00749 <span class="stringliteral">        if not re:</span>
<a name="l00750"></a>00750 <span class="stringliteral">            self._eof = True</span>
<a name="l00751"></a>00751 <span class="stringliteral">        return re</span>
<a name="l00752"></a>00752 <span class="stringliteral"></span>
<a name="l00753"></a><a class="code" href="namespacegp_1_1client.html#a25ce311fb50cc346059083e019988549">00753</a> <span class="stringliteral">    def setTimeout(self, seconds):</span>
<a name="l00754"></a>00754 <span class="stringliteral">        &quot;&quot;&quot;</span>Sets a read timeout on input file handle
<a name="l00755"></a>00755     
<a name="l00756"></a>00756         which <span class="keywordflow">is</span> created by the <a class="code" href="namespacegp_1_1client.html#a35acc688674fce2a6dc3d49f4f3a4030">connect</a>() method.
<a name="l00757"></a>00757     
<a name="l00758"></a>00758         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00759"></a>00759 <span class="stringliteral">        self.hin.settimeout(seconds)</span>
<a name="l00760"></a>00760 <span class="stringliteral"></span>
<a name="l00761"></a>00761 <span class="stringliteral">    def make_source(self):</span>
<a name="l00762"></a>00762 <span class="stringliteral">        &quot;&quot;&quot;</span>Returns a new instance of PipeSource
<a name="l00763"></a>00763 
<a name="l00764"></a>00764         <span class="keywordflow">and</span> this reads <span class="keyword">from</span> the input file handle created by the
<a name="l00765"></a>00765         connect method().
<a name="l00766"></a>00766     
<a name="l00767"></a>00767         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00768"></a>00768 <span class="stringliteral">        return PipeSource( self.hin )</span>
<a name="l00769"></a>00769 <span class="stringliteral">         </span>
<a name="l00770"></a>00770 <span class="stringliteral">    def make_sink(self):</span>
<a name="l00771"></a>00771 <span class="stringliteral">        &quot;&quot;&quot;</span>Returns a new instance of PipeSink
<a name="l00772"></a>00772 
<a name="l00773"></a>00773         that writes to the output file handle created by the connect method().
<a name="l00774"></a>00774    
<a name="l00775"></a>00775         <span class="stringliteral">&quot;&quot;&quot; </span>
<a name="l00776"></a>00776 <span class="stringliteral">        return PipeSink(self.hout)</span>
<a name="l00777"></a>00777 <span class="stringliteral"></span>
<a name="l00778"></a>00778 <span class="stringliteral">    def close(self): #TODO: port to PHP!</span>
<a name="l00779"></a>00779 <span class="stringliteral">        self.trace(__function__(), &quot;closing pipes&quot;)</span>
<a name="l00780"></a>00780 <span class="stringliteral"></span>
<a name="l00781"></a>00781 <span class="stringliteral">        if self.hin:</span>
<a name="l00782"></a>00782 <span class="stringliteral">            try:</span>
<a name="l00783"></a>00783 <span class="stringliteral">                self.hin.close()</span>
<a name="l00784"></a>00784 <span class="stringliteral">            except:</span>
<a name="l00785"></a>00785 <span class="stringliteral">                pass</span>
<a name="l00786"></a>00786 <span class="stringliteral">    </span>
<a name="l00787"></a>00787 <span class="stringliteral">        if self.hout:</span>
<a name="l00788"></a>00788 <span class="stringliteral">            self.hout.flush()</span>
<a name="l00789"></a>00789 <span class="stringliteral">            </span>
<a name="l00790"></a>00790 <span class="stringliteral">            try:</span>
<a name="l00791"></a>00791 <span class="stringliteral">                self.hout.close()</span>
<a name="l00792"></a>00792 <span class="stringliteral">            except:</span>
<a name="l00793"></a>00793 <span class="stringliteral">                pass</span>
<a name="l00794"></a>00794 <span class="stringliteral">    </span>
<a name="l00795"></a>00795 <span class="stringliteral">        Transport.close(self)</span>
<a name="l00796"></a>00796 <span class="stringliteral"></span>
<a name="l00797"></a><a class="code" href="classgp_1_1client_1_1_client_transport.html">00797</a> <span class="stringliteral">class ClientTransport(PipeTransport):</span>
<a name="l00798"></a>00798 <span class="stringliteral">    &quot;&quot;&quot;</span>Communicate with a remote instance of GraphServ over TCP.
<a name="l00799"></a>00799 
<a name="l00800"></a>00800     An implementation of PipeTransport.
<a name="l00801"></a>00801     @var host
<a name="l00802"></a>00802     @var port
<a name="l00803"></a>00803     @var socket = <span class="keyword">False</span>
<a name="l00804"></a>00804     <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00805"></a>00805 <span class="stringliteral">    </span>
<a name="l00806"></a><a class="code" href="classgp_1_1client_1_1_client_transport.html#aca6e4ce042222884922dfbd5cc94cd19">00806</a> <span class="stringliteral">    def __init__(self, host=&#39;localhost&#39;, port=PORT): #OK</span>
<a name="l00807"></a>00807 <span class="stringliteral">        &quot;&quot;&quot;</span>Initialize a new instance of ClientTransport.
<a name="l00808"></a>00808 
<a name="l00809"></a>00809         Responsable <span class="keywordflow">for</span> a connection with GraphServ.
<a name="l00810"></a>00810 
<a name="l00811"></a>00811         @param string host (default: <span class="stringliteral">&#39;localhost&#39;</span>) the host the GraphServ
<a name="l00812"></a>00812                process <span class="keywordflow">is</span> located at
<a name="l00813"></a>00813         @param int port (default: PORT) the TCP port the GraphServ
<a name="l00814"></a>00814                process <span class="keywordflow">is</span> listening at
<a name="l00815"></a>00815     
<a name="l00816"></a>00816         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00817"></a>00817 <span class="stringliteral">        self.port = port</span>
<a name="l00818"></a>00818 <span class="stringliteral">        self.host = host</span>
<a name="l00819"></a>00819 <span class="stringliteral">        #FIXME: PORT removal of self.graphname to php</span>
<a name="l00820"></a>00820 <span class="stringliteral">        self.socket = False</span>
<a name="l00821"></a>00821 <span class="stringliteral">        PipeTransport.__init__(self)</span>
<a name="l00822"></a>00822 <span class="stringliteral">         </span>
<a name="l00823"></a><a class="code" href="classgp_1_1client_1_1_client_transport.html#ae7e4685581c5b181cf81da7332e2e677">00823</a> <span class="stringliteral">    def connect(self):</span>
<a name="l00824"></a>00824 <span class="stringliteral">        &quot;&quot;&quot;</span>Connects to a remote instance of GraphServ
<a name="l00825"></a>00825 
<a name="l00826"></a>00826         using the host <span class="keywordflow">and</span> port provided to the constructor.
<a name="l00827"></a>00827         If the connection could be established, opens the graph
<a name="l00828"></a>00828         specified to the constructor.
<a name="l00829"></a>00829         B{<span class="comment">#? In PHP werden hier noch $errno und $errstr uebergeben. Philipp.}</span>
<a name="l00830"></a>00830      
<a name="l00831"></a>00831         @throws gpProtocolException <span class="keywordflow">if</span> the connection failed <span class="keywordflow">or</span> another
<a name="l00832"></a>00832                 communication error ocurred.
<a name="l00833"></a>00833     
<a name="l00834"></a>00834         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00835"></a>00835 <span class="stringliteral">        self.socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span>
<a name="l00836"></a>00836 <span class="stringliteral">        try:</span>
<a name="l00837"></a>00837 <span class="stringliteral">            self.socket.connect((self.host, self.port))</span>
<a name="l00838"></a>00838 <span class="stringliteral">            #XXX: configure timeout?</span>
<a name="l00839"></a>00839 <span class="stringliteral">        except socket.error as (value, message):</span>
<a name="l00840"></a>00840 <span class="stringliteral">            raise gpProtocolException(</span>
<a name="l00841"></a>00841 <span class="stringliteral">              &quot;failed to connect to %s:%s: %s %s&quot; % (self.host, self.port, value, message) )</span>
<a name="l00842"></a>00842 <span class="stringliteral">        </span>
<a name="l00843"></a>00843 <span class="stringliteral">        self.hin = self.socket.makefile(&quot;</span><span class="stringliteral">r&quot;)</span>
<a name="l00844"></a>00844 <span class="stringliteral">        self.<a class="code" href="classgp_1_1client_1_1_client_transport.html#adda40fa014f5bfab846cbf539ace72c6">hout</a> = self.socket.makefile(</span><span class="stringliteral">&quot;w&quot;</span>)
<a name="l00845"></a>00845         
<a name="l00846"></a>00846         <span class="keywordflow">return</span> <span class="keyword">True</span>
<a name="l00847"></a>00847          
<a name="l00848"></a><a class="code" href="classgp_1_1client_1_1_client_transport.html#a91658691b686598701199f8210e743ad">00848</a>     <span class="keyword">def </span><a class="code" href="classgp_1_1client_1_1_client_transport.html#a91658691b686598701199f8210e743ad">close</a>(self):
<a name="l00849"></a>00849         <span class="stringliteral">&quot;&quot;&quot;Closes the transport.</span>
<a name="l00850"></a>00850 <span class="stringliteral"></span>
<a name="l00851"></a>00851 <span class="stringliteral">        Disconnect the TCP socket to the remote GraphServ instance (using</span>
<a name="l00852"></a>00852 <span class="stringliteral">        fclose). Subsequent calls to close() have no further effect.</span>
<a name="l00853"></a>00853 <span class="stringliteral">        @throws gpProtocolException if the connection failed or another</span>
<a name="l00854"></a>00854 <span class="stringliteral">        communication error ocurred.</span>
<a name="l00855"></a>00855 <span class="stringliteral">    </span>
<a name="l00856"></a>00856 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l00857"></a>00857 
<a name="l00858"></a>00858         PipeTransport.close(self)
<a name="l00859"></a>00859 
<a name="l00860"></a>00860         <span class="keywordflow">if</span> <span class="keywordflow">not</span> self.<a class="code" href="classgp_1_1client_1_1_client_transport.html#a27b03890e516a3d90f23777d4f62c87b">socket</a>:
<a name="l00861"></a>00861             <span class="keywordflow">return</span> <span class="keyword">False</span>
<a name="l00862"></a>00862         
<a name="l00863"></a>00863         self.trace(__function__(), <span class="stringliteral">&quot;closing socket&quot;</span>)
<a name="l00864"></a>00864                 
<a name="l00865"></a>00865         <span class="comment">#manual sais: use shutdown() before close() to close socket in a &quot;timely fashion&quot;.</span>
<a name="l00866"></a>00866         <span class="keywordflow">try</span>:
<a name="l00867"></a>00867             self.socket.shutdown(socket.SHUT_RDWR) 
<a name="l00868"></a>00868         <span class="keywordflow">except</span> socket.error <span class="keyword">as</span> e:
<a name="l00869"></a>00869             self.trace(__function__(), <span class="stringliteral">&quot;socket.shutdown() failed: %s&quot;</span> % e)
<a name="l00870"></a>00870             
<a name="l00871"></a>00871         <span class="keywordflow">try</span>:
<a name="l00872"></a>00872             self.socket.close()
<a name="l00873"></a>00873         <span class="keywordflow">except</span> socket.error <span class="keyword">as</span> e:
<a name="l00874"></a>00874             self.trace(__function__(), <span class="stringliteral">&quot;socket.close() failed: %s&quot;</span> % e)
<a name="l00875"></a>00875         
<a name="l00876"></a>00876         self.<a class="code" href="classgp_1_1client_1_1_client_transport.html#aab3b1f0540e8eeff048446cd83f38c83">closed</a> = <span class="keyword">True</span>
<a name="l00877"></a>00877      
<a name="l00878"></a>00878 
<a name="l00879"></a><a class="code" href="classgp_1_1client_1_1_slave_transport.html">00879</a> <span class="keyword">class </span><a class="code" href="classgp_1_1client_1_1_slave_transport.html">SlaveTransport</a>(<a class="code" href="classgp_1_1client_1_1_pipe_transport.html">PipeTransport</a>):
<a name="l00880"></a>00880     <span class="stringliteral">&quot;&quot;&quot;A transport implementation for communicating</span>
<a name="l00881"></a>00881 <span class="stringliteral"></span>
<a name="l00882"></a>00882 <span class="stringliteral">    with a GraphCore instance running in a local child process (i.e. as</span>
<a name="l00883"></a>00883 <span class="stringliteral">    a slave to the current PHP script).</span>
<a name="l00884"></a>00884 <span class="stringliteral">    </span>
<a name="l00885"></a>00885 <span class="stringliteral">    @var process</span>
<a name="l00886"></a>00886 <span class="stringliteral">    @var command</span>
<a name="l00887"></a>00887 <span class="stringliteral"></span>
<a name="l00888"></a>00888 <span class="stringliteral">    &quot;&quot;&quot;</span>
<a name="l00889"></a>00889     
<a name="l00890"></a><a class="code" href="classgp_1_1client_1_1_slave_transport.html#a2de17cf1917e5a440b31edd4d783d7f3">00890</a>     <span class="keyword">def </span><a class="code" href="classgp_1_1client_1_1_slave_transport.html#a2de17cf1917e5a440b31edd4d783d7f3">__init__</a>(self, command, cwd=None, env=None):
<a name="l00891"></a>00891         <span class="stringliteral">&quot;&quot;&quot;Initialize a new instance of SlaveTransport.</span>
<a name="l00892"></a>00892 <span class="stringliteral"></span>
<a name="l00893"></a>00893 <span class="stringliteral">        Launch a slave instance of GraphCore.</span>
<a name="l00894"></a>00894 <span class="stringliteral">     </span>
<a name="l00895"></a>00895 <span class="stringliteral">        @param mixed command the command line to start GraphCore.</span>
<a name="l00896"></a>00896 <span class="stringliteral">               May be given as a string or as an array. If given as a</span>
<a name="l00897"></a>00897 <span class="stringliteral">               string, all parameters must be duely escaped #?. If given as</span>
<a name="l00898"></a>00898 <span class="stringliteral">               an array, command[0] must be the path to the GraphCore</span>
<a name="l00899"></a>00899 <span class="stringliteral">               executable. See Slavetransport.makeCommand() for more</span>
<a name="l00900"></a>00900 <span class="stringliteral">               details.</span>
<a name="l00901"></a>00901 <span class="stringliteral">        @param string cwd (default: None) the working dir to run the</span>
<a name="l00902"></a>00902 <span class="stringliteral">               slave process in. Defaults to the current working </span>
<a name="l00903"></a>00903 <span class="stringliteral">               directory. #? Check!</span>
<a name="l00904"></a>00904 <span class="stringliteral">        @param int $env (default: null) the environment variables to</span>
<a name="l00905"></a>00905 <span class="stringliteral">               pass to the slave process. Defaults to inheriting the PHP</span>
<a name="l00906"></a>00906 <span class="stringliteral">               script&#39;s environment.</span>
<a name="l00907"></a>00907 <span class="stringliteral">    </span>
<a name="l00908"></a>00908 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l00909"></a>00909         self.<a class="code" href="classgp_1_1client_1_1_slave_transport.html#a7cb3afc54963e1b63e647e61606c21f2">command</a> = command
<a name="l00910"></a>00910         self.<a class="code" href="classgp_1_1client_1_1_slave_transport.html#a585995c1cead2f5b366d8340cfc9afff">cwd</a> = cwd
<a name="l00911"></a>00911         self.<a class="code" href="classgp_1_1client_1_1_slave_transport.html#a2b193ae5f3180bc02ff1578cee0dcecc">env</a> = env
<a name="l00912"></a>00912         self.<a class="code" href="classgp_1_1client_1_1_slave_transport.html#af68d413e59a4f445e67f9ee945c3ea97">process</a> = <span class="keywordtype">None</span>
<a name="l00913"></a>00913         PipeTransport.__init__(self)
<a name="l00914"></a>00914     
<a name="l00915"></a>00915     @staticmethod
<a name="l00916"></a><a class="code" href="classgp_1_1client_1_1_slave_transport.html#a7dcfc1e9209eb4192081422f6b7f3094">00916</a>     <span class="keyword">def </span><a class="code" href="classgp_1_1client_1_1_slave_transport.html#a7dcfc1e9209eb4192081422f6b7f3094">makeCommand</a>(command):
<a name="l00917"></a>00917         <span class="stringliteral">&quot;&quot;&quot;Utility function for creating a valid command line.</span>
<a name="l00918"></a>00918 <span class="stringliteral">        </span>
<a name="l00919"></a>00919 <span class="stringliteral">        It is called before executing a program as a child process.</span>
<a name="l00920"></a>00920 <span class="stringliteral">     </span>
<a name="l00921"></a>00921 <span class="stringliteral">        @type command:  str or list or tuple</span>
<a name="l00922"></a>00922 <span class="stringliteral">        @param command: the command, including the executable and any</span>
<a name="l00923"></a>00923 <span class="stringliteral">               parameters. If given as a string, all parameters must be</span>
<a name="l00924"></a>00924 <span class="stringliteral">               duely escaped. #? If given as an array, command[0] must be</span>
<a name="l00925"></a>00925 <span class="stringliteral">               the path to an executable.</span>
<a name="l00926"></a>00926 <span class="stringliteral">        @rtype:  str</span>
<a name="l00927"></a>00927 <span class="stringliteral">        @return: A valid command line. The first part of</span>
<a name="l00928"></a>00928 <span class="stringliteral">                 the command is the executable, any following parts are</span>
<a name="l00929"></a>00929 <span class="stringliteral">                 passed as arguments to the executable.</span>
<a name="l00930"></a>00930 <span class="stringliteral">        @raise: gpClientException if the command did not point to a readable,</span>
<a name="l00931"></a>00931 <span class="stringliteral">                executable file.</span>
<a name="l00932"></a>00932 <span class="stringliteral">    </span>
<a name="l00933"></a>00933 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l00934"></a>00934         <span class="keywordflow">if</span> <span class="keywordflow">not</span> command:
<a name="l00935"></a>00935             <span class="keywordflow">raise</span> Exception(<span class="stringliteral">&#39;empty command given&#39;</span>)
<a name="l00936"></a>00936         
<a name="l00937"></a>00937         path = <span class="keywordtype">None</span>
<a name="l00938"></a>00938         <span class="keywordflow">if</span> isinstance(command, (list, tuple)):
<a name="l00939"></a>00939             <span class="keywordflow">for</span> i <span class="keywordflow">in</span> command:
<a name="l00940"></a>00940                 <span class="keywordflow">if</span> i == 0:
<a name="l00941"></a>00941                     cmd = command[i]
<a name="l00942"></a>00942                     <span class="comment"># In the php-Version, escapeshellcmd is called here.</span>
<a name="l00943"></a>00943                     <span class="comment"># Python claims to handle arguments securely.</span>
<a name="l00944"></a>00944                     path = command[i]
<a name="l00945"></a>00945                 <span class="keywordflow">else</span>:
<a name="l00946"></a>00946                     cmd = cmd + <span class="stringliteral">&#39; &#39;</span> + str(command[i])
<a name="l00947"></a>00947                     <span class="comment"># Here the same with escapeshellarg</span>
<a name="l00948"></a>00948         <span class="keywordflow">else</span>:
<a name="l00949"></a>00949             m = re.search(
<a name="l00950"></a>00950               <span class="stringliteral">&#39;!^ *([-_a-zA-Z0-9.\\\\/]+)( [^&quot;\&#39;|&lt;&gt;]$|$)!&#39;</span>, command)
<a name="l00951"></a>00951             <span class="keywordflow">if</span> m:
<a name="l00952"></a>00952                 path = m.group(1)
<a name="l00953"></a>00953             cmd = command.strip()
<a name="l00954"></a>00954              
<a name="l00955"></a>00955         
<a name="l00956"></a>00956         <span class="keywordflow">if</span> path:
<a name="l00957"></a>00957             <span class="keywordflow">if</span> <span class="keywordflow">not</span> os.path.exists(path):
<a name="l00958"></a>00958                 <span class="keywordflow">raise</span> <a class="code" href="classgp_1_1client_1_1gp_client_exception.html">gpClientException</a>(<span class="stringliteral">&#39;file does not exist: &#39;</span> + path)
<a name="l00959"></a>00959             <span class="keywordflow">if</span> <span class="keywordflow">not</span> os.access(path, os.R_OK):
<a name="l00960"></a>00960                 <span class="keywordflow">raise</span> <a class="code" href="classgp_1_1client_1_1gp_client_exception.html">gpClientException</a>(<span class="stringliteral">&#39;file is not readable: &#39;</span> + path)
<a name="l00961"></a>00961             <span class="keywordflow">if</span> <span class="keywordflow">not</span> os.access(path, os.X_OK):
<a name="l00962"></a>00962                 <span class="keywordflow">raise</span> <a class="code" href="classgp_1_1client_1_1gp_client_exception.html">gpClientException</a>(<span class="stringliteral">&#39;file is not executable: &#39;</span> + path)
<a name="l00963"></a>00963         
<a name="l00964"></a>00964         <span class="keywordflow">return</span> cmd
<a name="l00965"></a>00965     
<a name="l00966"></a><a class="code" href="classgp_1_1client_1_1_slave_transport.html#aea57c9df9730672e5fe5378a6e4e75ce">00966</a>     <span class="keyword">def </span><a class="code" href="classgp_1_1client_1_1_slave_transport.html#aea57c9df9730672e5fe5378a6e4e75ce">connect</a>(self):
<a name="l00967"></a>00967         <span class="stringliteral">&quot;&quot;&quot;Connects to the slave instance of GraphCore</span>
<a name="l00968"></a>00968 <span class="stringliteral"></span>
<a name="l00969"></a>00969 <span class="stringliteral">        launched using the command provided to the constructor.</span>
<a name="l00970"></a>00970 <span class="stringliteral">        proc_open() is used to launch the child process.</span>
<a name="l00971"></a>00971 <span class="stringliteral">     </span>
<a name="l00972"></a>00972 <span class="stringliteral">        @throws gpClientException if the command executable could not be found.</span>
<a name="l00973"></a>00973 <span class="stringliteral">        @throws gpProtocolException if the child process could not be launched.</span>
<a name="l00974"></a>00974 <span class="stringliteral">     </span>
<a name="l00975"></a>00975 <span class="stringliteral">        @todo handle output to stderr!</span>
<a name="l00976"></a>00976 <span class="stringliteral">        @todo get rid of the &quot;wait 1/10 of a second and check&quot; hack</span>
<a name="l00977"></a>00977 <span class="stringliteral">    </span>
<a name="l00978"></a>00978 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l00979"></a>00979         cmd = self.<a class="code" href="classgp_1_1client_1_1_slave_transport.html#a7dcfc1e9209eb4192081422f6b7f3094">makeCommand</a>(self.<a class="code" href="classgp_1_1client_1_1_slave_transport.html#a7cb3afc54963e1b63e647e61606c21f2">command</a>)
<a name="l00980"></a>00980         <span class="keywordflow">try</span>:
<a name="l00981"></a>00981             <span class="comment">#pexpect.spawn(cmd,cwd=self.cwd,env=self.env) </span>
<a name="l00982"></a>00982             <span class="comment"># pty.spawn(cmd, self.hin, self.hout)</span>
<a name="l00983"></a>00983             self.<a class="code" href="classgp_1_1client_1_1_slave_transport.html#af68d413e59a4f445e67f9ee945c3ea97">process</a> = subprocess.Popen(cmd, cwd=self.<a class="code" href="classgp_1_1client_1_1_slave_transport.html#a585995c1cead2f5b366d8340cfc9afff">cwd</a>, env=self.<a class="code" href="classgp_1_1client_1_1_slave_transport.html#a2b193ae5f3180bc02ff1578cee0dcecc">env</a>, stdin = subprocess.PIPE, stdout = subprocess.PIPE, stderr = subprocess.STDOUT) 
<a name="l00984"></a>00984             
<a name="l00985"></a>00985             self.<a class="code" href="classgp_1_1client_1_1_slave_transport.html#aee86ff289bd5ba721bc07e1ecca3617d">hin</a> = self.<a class="code" href="classgp_1_1client_1_1_slave_transport.html#af68d413e59a4f445e67f9ee945c3ea97">process</a>.stdout
<a name="l00986"></a>00986             self.<a class="code" href="classgp_1_1client_1_1_slave_transport.html#aadd0518548b3426c95c1c8d6173df28f">hout</a> = self.<a class="code" href="classgp_1_1client_1_1_slave_transport.html#af68d413e59a4f445e67f9ee945c3ea97">process</a>.stdin
<a name="l00987"></a>00987             
<a name="l00988"></a>00988         <span class="keywordflow">except</span> Exception <span class="keyword">as</span> ex:
<a name="l00989"></a>00989             self.trace(__function__(), <span class="stringliteral">&quot;failed to execute %s&quot;</span> % str(self.<a class="code" href="classgp_1_1client_1_1_slave_transport.html#a7cb3afc54963e1b63e647e61606c21f2">command</a>))
<a name="l00990"></a>00990             <span class="keywordflow">raise</span> <a class="code" href="classgp_1_1client_1_1gp_protocol_exception.html">gpProtocolException</a>(<span class="stringliteral">&quot;failed to execute %s&quot;</span> % str(self.<a class="code" href="classgp_1_1client_1_1_slave_transport.html#a7cb3afc54963e1b63e647e61606c21f2">command</a>))
<a name="l00991"></a>00991         
<a name="l00992"></a>00992         self.trace(__function__(), <span class="stringliteral">&quot;executing command &quot;</span>
<a name="l00993"></a>00993           + str(self.<a class="code" href="classgp_1_1client_1_1_slave_transport.html#a7cb3afc54963e1b63e647e61606c21f2">command</a>) + <span class="stringliteral">&quot; as %s&quot;</span> % str(self.<a class="code" href="classgp_1_1client_1_1_slave_transport.html#af68d413e59a4f445e67f9ee945c3ea97">process</a>))
<a name="l00994"></a>00994                 
<a name="l00995"></a>00995         self.trace(__function__(), <span class="stringliteral">&quot;reading from %s&quot;</span> % str(self.<a class="code" href="classgp_1_1client_1_1_slave_transport.html#aee86ff289bd5ba721bc07e1ecca3617d">hin</a>))
<a name="l00996"></a>00996         self.trace(__function__(), <span class="stringliteral">&quot;writing to %s&quot;</span> % str(self.<a class="code" href="classgp_1_1client_1_1_slave_transport.html#aadd0518548b3426c95c1c8d6173df28f">hout</a>))
<a name="l00997"></a>00997         
<a name="l00998"></a>00998         <span class="comment">#time.sleep(0.1)</span>
<a name="l00999"></a>00999         <span class="comment"># XXX: NASTY HACK!</span>
<a name="l01000"></a>01000         <span class="comment"># wait 1/10th of a second to see if the command actually starts</span>
<a name="l01001"></a>01001         
<a name="l01002"></a>01002         self.<a class="code" href="classgp_1_1client_1_1_slave_transport.html#a5635fec815191deadd28dfaa734fe748">checkPeer</a>()
<a name="l01003"></a>01003         
<a name="l01004"></a>01004         <span class="keywordflow">return</span> <span class="keyword">True</span>
<a name="l01005"></a>01005 
<a name="l01006"></a>01006     @staticmethod
<a name="l01007"></a>01007     <span class="keyword">def </span>send_to(a,b):
<a name="l01008"></a>01008         <span class="keywordflow">raise</span> NotImplementdError(
<a name="l01009"></a>01009           <span class="stringliteral">&quot;send_to should not be called for a SlaveTransport object.&quot;</span>)
<a name="l01010"></a>01010     
<a name="l01011"></a><a class="code" href="classgp_1_1client_1_1_slave_transport.html#a6725a3f8474b79e3a36849502e530453">01011</a>     <span class="keyword">def </span><a class="code" href="classgp_1_1client_1_1_slave_transport.html#a6725a3f8474b79e3a36849502e530453">close</a>(self):
<a name="l01012"></a>01012         <span class="stringliteral">&quot;&quot;&quot;Close transport by terminating slave process using Popen.terminate().&quot;&quot;&quot;</span>
<a name="l01013"></a>01013         
<a name="l01014"></a>01014         <span class="comment">#PipeTransport.close(self) #XXX: call parent to close pipes?!</span>
<a name="l01015"></a>01015         
<a name="l01016"></a>01016         <span class="keywordflow">if</span> <span class="keywordflow">not</span> self.<a class="code" href="classgp_1_1client_1_1_slave_transport.html#af68d413e59a4f445e67f9ee945c3ea97">process</a>:
<a name="l01017"></a>01017             <span class="keywordflow">return</span> <span class="keyword">False</span>
<a name="l01018"></a>01018         
<a name="l01019"></a>01019         self.process.terminate()
<a name="l01020"></a>01020         self.process.wait()
<a name="l01021"></a>01021         
<a name="l01022"></a>01022         self.<a class="code" href="classgp_1_1client_1_1_slave_transport.html#af68d413e59a4f445e67f9ee945c3ea97">process</a> = <span class="keyword">False</span>
<a name="l01023"></a>01023         self.<a class="code" href="classgp_1_1client_1_1_slave_transport.html#a96ede126c37fd5cb103a254293f98b22">closed</a> = <span class="keyword">True</span>
<a name="l01024"></a>01024     
<a name="l01025"></a><a class="code" href="classgp_1_1client_1_1_slave_transport.html#a5635fec815191deadd28dfaa734fe748">01025</a>     <span class="keyword">def </span><a class="code" href="classgp_1_1client_1_1_slave_transport.html#a5635fec815191deadd28dfaa734fe748">checkPeer</a>(self):
<a name="l01026"></a>01026         <span class="stringliteral">&quot;&quot;&quot;Check if slave process is still alive using Popen.poll().</span>
<a name="l01027"></a>01027 <span class="stringliteral"></span>
<a name="l01028"></a>01028 <span class="stringliteral">        @throws gpProtocolException if the slave process is dead.</span>
<a name="l01029"></a>01029 <span class="stringliteral"></span>
<a name="l01030"></a>01030 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l01031"></a>01031         
<a name="l01032"></a>01032         code = self.process.poll()
<a name="l01033"></a>01033         <span class="keywordflow">if</span> code <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:
<a name="l01034"></a>01034             <span class="keywordflow">raise</span> <a class="code" href="classgp_1_1client_1_1gp_protocol_exception.html">gpProtocolException</a>(<span class="stringliteral">&#39;slave process is not running! exit code &#39;</span> + code)
<a name="l01035"></a>01035             
<a name="l01036"></a>01036 
<a name="l01037"></a><a class="code" href="classgp_1_1client_1_1_connection.html">01037</a> <span class="keyword">class </span><a class="code" href="classgp_1_1client_1_1_connection.html">Connection</a>(object):
<a name="l01038"></a>01038     <span class="stringliteral">&quot;&quot;&quot;This class represents an active connection to a graph.</span>
<a name="l01039"></a>01039 <span class="stringliteral"></span>
<a name="l01040"></a>01040 <span class="stringliteral">    It can be seen</span>
<a name="l01041"></a>01041 <span class="stringliteral">    as the local interface to the graph that allows the graph to be</span>
<a name="l01042"></a>01042 <span class="stringliteral">    queried and manipulated, using the command set specified for GraphCore</span>
<a name="l01043"></a>01043 <span class="stringliteral">    and GraphServ. The communication with the peer process that manages</span>
<a name="l01044"></a>01044 <span class="stringliteral">    the actual graph (a slave GraphCore instance or a remote GraphCore</span>
<a name="l01045"></a>01045 <span class="stringliteral">    server) is performed by an instance of the appropriate subclass of</span>
<a name="l01046"></a>01046 <span class="stringliteral">    Transport.</span>
<a name="l01047"></a>01047 <span class="stringliteral">    </span>
<a name="l01048"></a>01048 <span class="stringliteral">    Instances of Connection that use the appropriate transport can be</span>
<a name="l01049"></a>01049 <span class="stringliteral">    created conveniently using the static factory methods called</span>
<a name="l01050"></a>01050 <span class="stringliteral">    new_xxx_connection.</span>
<a name="l01051"></a>01051 <span class="stringliteral">    </span>
<a name="l01052"></a>01052 <span class="stringliteral">    Besides some methods for managing the connection and some utility</span>
<a name="l01053"></a>01053 <span class="stringliteral">    functions, Connection exposes the GraphCore and GraphServ command</span>
<a name="l01054"></a>01054 <span class="stringliteral">    sets. The commands are exposed as &quot;virtual&quot; methods: they are not</span>
<a name="l01055"></a>01055 <span class="stringliteral">    implemented explicitely, instead, the __getattr__() method is used to map</span>
<a name="l01056"></a>01056 <span class="stringliteral">    method calls to GraphCore commands. No local checks are performed on</span>
<a name="l01057"></a>01057 <span class="stringliteral">    the command call, so it&#39;s up to the peer to decide which commands</span>
<a name="l01058"></a>01058 <span class="stringliteral">    exist. Note that this means that a Connection actually exposes more</span>
<a name="l01059"></a>01059 <span class="stringliteral">    commands if it is connected to a GraphServ instance (simply because</span>
<a name="l01060"></a>01060 <span class="stringliteral">    the peer then supports more commands).</span>
<a name="l01061"></a>01061 <span class="stringliteral">    </span>
<a name="l01062"></a>01062 <span class="stringliteral">    The mapping of method calls to commands is performed as follows:</span>
<a name="l01063"></a>01063 <span class="stringliteral">    </span>
<a name="l01064"></a>01064 <span class="stringliteral">      * underscores are converted to dashes: the method add_arcs</span>
<a name="l01065"></a>01065 <span class="stringliteral">        corresponds to the add-arcs command in GraphCore. </span>
<a name="l01066"></a>01066 <span class="stringliteral">    </span>
<a name="l01067"></a>01067 <span class="stringliteral">      * any int or string parameters passed to the method are passed on</span>
<a name="l01068"></a>01068 <span class="stringliteral">        to the command call, in the order they were specified.</span>
<a name="l01069"></a>01069 <span class="stringliteral">    </span>
<a name="l01070"></a>01070 <span class="stringliteral">      * parameters that are instances of DataSource will be used to pass</span>
<a name="l01071"></a>01071 <span class="stringliteral">        a data set to the command. That is, rows from the data source are</span>
<a name="l01072"></a>01072 <span class="stringliteral">        passed to the command as input.</span>
<a name="l01073"></a>01073 <span class="stringliteral">    </span>
<a name="l01074"></a>01074 <span class="stringliteral">      * parameters that are instances of DataSink will be used to handle</span>
<a name="l01075"></a>01075 <span class="stringliteral">        any data the command outputs. That is, rows from the command&#39;s</span>
<a name="l01076"></a>01076 <span class="stringliteral">        output data set will be passed to the data sink, one by one.</span>
<a name="l01077"></a>01077 <span class="stringliteral">    </span>
<a name="l01078"></a>01078 <span class="stringliteral">      * parameters that are arrays are wrapped in a new instance of</span>
<a name="l01079"></a>01079 <span class="stringliteral">        ArraySource and used as input for the command, as described</span>
<a name="l01080"></a>01080 <span class="stringliteral">        above. This is convenient for passing data directly to the</span>
<a name="l01081"></a>01081 <span class="stringliteral">        command.</span>
<a name="l01082"></a>01082 <span class="stringliteral">    </span>
<a name="l01083"></a>01083 <span class="stringliteral">      * parameters given as None or False are ignored.</span>
<a name="l01084"></a>01084 <span class="stringliteral">    </span>
<a name="l01085"></a>01085 <span class="stringliteral">      * other types of arguments trigger a gpUsageException</span>
<a name="l01086"></a>01086 <span class="stringliteral">    </span>
<a name="l01087"></a>01087 <span class="stringliteral">    A command called in this way, using its &quot;plain&quot; method counterpart,</span>
<a name="l01088"></a>01088 <span class="stringliteral">    always returns the status string from the peer&#39;s response upon</span>
<a name="l01089"></a>01089 <span class="stringliteral">    successful execution. The status may be &quot;OK&quot; or &quot;NONE&quot;. Any failure on</span>
<a name="l01090"></a>01090 <span class="stringliteral">    the server side triggers a gpProcessorException. Any output of the</span>
<a name="l01091"></a>01091 <span class="stringliteral">    command is passed to the DataSink that was provided as a parameter</span>
<a name="l01092"></a>01092 <span class="stringliteral">    (or ignored if no sink was provided).</span>
<a name="l01093"></a>01093 <span class="stringliteral">    </span>
<a name="l01094"></a>01094 <span class="stringliteral">    However, modifiers can be attached to the method name to cause the</span>
<a name="l01095"></a>01095 <span class="stringliteral">    command&#39;s outcome to be treated differently:</span>
<a name="l01096"></a>01096 <span class="stringliteral">    </span>
<a name="l01097"></a>01097 <span class="stringliteral">      * if the method name is prefixed with &quot;try_&quot;, no</span>
<a name="l01098"></a>01098 <span class="stringliteral">        gpProcessorException are thrown. Instead, errors reported by the</span>
<a name="l01099"></a>01099 <span class="stringliteral">        peer cause the method to return false. The cause of the error may</span>
<a name="l01100"></a>01100 <span class="stringliteral">        be examined using the getStatus() and getStatusMessage() methods.</span>
<a name="l01101"></a>01101 <span class="stringliteral">        Note that other exceptions like gpProtocollException or</span>
<a name="l01102"></a>01102 <span class="stringliteral">        gpUsageException are still thrown as usual.</span>
<a name="l01103"></a>01103 <span class="stringliteral">    </span>
<a name="l01104"></a>01104 <span class="stringliteral">      * if the method name is prefixed with &quot;capture_&quot;, the command&#39;s</span>
<a name="l01105"></a>01105 <span class="stringliteral">        output is collected and returned as an array of arrays,</span>
<a name="l01106"></a>01106 <span class="stringliteral">        representing the rows of data. If the command fails, a</span>
<a name="l01107"></a>01107 <span class="stringliteral">        gpProcessorException is raised, as usual (or, if try_ is also</span>
<a name="l01108"></a>01108 <span class="stringliteral">        specified, the method returns false).</span>
<a name="l01109"></a>01109 <span class="stringliteral">    </span>
<a name="l01110"></a>01110 <span class="stringliteral">      * if the method name is suffixed with &quot;_map&quot; AND prefixed with</span>
<a name="l01111"></a>01111 <span class="stringliteral">        &quot;capture_&quot;, the command&#39;s output is collected and returned as an</span>
<a name="l01112"></a>01112 <span class="stringliteral">        associative array. This is especially useful for commands like</span>
<a name="l01113"></a>01113 <span class="stringliteral">        &quot;stats&quot; that provide values for set of well known properties.</span>
<a name="l01114"></a>01114 <span class="stringliteral">        To build the associative array, rows from the output are</span>
<a name="l01115"></a>01115 <span class="stringliteral">        interpreted as a key-value pairs. If the _map suffix is used</span>
<a name="l01116"></a>01116 <span class="stringliteral">        without the capture_ prefix, a gpUsageException is raised.</span>
<a name="l01117"></a>01117 <span class="stringliteral">    </span>
<a name="l01118"></a>01118 <span class="stringliteral">    Modifiers can also be combined. For instance, try_capture_stats_map</span>
<a name="l01119"></a>01119 <span class="stringliteral">    would return GraphCore stats as an associative array, or null of the</span>
<a name="l01120"></a>01120 <span class="stringliteral">    call failed.</span>
<a name="l01121"></a>01121 <span class="stringliteral">    </span>
<a name="l01122"></a>01122 <span class="stringliteral">    Additional modifiers or extra virtual methods can be added by</span>
<a name="l01123"></a>01123 <span class="stringliteral">    subclasses by overriding the __getattr__() method or by registering</span>
<a name="l01124"></a>01124 <span class="stringliteral">    handlers with the addCallHandler() or addExecHandler() methods.</span>
<a name="l01125"></a>01125 <span class="stringliteral"></span>
<a name="l01126"></a>01126 <span class="stringliteral">    &quot;&quot;&quot;</span>
<a name="l01127"></a>01127 
<a name="l01128"></a>01128     
<a name="l01129"></a>01129     
<a name="l01130"></a><a class="code" href="classgp_1_1client_1_1_connection.html#a65fc1c230cc13e9c7c1f6064fef94a07">01130</a>     <span class="keyword">def </span><a class="code" href="classgp_1_1client_1_1_connection.html#a65fc1c230cc13e9c7c1f6064fef94a07">__init__</a>( self, transport=None, graphname = None ):
<a name="l01131"></a>01131         <span class="stringliteral">&quot;&quot;&quot;Initialize a new connection with the given instance of</span>
<a name="l01132"></a>01132 <span class="stringliteral">        Transport.</span>
<a name="l01133"></a>01133 <span class="stringliteral">    </span>
<a name="l01134"></a>01134 <span class="stringliteral">        Note: Instances of Connection that use the appropriate</span>
<a name="l01135"></a>01135 <span class="stringliteral">        transport can ba e created conveniently using the static</span>
<a name="l01136"></a>01136 <span class="stringliteral">        factory methods called new_xxx_connection.</span>
<a name="l01137"></a>01137 <span class="stringliteral">        </span>
<a name="l01138"></a>01138 <span class="stringliteral">        @rtype: None</span>
<a name="l01139"></a>01139 <span class="stringliteral"></span>
<a name="l01140"></a>01140 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l01141"></a>01141         self.<a class="code" href="classgp_1_1client_1_1_connection.html#a22a0ffa70fe19137bcd254fd9fbf91e7">transport</a> = transport
<a name="l01142"></a>01142         <span class="stringliteral">&quot;&quot;&quot;The transport used to communicate with the peer that manages the</span>
<a name="l01143"></a>01143 <span class="stringliteral">        actual graph.&quot;&quot;&quot;</span>
<a name="l01144"></a>01144         <span class="comment">#? Should the type of transport be checked?</span>
<a name="l01145"></a>01145         <span class="comment">#? EAFP: no. (easier to ask for forgiveness than permission)        </span>
<a name="l01146"></a>01146         self.<a class="code" href="classgp_1_1client_1_1_connection.html#a3bfe981d1c95c8ca45fae1b67350e51c">tainted</a> = <span class="keyword">False</span>
<a name="l01147"></a>01147         <span class="stringliteral">&quot;&quot;&quot;If true, the protocol session is &quot;out of step&quot; and no further</span>
<a name="l01148"></a>01148 <span class="stringliteral">        commands can be processed.&quot;&quot;&quot;</span>
<a name="l01149"></a>01149         self.<a class="code" href="classgp_1_1client_1_1_connection.html#a67ad2b42739bd0e1355499f7c712b0f3">status</a> = <span class="keywordtype">None</span>
<a name="l01150"></a>01150         <span class="stringliteral">&quot;&quot;&quot;The status string returned by the last command call.&quot;&quot;&quot;</span>
<a name="l01151"></a>01151         self.<a class="code" href="classgp_1_1client_1_1_connection.html#ae0752c5504ac55bce67978a91a9a845e">statusMessage</a> = <span class="keywordtype">None</span>
<a name="l01152"></a>01152         <span class="stringliteral">&quot;&quot;&quot;The status message returned by the last command call.&quot;&quot;&quot;</span>
<a name="l01153"></a>01153         self.<a class="code" href="classgp_1_1client_1_1_connection.html#a845bb6cd14500a6a87ef563fb713d326">response</a> = <span class="keywordtype">None</span>
<a name="l01154"></a>01154         <span class="stringliteral">&quot;&quot;&quot;The response from the last command call, including the status</span>
<a name="l01155"></a>01155 <span class="stringliteral">        string and status message.&quot;&quot;&quot;</span>
<a name="l01156"></a>01156         self.<a class="code" href="classgp_1_1client_1_1_connection.html#a684389288f3a7a8ace8457b1f543bc8c">call_handlers</a> = []
<a name="l01157"></a>01157         <span class="stringliteral">&quot;&quot;&quot;call handlers, see addCallHandler()&quot;&quot;&quot;</span>
<a name="l01158"></a>01158         self.<a class="code" href="classgp_1_1client_1_1_connection.html#a60e020b9994d619124ac8a869bb707a7">exec_handlers</a> = []
<a name="l01159"></a>01159         <span class="stringliteral">&quot;&quot;&quot;Exec handlers, see addExecHandler().&quot;&quot;&quot;</span>
<a name="l01160"></a>01160         self.<a class="code" href="classgp_1_1client_1_1_connection.html#a32ce5de353680ba77d80f584da385b02">allowPipes</a> = <span class="keyword">False</span>
<a name="l01161"></a>01161         <span class="stringliteral">&quot;&quot;&quot;If peer-side input and output redirection should be allowed. For</span>
<a name="l01162"></a>01162 <span class="stringliteral">        security reasons, and to avoid confusion, i/o redirection is disabled</span>
<a name="l01163"></a>01163 <span class="stringliteral">        per default.&quot;&quot;&quot;</span>
<a name="l01164"></a>01164         self.<a class="code" href="classgp_1_1client_1_1_connection.html#a059870364204106178f16d13d85343cb">strictArguments</a> = <span class="keyword">True</span>
<a name="l01165"></a>01165         <span class="stringliteral">&quot;&quot;&quot;Whether arguments should be restricted to alphanumeric strings.</span>
<a name="l01166"></a>01166 <span class="stringliteral">        Enabled by default.&quot;&quot;&quot;</span>
<a name="l01167"></a>01167         self.<a class="code" href="classgp_1_1client_1_1_connection.html#a5916a7a275ebac7db2c09e676eef752c">__command_has_output</a> = <span class="keywordtype">None</span>
<a name="l01168"></a>01168         <span class="stringliteral">&quot;&quot;&quot;wheather the command performed by execute() has generated</span>
<a name="l01169"></a>01169 <span class="stringliteral">        output&quot;&quot;&quot;</span>
<a name="l01170"></a>01170         self.<a class="code" href="classgp_1_1client_1_1_connection.html#a6b2e9176f75a4fd81be646d651c9c9e6">debug</a> = <span class="keyword">False</span>
<a name="l01171"></a>01171         <span class="stringliteral">&quot;&quot;&quot;Debug mode enables lots of output to stdout.&quot;&quot;&quot;</span>
<a name="l01172"></a>01172         self.<a class="code" href="classgp_1_1client_1_1_connection.html#a4b08c5a61efba99f7482199223c2e9fb">graphname</a> = graphname <span class="comment">#TODO: port this to PHP</span>
<a name="l01173"></a>01173         
<a name="l01174"></a>01174         self.<a class="code" href="classgp_1_1client_1_1_connection.html#abbefa69dcbb23510a8f277169bdbf75e">_protocol_version</a> = <span class="keywordtype">None</span>
<a name="l01175"></a>01175  
<a name="l01176"></a><a class="code" href="classgp_1_1client_1_1_connection.html#ab00973f3ffd83d4ffdd7dc7e9fa2f294">01176</a>     <span class="keyword">def </span><a class="code" href="classgp_1_1client_1_1_connection.html#ab00973f3ffd83d4ffdd7dc7e9fa2f294">connect</a>(self):
<a name="l01177"></a>01177         <span class="stringliteral">&quot;&quot;&quot; Connect to the peer. </span>
<a name="l01178"></a>01178 <span class="stringliteral">    </span>
<a name="l01179"></a>01179 <span class="stringliteral">        For connecting, this method relies solely on the transport</span>
<a name="l01180"></a>01180 <span class="stringliteral">        instance, which in turn uses the information passed to its</span>
<a name="l01181"></a>01181 <span class="stringliteral">        constructor to establish the connection.</span>
<a name="l01182"></a>01182 <span class="stringliteral">    </span>
<a name="l01183"></a>01183 <span class="stringliteral">        After connecting, this method calls checkProtocolVersion()</span>
<a name="l01184"></a>01184 <span class="stringliteral">        to make sure the peer speaks the correct protocol version.</span>
<a name="l01185"></a>01185 <span class="stringliteral">        If not, a gpProtocolException is raised.</span>
<a name="l01186"></a>01186 <span class="stringliteral">        </span>
<a name="l01187"></a>01187 <span class="stringliteral">        @rtype: None</span>
<a name="l01188"></a>01188 <span class="stringliteral">   </span>
<a name="l01189"></a>01189 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l01190"></a>01190         self.transport.connect()
<a name="l01191"></a>01191         self.<a class="code" href="classgp_1_1client_1_1_connection.html#ad4b1fbc71cc1ef9223ba7b987ab9d937">checkProtocolVersion</a>()
<a name="l01192"></a>01192         
<a name="l01193"></a>01193         <span class="keywordflow">if</span> self.<a class="code" href="classgp_1_1client_1_1_connection.html#a4b08c5a61efba99f7482199223c2e9fb">graphname</a>: <span class="comment">#TODO: port this to PHP</span>
<a name="l01194"></a>01194             self.use_graph( self.<a class="code" href="classgp_1_1client_1_1_connection.html#a4b08c5a61efba99f7482199223c2e9fb">graphname</a> )
<a name="l01195"></a>01195          
<a name="l01196"></a><a class="code" href="classgp_1_1client_1_1_connection.html#a4fc138caecd9da573681ef472835e0e0">01196</a>     <span class="keyword">def </span><a class="code" href="classgp_1_1client_1_1_connection.html#a4fc138caecd9da573681ef472835e0e0">addCallHandler</a>( self, handler ): <span class="comment">#OK</span>
<a name="l01197"></a>01197         <span class="stringliteral">&quot;&quot;&quot;Register a call handler.</span>
<a name="l01198"></a>01198 <span class="stringliteral">        </span>
<a name="l01199"></a>01199 <span class="stringliteral">        The handler will be called before __getattr__ interprets a</span>
<a name="l01200"></a>01200 <span class="stringliteral">        method call as a GraphCore command, and can be used to add</span>
<a name="l01201"></a>01201 <span class="stringliteral">        support for additional virtual methods or extra modifiers.</span>
<a name="l01202"></a>01202 <span class="stringliteral">    </span>
<a name="l01203"></a>01203 <span class="stringliteral">        The handler must be a callable with the following signature:</span>
<a name="l01204"></a>01204 <span class="stringliteral">        handler(connection, {&#39;command&#39;: ..., &#39;args&#39;: ..., &#39;source&#39;: ...,</span>
<a name="l01205"></a>01205 <span class="stringliteral">                &#39;sink&#39;: ..., &#39;capture&#39;: ..., &#39;result&#39;: ...})</span>
<a name="l01206"></a>01206 <span class="stringliteral">        i.e. it accepts the varible connection</span>
<a name="l01207"></a>01207 <span class="stringliteral">        (this Connection instance) and a dictionary with the</span>
<a name="l01208"></a>01208 <span class="stringliteral">        following keys:</span>
<a name="l01209"></a>01209 <span class="stringliteral">    </span>
<a name="l01210"></a>01210 <span class="stringliteral">        * &#39;command&#39; a reference to the command name, as a string, with</span>
<a name="l01211"></a>01211 <span class="stringliteral">          the try_, capture_ and _map modifiers removed.  </span>
<a name="l01212"></a>01212 <span class="stringliteral">        * &#39;arguments&#39; a reference to the argument array, unprocessed, as </span>
<a name="l01213"></a>01213 <span class="stringliteral">          passed to the method.</span>
<a name="l01214"></a>01214 <span class="stringliteral">        * &#39;source&#39; a reference to a DataSource (or None), may be </span>
<a name="l01215"></a>01215 <span class="stringliteral">          altered to change the command&#39;s input.</span>
<a name="l01216"></a>01216 <span class="stringliteral">        * &#39;sink&#39; a reference to a DatSink (or null), may be altered to </span>
<a name="l01217"></a>01217 <span class="stringliteral">          change the output handling for the command.</span>
<a name="l01218"></a>01218 <span class="stringliteral">        * &#39;capture&#39; a reference to the capture flag. If true, output </span>
<a name="l01219"></a>01219 <span class="stringliteral">          will be captured and returned as an array.</span>
<a name="l01220"></a>01220 <span class="stringliteral">        * &#39;result&#39; the result to return from the method call, used </span>
<a name="l01221"></a>01221 <span class="stringliteral">          only if the handler returns false.</span>
<a name="l01222"></a>01222 <span class="stringliteral">        * If the handler returns false, the value of &#39;result&#39; will be </span>
<a name="l01223"></a>01223 <span class="stringliteral">          returned from __getattr__ and no further action is taken.</span>
<a name="l01224"></a>01224 <span class="stringliteral">        </span>
<a name="l01225"></a>01225 <span class="stringliteral">        </span>
<a name="l01226"></a>01226 <span class="stringliteral">        @rtype: None</span>
<a name="l01227"></a>01227 <span class="stringliteral">        </span>
<a name="l01228"></a>01228 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l01229"></a>01229         self.call_handlers.append( handler )
<a name="l01230"></a>01230          
<a name="l01231"></a><a class="code" href="classgp_1_1client_1_1_connection.html#a9ef01f87b14a7ae03021ffffcc1fbada">01231</a>     <span class="keyword">def </span><a class="code" href="classgp_1_1client_1_1_connection.html#a9ef01f87b14a7ae03021ffffcc1fbada">addExecHandler</a>(self, handler): <span class="comment">#OK</span>
<a name="l01232"></a>01232         <span class="stringliteral">&quot;&quot;&quot;Register a call handler.</span>
<a name="l01233"></a>01233 <span class="stringliteral">    </span>
<a name="l01234"></a>01234 <span class="stringliteral">        # handler(connection, {&#39;command&#39;: ..., &#39;source&#39;: ...,</span>
<a name="l01235"></a>01235 <span class="stringliteral">        #         &#39;sink&#39;: ..., &#39;has_output&#39;: ..., &#39;status&#39;: ...})</span>
<a name="l01236"></a>01236 <span class="stringliteral">        #? I don&#39;t understand the first argument. It&#39;s not used in gpMySQL.php.    </span>
<a name="l01237"></a>01237 <span class="stringliteral">    </span>
<a name="l01238"></a>01238 <span class="stringliteral">        The handler will be called before __getattr__ passes a command</span>
<a name="l01239"></a>01239 <span class="stringliteral">        to the execute() method, and can thus be used to add support</span>
<a name="l01240"></a>01240 <span class="stringliteral">        for additional &quot;artificial&quot; commands that use the same parameter</span>
<a name="l01241"></a>01241 <span class="stringliteral">        handling as is used for &quot;real&quot; GraphCore commands.</span>
<a name="l01242"></a>01242 <span class="stringliteral">        </span>
<a name="l01243"></a>01243 <span class="stringliteral">        The handler must be a callable that accepts the varible connection</span>
<a name="l01244"></a>01244 <span class="stringliteral">        (this Connection instance) and a dictionary with the</span>
<a name="l01245"></a>01245 <span class="stringliteral">        following keys:</span>
<a name="l01246"></a>01246 <span class="stringliteral">    </span>
<a name="l01247"></a>01247 <span class="stringliteral">          * &#39;command&#39; a refference to the command, as an array.</span>
<a name="l01248"></a>01248 <span class="stringliteral">            The first field is the command name,</span>
<a name="l01249"></a>01249 <span class="stringliteral">            the remaining fields contain the parameters for the command.</span>
<a name="l01250"></a>01250 <span class="stringliteral">          * &#39;source&#39; a reference to a gpDatSource (or null), may be altered to </span>
<a name="l01251"></a>01251 <span class="stringliteral">            change the command&#39;s input.</span>
<a name="l01252"></a>01252 <span class="stringliteral">          * &#39;sink&#39; a reference to a gpDatSink (or null), may be altered to </span>
<a name="l01253"></a>01253 <span class="stringliteral">            change the output handlking for the command.</span>
<a name="l01254"></a>01254 <span class="stringliteral">          * &#39;status&#39; the commands return status, used of the handler</span>
<a name="l01255"></a>01255 <span class="stringliteral">            returns false.</span>
<a name="l01256"></a>01256 <span class="stringliteral">         </span>
<a name="l01257"></a>01257 <span class="stringliteral">        If the handler returns false, the value of $status will be used as the</span>
<a name="l01258"></a>01258 <span class="stringliteral">        command&#39;s result, and no command will be sent to the peer. The value</span>
<a name="l01259"></a>01259 <span class="stringliteral">        of $status is treated the same way the status returned from the peer is:</span>
<a name="l01260"></a>01260 <span class="stringliteral">        e.g. a gpProcessorException is thrown if the status is &quot;FAILED&quot;, etc.</span>
<a name="l01261"></a>01261 <span class="stringliteral">        Also, modifiers like capture_ are applied to the output in the same way</span>
<a name="l01262"></a>01262 <span class="stringliteral">        as they are for &quot;normal&quot; commands.</span>
<a name="l01263"></a>01263 <span class="stringliteral">        </span>
<a name="l01264"></a>01264 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l01265"></a>01265         self.exec_handlers.append(handler)
<a name="l01266"></a>01266          
<a name="l01267"></a>01267     
<a name="l01268"></a><a class="code" href="classgp_1_1client_1_1_connection.html#a88bfbb09b0246e445613f389057d9d6f">01268</a>     <span class="keyword">def </span><a class="code" href="classgp_1_1client_1_1_connection.html#a88bfbb09b0246e445613f389057d9d6f">getStatus</a>(self): <span class="comment">#? Not consistent with command call</span>
<a name="l01269"></a>01269         <span class="stringliteral">&quot;&quot;&quot;Return the status string that resulted from the last command call.</span>
<a name="l01270"></a>01270 <span class="stringliteral"></span>
<a name="l01271"></a>01271 <span class="stringliteral">        The status string is &#39;OK&#39; or &#39;NONE&#39; for successfull calls, or &#39;FAILED&#39;,</span>
<a name="l01272"></a>01272 <span class="stringliteral">        &#39;ERROR&#39; or &#39;DENIED&#39; for unsuccessful calls. Refer to the GraphCore and</span>
<a name="l01273"></a>01273 <span class="stringliteral">        GraphServ documentation for details.</span>
<a name="l01274"></a>01274 <span class="stringliteral">        </span>
<a name="l01275"></a>01275 <span class="stringliteral">        @rtype:  str</span>
<a name="l01276"></a>01276 <span class="stringliteral">        @return: the status string</span>
<a name="l01277"></a>01277 <span class="stringliteral">    </span>
<a name="l01278"></a>01278 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l01279"></a>01279         <span class="keywordflow">return</span> self.<a class="code" href="classgp_1_1client_1_1_connection.html#a67ad2b42739bd0e1355499f7c712b0f3">status</a>
<a name="l01280"></a>01280          
<a name="l01281"></a>01281     
<a name="l01282"></a><a class="code" href="classgp_1_1client_1_1_connection.html#a85513ace8e0720e7adc85d57578060af">01282</a>     <span class="keyword">def </span><a class="code" href="classgp_1_1client_1_1_connection.html#a85513ace8e0720e7adc85d57578060af">isClosed</a>(self): <span class="comment"># OK</span>
<a name="l01283"></a>01283         <span class="stringliteral">&quot;&quot;&quot;Tell if the connection is closed.</span>
<a name="l01284"></a>01284 <span class="stringliteral"></span>
<a name="l01285"></a>01285 <span class="stringliteral">        Returns true if close() was called on this connection, or it was closed for</span>
<a name="l01286"></a>01286 <span class="stringliteral">        some other reason. No commands can be called on a closed connection.</span>
<a name="l01287"></a>01287 <span class="stringliteral">    </span>
<a name="l01288"></a>01288 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l01289"></a>01289         <span class="keywordflow">return</span> self.transport.isClosed()
<a name="l01290"></a>01290          
<a name="l01291"></a>01291     
<a name="l01292"></a><a class="code" href="classgp_1_1client_1_1_connection.html#a64fe5f480845b83c82a94e04e015f9c0">01292</a>     <span class="keyword">def </span><a class="code" href="classgp_1_1client_1_1_connection.html#a64fe5f480845b83c82a94e04e015f9c0">getStatusMessage</a>(self): <span class="comment">#? Check if consistent with commandcall</span>
<a name="l01293"></a>01293         <span class="stringliteral">&quot;&quot;&quot;Return the status message that resulted from the last command call.</span>
<a name="l01294"></a>01294 <span class="stringliteral"></span>
<a name="l01295"></a>01295 <span class="stringliteral">        The status message is the informative message that follows the status</span>
<a name="l01296"></a>01296 <span class="stringliteral">        string in the response from a command call. It may be useful for human</span>
<a name="l01297"></a>01297 <span class="stringliteral">        eyes, but should not be processed programmatically.</span>
<a name="l01298"></a>01298 <span class="stringliteral">    </span>
<a name="l01299"></a>01299 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l01300"></a>01300         <span class="keywordflow">return</span> self.<a class="code" href="classgp_1_1client_1_1_connection.html#ae0752c5504ac55bce67978a91a9a845e">statusMessage</a>
<a name="l01301"></a>01301          
<a name="l01302"></a>01302     
<a name="l01303"></a><a class="code" href="classgp_1_1client_1_1_connection.html#a1d6d01f41be6cc846e493d02d0b37c1f">01303</a>     <span class="keyword">def </span><a class="code" href="classgp_1_1client_1_1_connection.html#a1d6d01f41be6cc846e493d02d0b37c1f">getResponse</a>(self): <span class="comment">#? Ceck command call.</span>
<a name="l01304"></a>01304         <span class="stringliteral">&quot;&quot;&quot;Return the response that the last command call evoked.</span>
<a name="l01305"></a>01305 <span class="stringliteral"></span>
<a name="l01306"></a>01306 <span class="stringliteral">        This consists of the status string and the status message.</span>
<a name="l01307"></a>01307 <span class="stringliteral">    </span>
<a name="l01308"></a>01308 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l01309"></a>01309         <span class="keywordflow">return</span> self.<a class="code" href="classgp_1_1client_1_1_connection.html#a845bb6cd14500a6a87ef563fb713d326">response</a>
<a name="l01310"></a>01310          
<a name="l01311"></a>01311     
<a name="l01312"></a>01312     <span class="keyword">def </span>_trace(self, context, msg, obj_type=&#39;nothing878423really&#39;): <span class="comment">#halbwegs OK</span>
<a name="l01313"></a>01313         <span class="stringliteral">&quot;&quot;&quot;Print messages to stdout when debug mode is enabled.&quot;&quot;&quot;</span>
<a name="l01314"></a>01314         <span class="keywordflow">if</span> self.<a class="code" href="classgp_1_1client_1_1_connection.html#a6b2e9176f75a4fd81be646d651c9c9e6">debug</a>:
<a name="l01315"></a>01315             <span class="keywordflow">if</span> obj_type != <span class="stringliteral">&#39;nothing878423really&#39;</span> <span class="keywordflow">and</span> obj_type != type(<span class="keywordtype">None</span>):
<a name="l01316"></a>01316                 <span class="comment">#? and... appears not in the php-version</span>
<a name="l01317"></a>01317                 <span class="comment">#? introduced due to lack of ...?...:... in Python.</span>
<a name="l01318"></a>01318                 <span class="comment">#? Makes all other code shorter. Philipp.</span>
<a name="l01319"></a>01319                 msg = msg + <span class="stringliteral">&#39;: &#39;</span> + re.sub(<span class="stringliteral">&#39;\s+&#39;</span>, <span class="stringliteral">&#39; &#39;</span>, str(obj_type))
<a name="l01320"></a>01320                 <span class="comment">#? Check if the substitution is really necessary!</span>
<a name="l01321"></a>01321             <span class="keywordflow">print</span> <span class="stringliteral">&quot;[gpClient] %s: %s&quot;</span> % (context, msg)
<a name="l01322"></a>01322     
<a name="l01323"></a><a class="code" href="classgp_1_1client_1_1_connection.html#aadd3d74575a192569aa8099ee9c2b1ec">01323</a>     <span class="keyword">def </span><a class="code" href="classgp_1_1client_1_1_connection.html#aadd3d74575a192569aa8099ee9c2b1ec">checkPeer</a>(self): <span class="comment">#? OK</span>
<a name="l01324"></a>01324         <span class="stringliteral">&quot;&quot;&quot;Attempt to check if the peer is still alive.&quot;&quot;&quot;</span>
<a name="l01325"></a>01325         self.transport.checkPeer()
<a name="l01326"></a>01326           
<a name="l01327"></a>01327     
<a name="l01328"></a><a class="code" href="classgp_1_1client_1_1_connection.html#ad587a86692ac268312e44182317b58db">01328</a>     <span class="keyword">def </span><a class="code" href="classgp_1_1client_1_1_connection.html#ad587a86692ac268312e44182317b58db">setDebug</a>(self, debug): <span class="comment">#OK</span>
<a name="l01329"></a>01329         <span class="stringliteral">&quot;&quot;&quot;Enable or disable the debug mode.</span>
<a name="l01330"></a>01330 <span class="stringliteral"></span>
<a name="l01331"></a>01331 <span class="stringliteral">        In debug mode, tons of diagnostic information are written to stdout.</span>
<a name="l01332"></a>01332 <span class="stringliteral">        @param bool debug </span>
<a name="l01333"></a>01333 <span class="stringliteral"></span>
<a name="l01334"></a>01334 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l01335"></a>01335         self.<a class="code" href="classgp_1_1client_1_1_connection.html#a6b2e9176f75a4fd81be646d651c9c9e6">debug</a> = debug
<a name="l01336"></a>01336         self.transport.setDebug(debug)
<a name="l01337"></a>01337           
<a name="l01338"></a>01338     
<a name="l01339"></a><a class="code" href="classgp_1_1client_1_1_connection.html#a66655d8b0e585abfa31889ce04a18587">01339</a>     <span class="keyword">def </span><a class="code" href="classgp_1_1client_1_1_connection.html#a66655d8b0e585abfa31889ce04a18587">getProtocolVersion</a>(self):
<a name="l01340"></a>01340         <span class="stringliteral">&quot;&quot;&quot;Return the protocol version reported by the peer.&quot;&quot;&quot;</span>
<a name="l01341"></a>01341         
<a name="l01342"></a>01342         <span class="keywordflow">if</span> <span class="keywordflow">not</span> self.<a class="code" href="classgp_1_1client_1_1_connection.html#abbefa69dcbb23510a8f277169bdbf75e">_protocol_version</a>:
<a name="l01343"></a>01343             self.protocol_version()
<a name="l01344"></a>01344             self.<a class="code" href="classgp_1_1client_1_1_connection.html#abbefa69dcbb23510a8f277169bdbf75e">_protocol_version</a> = self.statusMessage.strip()
<a name="l01345"></a>01345         
<a name="l01346"></a>01346         <span class="keywordflow">return</span> self.<a class="code" href="classgp_1_1client_1_1_connection.html#abbefa69dcbb23510a8f277169bdbf75e">_protocol_version</a>
<a name="l01347"></a>01347           
<a name="l01348"></a><a class="code" href="classgp_1_1client_1_1_connection.html#a0212abebbebae57eaf96b96a02aff436">01348</a>     <span class="keyword">def </span><a class="code" href="classgp_1_1client_1_1_connection.html#a0212abebbebae57eaf96b96a02aff436">supportsProtocolVersion</a>(self, min_version, max_version = None): <span class="comment">#TODO: port to PHP</span>
<a name="l01349"></a>01349         <span class="stringliteral">&quot;&quot;&quot;returns True if the peer&#39;s protocol version is at least</span>
<a name="l01350"></a>01350 <span class="stringliteral">           min_version and, if given, no grater than max_version.</span>
<a name="l01351"></a>01351 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l01352"></a>01352         
<a name="l01353"></a>01353         version = self.<a class="code" href="classgp_1_1client_1_1_connection.html#a66655d8b0e585abfa31889ce04a18587">getProtocolVersion</a>()
<a name="l01354"></a>01354         version = float(version)
<a name="l01355"></a>01355         
<a name="l01356"></a>01356         <span class="keywordflow">if</span> min_version <span class="keywordflow">and</span> version &lt; min_version:
<a name="l01357"></a>01357             <span class="keywordflow">return</span> <span class="keyword">False</span>
<a name="l01358"></a>01358           
<a name="l01359"></a>01359         <span class="keywordflow">if</span> max_version <span class="keywordflow">and</span> version &gt; max_version:
<a name="l01360"></a>01360             <span class="keywordflow">return</span> <span class="keyword">False</span>
<a name="l01361"></a>01361             
<a name="l01362"></a>01362         <span class="keywordflow">return</span> <span class="keyword">True</span>
<a name="l01363"></a>01363         
<a name="l01364"></a>01364     
<a name="l01365"></a><a class="code" href="classgp_1_1client_1_1_connection.html#ad4b1fbc71cc1ef9223ba7b987ab9d937">01365</a>     <span class="keyword">def </span><a class="code" href="classgp_1_1client_1_1_connection.html#ad4b1fbc71cc1ef9223ba7b987ab9d937">checkProtocolVersion</a>(self):
<a name="l01366"></a>01366         <span class="stringliteral">&quot;&quot;&quot;Can raise a gpProtocolException.</span>
<a name="l01367"></a>01367 <span class="stringliteral"></span>
<a name="l01368"></a>01368 <span class="stringliteral">        It raises a gpProtocolException if the protocol version reported by the</span>
<a name="l01369"></a>01369 <span class="stringliteral">        peer is not compatible with MIN_PROTOCOL_VERSION and MAX_PROTOCOL_VERSION.</span>
<a name="l01370"></a>01370 <span class="stringliteral">    </span>
<a name="l01371"></a>01371 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l01372"></a>01372         
<a name="l01373"></a>01373         version = self.<a class="code" href="classgp_1_1client_1_1_connection.html#a66655d8b0e585abfa31889ce04a18587">getProtocolVersion</a>()
<a name="l01374"></a>01374         version = float(version)
<a name="l01375"></a>01375         
<a name="l01376"></a>01376         <span class="keywordflow">if</span> version &lt; MIN_PROTOCOL_VERSION:
<a name="l01377"></a>01377             <span class="keywordflow">raise</span> <a class="code" href="classgp_1_1client_1_1gp_protocol_exception.html">gpProtocolException</a>(
<a name="l01378"></a>01378                 <span class="stringliteral">&quot;Bad protocol version: expected at least &quot;</span>
<a name="l01379"></a>01379                 + str(MIN_PROTOCOL_VERSION)
<a name="l01380"></a>01380                 + <span class="stringliteral">&quot;, but peer uses %s&quot;</span> % str(version) )
<a name="l01381"></a>01381           
<a name="l01382"></a>01382         <span class="keywordflow">if</span> version &gt; MAX_PROTOCOL_VERSION:
<a name="l01383"></a>01383             <span class="keywordflow">raise</span> <a class="code" href="classgp_1_1client_1_1gp_protocol_exception.html">gpProtocolException</a>(
<a name="l01384"></a>01384                 <span class="stringliteral">&quot;Bad protocol version: expected at most &quot;</span>
<a name="l01385"></a>01385                 + str(MAX_PROTOCOL_VERSION)
<a name="l01386"></a>01386                 + <span class="stringliteral">&quot;, but peer uses %s&quot;</span> % str(version) )
<a name="l01387"></a>01387           
<a name="l01388"></a>01388     
<a name="l01389"></a><a class="code" href="classgp_1_1client_1_1_connection.html#abd2cae967c8e81668a4dabfc9e0a37c9">01389</a>     <span class="keyword">def </span><a class="code" href="classgp_1_1client_1_1_connection.html#abd2cae967c8e81668a4dabfc9e0a37c9">ping</a>(self): <span class="comment">#? ?</span>
<a name="l01390"></a>01390         <span class="stringliteral">&quot;&quot;&quot;Attempt to check if the peer is still responding.&quot;&quot;&quot;</span>
<a name="l01391"></a>01391         theVersion = self.protocol_version()
<a name="l01392"></a>01392         self.<a class="code" href="classgp_1_1client_1_1_connection.html#a30cef28b85543ed877f941d2598df768">_trace</a>(__function__(), theVersion)
<a name="l01393"></a>01393         
<a name="l01394"></a>01394         <span class="keywordflow">return</span> theVersion
<a name="l01395"></a>01395          
<a name="l01396"></a>01396     
<a name="l01397"></a><a class="code" href="classgp_1_1client_1_1_connection.html#a60a318c226a29972aa576def73b91d1f">01397</a>     <span class="keyword">def </span><a class="code" href="classgp_1_1client_1_1_connection.html#a60a318c226a29972aa576def73b91d1f">__getattr__</a>(self, name): <span class="comment"># fast OK</span>
<a name="l01398"></a>01398         <span class="stringliteral">&quot;&quot;&quot;Creates a closure that, when called, executes the command given</span>
<a name="l01399"></a>01399 <span class="stringliteral">           as the attribute name on the peer instanceof graphcore resp graphserv.</span>
<a name="l01400"></a>01400 <span class="stringliteral"></span>
<a name="l01401"></a>01401 <span class="stringliteral">            Refer to the class level documentation of Connection for details</span>
<a name="l01402"></a>01402 <span class="stringliteral">            on how method calls are mapped to graphserv commands.</span>
<a name="l01403"></a>01403 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l01404"></a>01404         
<a name="l01405"></a>01405         <span class="keywordflow">if</span> re.search(<span class="stringliteral">&#39;_impl$&#39;</span>, name):
<a name="l01406"></a>01406             <span class="keywordflow">raise</span> AttributeError(<span class="stringliteral">&quot;no such impl: %s&quot;</span> % name)
<a name="l01407"></a>01407         
<a name="l01408"></a>01408         <span class="comment">#TODO: do command name normalization outside the closure!</span>
<a name="l01409"></a>01409         <span class="comment">#TODO: allow named arguments!</span>
<a name="l01410"></a>01410 
<a name="l01411"></a>01411         <span class="comment"># A closure:</span>
<a name="l01412"></a>01412         <span class="keyword">def </span>exec_command(*arguments):
<a name="l01413"></a>01413             <span class="stringliteral">&quot;&quot;&quot;Maps calls to undeclared methods on calls to graph commands.</span>
<a name="l01414"></a>01414 <span class="stringliteral">        </span>
<a name="l01415"></a>01415 <span class="stringliteral">            Refer to the class level documentation of Connection for details.</span>
<a name="l01416"></a>01416 <span class="stringliteral">             </span>
<a name="l01417"></a>01417 <span class="stringliteral">            @param arguments: the arguments passed to the method</span>
<a name="l01418"></a>01418 <span class="stringliteral">           </span>
<a name="l01419"></a>01419 <span class="stringliteral">            &quot;&quot;&quot;</span> 
<a name="l01420"></a>01420             cmd = re.sub(<span class="stringliteral">&#39;_&#39;</span>, <span class="stringliteral">&#39;-&#39;</span>, name)
<a name="l01421"></a>01421             cmd = re.sub(<span class="stringliteral">&#39;^-*|-*$&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, cmd)
<a name="l01422"></a>01422             
<a name="l01423"></a>01423             source = <span class="keywordtype">None</span>
<a name="l01424"></a>01424             sink = <span class="keywordtype">None</span>
<a name="l01425"></a>01425             row_munger = <span class="keywordtype">None</span> <span class="comment">#TODO: PORT TO PHP</span>
<a name="l01426"></a>01426             
<a name="l01427"></a>01427             <span class="keywordflow">if</span> re.match(<span class="stringliteral">&#39;^try-&#39;</span>, cmd):
<a name="l01428"></a>01428                 cmd = cmd[4:]
<a name="l01429"></a>01429                 try_it = <span class="keyword">True</span>
<a name="l01430"></a>01430             <span class="keywordflow">else</span>:
<a name="l01431"></a>01431                 try_it = <span class="keyword">False</span>
<a name="l01432"></a>01432                  
<a name="l01433"></a>01433             
<a name="l01434"></a>01434             <span class="keywordflow">if</span> re.match( <span class="stringliteral">&#39;^capture-&#39;</span>, cmd ):
<a name="l01435"></a>01435                 cmd = cmd[8:]
<a name="l01436"></a>01436                 sink = <a class="code" href="classgp_1_1client_1_1_array_sink.html">ArraySink</a>()
<a name="l01437"></a>01437                 capture = <span class="keyword">True</span>
<a name="l01438"></a>01438             <span class="keywordflow">else</span>:
<a name="l01439"></a>01439                 capture = <span class="keyword">False</span>
<a name="l01440"></a>01440                  
<a name="l01441"></a>01441             
<a name="l01442"></a>01442             <span class="keywordflow">if</span> re.search( <span class="stringliteral">&#39;-map$&#39;</span>, cmd ):
<a name="l01443"></a>01443                 <span class="keywordflow">if</span> <span class="keywordflow">not</span> capture:
<a name="l01444"></a>01444                     <span class="keywordflow">raise</span> <a class="code" href="classgp_1_1client_1_1gp_usage_exception.html">gpUsageException</a>(
<a name="l01445"></a>01445                       <span class="stringliteral">&quot;using the _map suffix without the capture_ prefix&quot;</span>
<a name="l01446"></a>01446                       + <span class="stringliteral">&quot; is meaningless&quot;</span> )
<a name="l01447"></a>01447                 cmd = cmd[:-4]
<a name="l01448"></a>01448                 map_it = <span class="keyword">True</span>
<a name="l01449"></a>01449             <span class="keywordflow">else</span>:
<a name="l01450"></a>01450                 map_it = <span class="keyword">False</span>
<a name="l01451"></a>01451                  
<a name="l01452"></a>01452             <span class="keywordflow">if</span> re.search( <span class="stringliteral">&#39;-value$&#39;</span>, cmd ):
<a name="l01453"></a>01453                 <span class="keywordflow">if</span> capture: 
<a name="l01454"></a>01454                     <span class="keywordflow">raise</span> <a class="code" href="classgp_1_1client_1_1gp_usage_exception.html">gpUsageException</a>( <span class="stringliteral">&quot;using the _value suffix together with the capture_ prefix is meaningless&quot;</span> )
<a name="l01455"></a>01455                 
<a name="l01456"></a>01456                 cmd = cmd[:-6]
<a name="l01457"></a>01457                 val = <span class="keyword">True</span>
<a name="l01458"></a>01458             <span class="keywordflow">else</span>:
<a name="l01459"></a>01459                 val = <span class="keyword">False</span>
<a name="l01460"></a>01460             
<a name="l01461"></a>01461             result = <span class="keywordtype">None</span>
<a name="l01462"></a>01462 
<a name="l01463"></a>01463             <span class="keywordflow">if</span> self.<a class="code" href="classgp_1_1client_1_1_connection.html#a684389288f3a7a8ace8457b1f543bc8c">call_handlers</a>:
<a name="l01464"></a>01464                 handler_vars = {<span class="stringliteral">&#39;command&#39;</span>: cmd, <span class="stringliteral">&#39;arguments&#39;</span>: arguments,
<a name="l01465"></a>01465                                 <span class="stringliteral">&#39;source&#39;</span>: source, <span class="stringliteral">&#39;sink&#39;</span>: sink,
<a name="l01466"></a>01466                                 <span class="stringliteral">&#39;capture&#39;</span>: capture, <span class="stringliteral">&#39;result&#39;</span>: result}
<a name="l01467"></a>01467                                 
<a name="l01468"></a>01468                 <span class="keywordflow">for</span> handler <span class="keywordflow">in</span> self.<a class="code" href="classgp_1_1client_1_1_connection.html#a684389288f3a7a8ace8457b1f543bc8c">call_handlers</a>:
<a name="l01469"></a>01469                     go_on = handler( self, handler_vars )
<a name="l01470"></a>01470                     <span class="keywordflow">if</span> <span class="keywordflow">not</span> go_on:   
<a name="l01471"></a>01471                         <span class="keywordflow">return</span> handler_vars[<span class="stringliteral">&#39;result&#39;</span>]
<a name="l01472"></a>01472                         
<a name="l01473"></a>01473                 cmd = handler_vars[<span class="stringliteral">&#39;command&#39;</span>]
<a name="l01474"></a>01474                 arguments = handler_vars[<span class="stringliteral">&#39;arguments&#39;</span>]
<a name="l01475"></a>01475                 source = handler_vars[<span class="stringliteral">&#39;source&#39;</span>]
<a name="l01476"></a>01476                 sink = handler_vars[<span class="stringliteral">&#39;sink&#39;</span>]
<a name="l01477"></a>01477                 capture = handler_vars[<span class="stringliteral">&#39;capture&#39;</span>]
<a name="l01478"></a>01478                 result = handler_vars[<span class="stringliteral">&#39;result&#39;</span>]
<a name="l01479"></a>01479             
<a name="l01480"></a>01480             command = [cmd]
<a name="l01481"></a>01481     
<a name="l01482"></a>01482             <span class="keywordflow">for</span> arg <span class="keywordflow">in</span> arguments:
<a name="l01483"></a>01483                 <span class="keywordflow">if</span> isinstance(arg, (tuple, list, set)):
<a name="l01484"></a>01484                     source = <a class="code" href="classgp_1_1client_1_1_array_source.html">ArraySource</a>(arg)
<a name="l01485"></a>01485                 <span class="keywordflow">elif</span> type(arg) == types.GeneratorType:
<a name="l01486"></a>01486                     source = <a class="code" href="classgp_1_1client_1_1_array_source.html">ArraySource</a>(arg)
<a name="l01487"></a>01487                 <span class="keywordflow">elif</span> isinstance(arg, (DataSource, DataSink)):
<a name="l01488"></a>01488                     <span class="keywordflow">if</span> isinstance(arg, DataSource):
<a name="l01489"></a>01489                         source = arg
<a name="l01490"></a>01490                     <span class="keywordflow">elif</span> isinstance(arg, DataSink):
<a name="l01491"></a>01491                         sink = arg
<a name="l01492"></a>01492                     <span class="keywordflow">else</span>:
<a name="l01493"></a>01493                         <span class="keywordflow">raise</span> <a class="code" href="classgp_1_1client_1_1gp_usage_exception.html">gpUsageException</a>(
<a name="l01494"></a>01494                           <span class="stringliteral">&quot;arguments must be primitive or a DataSource&quot;</span>
<a name="l01495"></a>01495                           + <span class="stringliteral">&quot; or DataSink. Found %s&quot;</span> % str(type(arg)))
<a name="l01496"></a>01496                 <span class="keywordflow">elif</span> <span class="keywordflow">not</span> arg:
<a name="l01497"></a>01497                     <span class="keywordflow">continue</span>
<a name="l01498"></a>01498                 <span class="keywordflow">elif</span> callable(arg):
<a name="l01499"></a>01499                     row_munger = arg
<a name="l01500"></a>01500                 <span class="keywordflow">elif</span> isinstance(arg, (str, unicode, int, long)):
<a name="l01501"></a>01501                     command.append(arg)
<a name="l01502"></a>01502                 <span class="keywordflow">else</span>:
<a name="l01503"></a>01503                     <span class="keywordflow">raise</span> <a class="code" href="classgp_1_1client_1_1gp_usage_exception.html">gpUsageException</a>(
<a name="l01504"></a>01504                       <span class="stringliteral">&quot;arguments must be objects, strings or integers. &quot;</span>
<a name="l01505"></a>01505                       + <span class="stringliteral">&quot;Found %s&quot;</span> % type(arg))
<a name="l01506"></a>01506                       
<a name="l01507"></a>01507             <span class="keywordflow">if</span> try_it:
<a name="l01508"></a>01508                 catchThis = gpProcessorException 
<a name="l01509"></a>01509                 <span class="comment">#XXX: catch more exceptions? ClientException? Protocolexception?</span>
<a name="l01510"></a>01510             <span class="keywordflow">else</span>:
<a name="l01511"></a>01511                 catchThis = <span class="keywordtype">None</span>
<a name="l01512"></a>01512             
<a name="l01513"></a>01513             <span class="keywordflow">try</span>:
<a name="l01514"></a>01514                 do_execute = <span class="keyword">True</span>
<a name="l01515"></a>01515                 self.<a class="code" href="classgp_1_1client_1_1_connection.html#a5916a7a275ebac7db2c09e676eef752c">__command_has_output</a> = <span class="keywordtype">None</span>
<a name="l01516"></a>01516                 
<a name="l01517"></a>01517                 <span class="keywordflow">if</span> self.<a class="code" href="classgp_1_1client_1_1_connection.html#a60e020b9994d619124ac8a869bb707a7">exec_handlers</a>:
<a name="l01518"></a>01518                     handler_vars = {<span class="stringliteral">&#39;command&#39;</span>: command, <span class="stringliteral">&#39;source&#39;</span>: source, 
<a name="l01519"></a>01519                                     <span class="stringliteral">&#39;sink&#39;</span>: sink, <span class="stringliteral">&#39;has_output&#39;</span>: has_output,
<a name="l01520"></a>01520                                     <span class="stringliteral">&#39;status&#39;</span>: status, <span class="stringliteral">&#39;row_munger&#39;</span>: row_munger}
<a name="l01521"></a>01521 
<a name="l01522"></a>01522                     <span class="keywordflow">for</span> handler <span class="keywordflow">in</span> self.<a class="code" href="classgp_1_1client_1_1_connection.html#a60e020b9994d619124ac8a869bb707a7">exec_handlers</a>:
<a name="l01523"></a>01523                         go_on = handler( self, handler_vars )
<a name="l01524"></a>01524                         
<a name="l01525"></a>01525                         <span class="keywordflow">if</span> <span class="keywordflow">not</span> go_on:
<a name="l01526"></a>01526                             do_execute = <span class="keyword">False</span>
<a name="l01527"></a>01527                             <span class="keywordflow">break</span>
<a name="l01528"></a>01528                                 
<a name="l01529"></a>01529                     command = handler_vars[<span class="stringliteral">&#39;command&#39;</span>]
<a name="l01530"></a>01530                     source = handler_vars[<span class="stringliteral">&#39;source&#39;</span>]
<a name="l01531"></a>01531                     sink = handler_vars[<span class="stringliteral">&#39;sink&#39;</span>]
<a name="l01532"></a>01532                     has_output = handler_vars[<span class="stringliteral">&#39;has_output&#39;</span>]
<a name="l01533"></a>01533                     status = handler_vars[<span class="stringliteral">&#39;status&#39;</span>]
<a name="l01534"></a>01534                     row_munger = handler_vars[<span class="stringliteral">&#39;row_munger&#39;</span>]
<a name="l01535"></a>01535 
<a name="l01536"></a>01536                 <span class="keywordflow">if</span> do_execute:
<a name="l01537"></a>01537                     func = re.sub(<span class="stringliteral">&#39;-&#39;</span>, <span class="stringliteral">&#39;_&#39;</span>, command[0] + <span class="stringliteral">&#39;_impl&#39;</span>)
<a name="l01538"></a>01538                     <span class="keywordflow">if</span> hasattr(self, func ):
<a name="l01539"></a>01539                         args = command[1:]
<a name="l01540"></a>01540                         args.append(source)
<a name="l01541"></a>01541                         args.append(sink)
<a name="l01542"></a>01542                         
<a name="l01543"></a>01543                         f = getattr(self, func)
<a name="l01544"></a>01544                         status = f( *args )
<a name="l01545"></a>01545                     <span class="keywordflow">else</span>:
<a name="l01546"></a>01546                         status = self.<a class="code" href="classgp_1_1client_1_1_connection.html#a2eac0c38d4260147555022f04bbab135">execute</a>(command, source, sink, row_munger = row_munger)
<a name="l01547"></a>01547                          
<a name="l01548"></a>01548                      
<a name="l01549"></a>01549             <span class="keywordflow">except</span> catchThis <span class="keyword">as</span> e:
<a name="l01550"></a>01550                 <span class="keywordflow">return</span> <span class="keyword">False</span>
<a name="l01551"></a>01551                  
<a name="l01552"></a>01552             <span class="comment">#note: call modifiers like capture change the return type!</span>
<a name="l01553"></a>01553             <span class="keywordflow">if</span> capture:
<a name="l01554"></a>01554                 
<a name="l01555"></a>01555                 <span class="keywordflow">if</span> status == <span class="stringliteral">&#39;OK&#39;</span> <span class="keywordflow">or</span> status == <span class="stringliteral">&#39;VALUE&#39;</span>:
<a name="l01556"></a>01556                     <span class="keywordflow">if</span> self.<a class="code" href="classgp_1_1client_1_1_connection.html#a5916a7a275ebac7db2c09e676eef752c">__command_has_output</a>:
<a name="l01557"></a>01557                         <span class="keywordflow">if</span> map_it:
<a name="l01558"></a>01558                             <span class="keywordflow">return</span> sink.getMap()
<a name="l01559"></a>01559                         <span class="keywordflow">else</span>:
<a name="l01560"></a>01560                             <span class="keywordflow">return</span> sink.getData()
<a name="l01561"></a>01561                     <span class="keywordflow">else</span>:
<a name="l01562"></a>01562                         <span class="keywordflow">return</span> <span class="keyword">True</span>
<a name="l01563"></a>01563                          
<a name="l01564"></a>01564                      
<a name="l01565"></a>01565                 <span class="keywordflow">elif</span> status == <span class="stringliteral">&#39;NONE&#39;</span>:
<a name="l01566"></a>01566                     <span class="keywordflow">return</span> <span class="keywordtype">None</span>
<a name="l01567"></a>01567                 <span class="keywordflow">else</span>:
<a name="l01568"></a>01568                     <span class="keywordflow">return</span> <span class="keyword">False</span>
<a name="l01569"></a>01569             <span class="keywordflow">else</span>:
<a name="l01570"></a>01570                 <span class="keywordflow">if</span> result:
<a name="l01571"></a>01571                     status = result <span class="comment"># from handler</span>
<a name="l01572"></a>01572                     
<a name="l01573"></a>01573                 <span class="keywordflow">if</span> val:
<a name="l01574"></a>01574                     <span class="keywordflow">if</span> status == <span class="stringliteral">&quot;VALUE&quot;</span> <span class="keywordflow">or</span> status == <span class="stringliteral">&quot;OK&quot;</span>:
<a name="l01575"></a>01575                         <span class="keywordflow">return</span> self.<a class="code" href="classgp_1_1client_1_1_connection.html#ae0752c5504ac55bce67978a91a9a845e">statusMessage</a>; <span class="comment">#XXX: not so pretty</span>
<a name="l01576"></a>01576                     <span class="keywordflow">else</span>:
<a name="l01577"></a>01577                         <span class="keywordflow">raise</span> <a class="code" href="classgp_1_1client_1_1gp_usage_exception.html">gpUsageException</a>( <span class="stringliteral">&quot;Can&#39;t apply _value modifier: command &quot;</span> + command + <span class="stringliteral">&quot; did not return a VALUE or OK status, but this: &quot;</span> + status )
<a name="l01578"></a>01578                 
<a name="l01579"></a>01579                 <span class="keywordflow">return</span> status
<a name="l01580"></a>01580                     
<a name="l01581"></a>01581         setattr(self, name, exec_command) <span class="comment">#re-use closure!</span>
<a name="l01582"></a>01582 
<a name="l01583"></a>01583         <span class="comment"># Return the closure.</span>
<a name="l01584"></a>01584         <span class="keywordflow">return</span> exec_command 
<a name="l01585"></a>01585          
<a name="l01586"></a>01586     
<a name="l01587"></a><a class="code" href="classgp_1_1client_1_1_connection.html#a2eac0c38d4260147555022f04bbab135">01587</a>     <span class="keyword">def </span><a class="code" href="classgp_1_1client_1_1_connection.html#a2eac0c38d4260147555022f04bbab135">execute</a>(self, command, source=None, sink=None, row_munger=None):
<a name="l01588"></a>01588         <span class="stringliteral">&quot;&quot;&quot; Applies a command to the graph, i.e. runs the command on the peer.</span>
<a name="l01589"></a>01589 <span class="stringliteral">    </span>
<a name="l01590"></a>01590 <span class="stringliteral">        Note: this method implements the protocol used to interact with the peers,</span>
<a name="l01591"></a>01591 <span class="stringliteral">        based upon the line-by-line communication provided by the transport </span>
<a name="l01592"></a>01592 <span class="stringliteral">        instance. Interaction with the peer is stateless between calls to this</span>
<a name="l01593"></a>01593 <span class="stringliteral">        function (except of course for the contents of the graph itself).</span>
<a name="l01594"></a>01594 <span class="stringliteral">        </span>
<a name="l01595"></a>01595 <span class="stringliteral">        If the command generates output, the instance variable</span>
<a name="l01596"></a>01596 <span class="stringliteral">        __command_has_output will be set True, otherwise False.</span>
<a name="l01597"></a>01597 <span class="stringliteral">        </span>
<a name="l01598"></a>01598 <span class="stringliteral">        @type  command: mixed</span>
<a name="l01599"></a>01599 <span class="stringliteral">        @param command: the command, as a single string or as an array</span>
<a name="l01600"></a>01600 <span class="stringliteral">                        containing the command name and any arguments.</span>
<a name="l01601"></a>01601 <span class="stringliteral">        @type  source: DataSource</span>
<a name="l01602"></a>01602 <span class="stringliteral">        @param source: the data source to take the commands input from</span>
<a name="l01603"></a>01603 <span class="stringliteral">                       (default: null)</span>
<a name="l01604"></a>01604 <span class="stringliteral">        @type  sink: DataSink</span>
<a name="l01605"></a>01605 <span class="stringliteral">        @param sink: the data sink to pass the commands output to</span>
<a name="l01606"></a>01606 <span class="stringliteral">                     (default: null)</span>
<a name="l01607"></a>01607 <span class="stringliteral">        @param row_munger: a callback function to be invoked for every row </span>
<a name="l01608"></a>01608 <span class="stringliteral">               copied (optional). The return value from the munger </span>
<a name="l01609"></a>01609 <span class="stringliteral">               replaces the original row. If the munger function returns </span>
<a name="l01610"></a>01610 <span class="stringliteral">               None or False, the row is skipped.</span>
<a name="l01611"></a>01611 <span class="stringliteral">        @rtype:  string</span>
<a name="l01612"></a>01612 <span class="stringliteral">        @return: the status string returned by the command</span>
<a name="l01613"></a>01613 <span class="stringliteral">        @raise: gpProtocolException if a communication error ocurred while</span>
<a name="l01614"></a>01614 <span class="stringliteral">                talking to the peer</span>
<a name="l01615"></a>01615 <span class="stringliteral">        @raise: gpProcessorException if the peer reported an error</span>
<a name="l01616"></a>01616 <span class="stringliteral">        @raise: gpUsageException if $command does not conform to the rules</span>
<a name="l01617"></a>01617 <span class="stringliteral">                for commands. Note that self.strictArguments and</span>
<a name="l01618"></a>01618 <span class="stringliteral">                self.alloPipes influence which commands are allowed.</span>
<a name="l01619"></a>01619 <span class="stringliteral">        </span>
<a name="l01620"></a>01620 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l01621"></a>01621         self.<a class="code" href="classgp_1_1client_1_1_connection.html#a30cef28b85543ed877f941d2598df768">_trace</a>(__function__(), <span class="stringliteral">&quot;BEGIN&quot;</span>)
<a name="l01622"></a>01622         
<a name="l01623"></a>01623         <span class="keywordflow">if</span> self.<a class="code" href="classgp_1_1client_1_1_connection.html#a3bfe981d1c95c8ca45fae1b67350e51c">tainted</a>:
<a name="l01624"></a>01624             <span class="keywordflow">raise</span> <a class="code" href="classgp_1_1client_1_1gp_protocol_exception.html">gpProtocolException</a>(
<a name="l01625"></a>01625               <span class="stringliteral">&quot;connection tainted by previous error!&quot;</span>)
<a name="l01626"></a>01626               
<a name="l01627"></a>01627         <span class="keywordflow">if</span> self.<a class="code" href="classgp_1_1client_1_1_connection.html#a85513ace8e0720e7adc85d57578060af">isClosed</a>():
<a name="l01628"></a>01628             <span class="keywordflow">raise</span> <a class="code" href="classgp_1_1client_1_1gp_protocol_exception.html">gpProtocolException</a>(<span class="stringliteral">&quot;connection already closed!&quot;</span>)
<a name="l01629"></a>01629             
<a name="l01630"></a>01630         <span class="keywordflow">if</span> self.transport.eof(): <span class="comment"># closed by peer</span>
<a name="l01631"></a>01631             self.<a class="code" href="classgp_1_1client_1_1_connection.html#a30cef28b85543ed877f941d2598df768">_trace</a>(__function__(),
<a name="l01632"></a>01632                        <span class="stringliteral">&quot;connection closed by peer, closing our side too.&quot;</span>)
<a name="l01633"></a>01633             self.<a class="code" href="classgp_1_1client_1_1_connection.html#ae5dd97c42ec5ba28939d396ee467c604">close</a>()
<a name="l01634"></a>01634             self.<a class="code" href="classgp_1_1client_1_1_connection.html#a3bfe981d1c95c8ca45fae1b67350e51c">tainted</a> = <span class="keyword">True</span>
<a name="l01635"></a>01635             <span class="keywordflow">raise</span> <a class="code" href="classgp_1_1client_1_1gp_protocol_exception.html">gpProtocolException</a>(<span class="stringliteral">&quot;connection closed by peer!&quot;</span>)
<a name="l01636"></a>01636             
<a name="l01637"></a>01637         <span class="keywordflow">if</span> isinstance(command, (list, tuple, set)):
<a name="l01638"></a>01638             <span class="keywordflow">if</span> <span class="keywordflow">not</span> command:
<a name="l01639"></a>01639                 <span class="keywordflow">raise</span> <a class="code" href="classgp_1_1client_1_1gp_usage_exception.html">gpUsageException</a>(<span class="stringliteral">&quot;empty command!&quot;</span>)
<a name="l01640"></a>01640                 
<a name="l01641"></a>01641             c = command[0]
<a name="l01642"></a>01642             <span class="keywordflow">if</span> <span class="keywordflow">not</span> isinstance(c, (str, unicode)): <span class="comment">#? Less restrictive in php.</span>
<a name="l01643"></a>01643                 <span class="keywordflow">raise</span> <a class="code" href="classgp_1_1client_1_1gp_usage_exception.html">gpUsageException</a>(
<a name="l01644"></a>01644                   <span class="stringliteral">&quot;invalid command type: %s&quot;</span> % type(c).__name__)
<a name="l01645"></a>01645                   
<a name="l01646"></a>01646             <span class="keywordflow">if</span> <span class="keywordflow">not</span> self.<a class="code" href="classgp_1_1client_1_1_connection.html#aecb41e586960b56d6f1283acc18ee0d9">isValidCommandName</a>(c):
<a name="l01647"></a>01647                 <span class="keywordflow">raise</span> <a class="code" href="classgp_1_1client_1_1gp_usage_exception.html">gpUsageException</a>(<span class="stringliteral">&quot;invalid command name: %s&quot;</span> % c)
<a name="l01648"></a>01648                 
<a name="l01649"></a>01649             strictArgs = self.<a class="code" href="classgp_1_1client_1_1_connection.html#a059870364204106178f16d13d85343cb">strictArguments</a>
<a name="l01650"></a>01650 
<a name="l01651"></a>01651             <span class="keywordflow">if</span> c == <span class="stringliteral">&quot;set-meta&quot;</span> <span class="keywordflow">or</span> c == <span class="stringliteral">&quot;authorize&quot;</span>: <span class="comment">#XXX: ugly hack for wellknown commands</span>
<a name="l01652"></a>01652                 strictArgs = <span class="keyword">False</span>
<a name="l01653"></a>01653             
<a name="l01654"></a>01654             <span class="keywordflow">for</span> c <span class="keywordflow">in</span> command:
<a name="l01655"></a>01655                 <span class="keywordflow">if</span> <span class="keywordflow">not</span> isinstance(c, (str, unicode, int, long)):
<a name="l01656"></a>01656                     <span class="keywordflow">raise</span> <a class="code" href="classgp_1_1client_1_1gp_usage_exception.html">gpUsageException</a>(
<a name="l01657"></a>01657                       <span class="stringliteral">&quot;invalid argument type: %s&quot;</span> % type(c).__name__)
<a name="l01658"></a>01658                       
<a name="l01659"></a>01659                 <span class="keywordflow">if</span> self.<a class="code" href="classgp_1_1client_1_1_connection.html#a32ce5de353680ba77d80f584da385b02">allowPipes</a> <span class="keywordflow">and</span> re.match(<span class="stringliteral">&#39;^[&lt;&gt;]$&#39;</span>, c):
<a name="l01660"></a>01660                     strictArgs = <span class="keyword">False</span>
<a name="l01661"></a>01661                     <span class="comment"># pipe, allow lenient args after that</span>
<a name="l01662"></a>01662                     
<a name="l01663"></a>01663                 <span class="keywordflow">if</span> self.<a class="code" href="classgp_1_1client_1_1_connection.html#a32ce5de353680ba77d80f584da385b02">allowPipes</a> <span class="keywordflow">and</span> re.match(<span class="stringliteral">&#39;^[|&amp;!:&lt;&gt;]+$&#39;</span>, c):
<a name="l01664"></a>01664                     <span class="keywordflow">continue</span>
<a name="l01665"></a>01665                     <span class="comment">#operator</span>
<a name="l01666"></a>01666                     
<a name="l01667"></a>01667                 <span class="keywordflow">if</span> <span class="keywordflow">not</span> self.<a class="code" href="classgp_1_1client_1_1_connection.html#a3839687882c911705dfe3e98ad77554e">isValidCommandArgument</a>(c, strictArgs):
<a name="l01668"></a>01668                     <span class="keywordflow">raise</span> <a class="code" href="classgp_1_1client_1_1gp_usage_exception.html">gpUsageException</a>(<span class="stringliteral">&quot;invalid argument: %s&quot;</span> % c)
<a name="l01669"></a>01669             
<a name="l01670"></a>01670             command = <span class="stringliteral">&#39; &#39;</span>.join(<span class="stringliteral">&quot;%s&quot;</span> % el <span class="keywordflow">for</span> el <span class="keywordflow">in</span> command)
<a name="l01671"></a>01671         
<a name="l01672"></a>01672         <span class="keywordflow">if</span> <span class="keywordflow">not</span> command:
<a name="l01673"></a>01673             <span class="keywordflow">raise</span> <a class="code" href="classgp_1_1client_1_1gp_usage_exception.html">gpUsageException</a>(<span class="stringliteral">&quot;command is empty!&quot;</span>)
<a name="l01674"></a>01674             
<a name="l01675"></a>01675         command = command.strip()
<a name="l01676"></a>01676         
<a name="l01677"></a>01677         <span class="keywordflow">if</span> command == <span class="stringliteral">&quot;&quot;</span>:
<a name="l01678"></a>01678             <span class="keywordflow">raise</span> <a class="code" href="classgp_1_1client_1_1gp_usage_exception.html">gpUsageException</a>(<span class="stringliteral">&quot;command is empty!&quot;</span>)
<a name="l01679"></a>01679             
<a name="l01680"></a>01680         self.<a class="code" href="classgp_1_1client_1_1_connection.html#a30cef28b85543ed877f941d2598df768">_trace</a>(__function__(), <span class="stringliteral">&quot;command&quot;</span>, command )
<a name="l01681"></a>01681         
<a name="l01682"></a>01682         <span class="keywordflow">if</span> <span class="keywordflow">not</span> self.<a class="code" href="classgp_1_1client_1_1_connection.html#ab387db6a8fc080f59c18e4ad74390ed4">isValidCommandString</a>(command):
<a name="l01683"></a>01683             <span class="keywordflow">raise</span> <a class="code" href="classgp_1_1client_1_1gp_usage_exception.html">gpUsageException</a>(<span class="stringliteral">&quot;invalid command: %s&quot;</span> % command)
<a name="l01684"></a>01684         
<a name="l01685"></a>01685         <span class="keywordflow">if</span> (<span class="keywordflow">not</span> self.<a class="code" href="classgp_1_1client_1_1_connection.html#a32ce5de353680ba77d80f584da385b02">allowPipes</a>) <span class="keywordflow">and</span> re.search(<span class="stringliteral">&#39;[&lt;&gt;]&#39;</span>, command):
<a name="l01686"></a>01686             <span class="keywordflow">raise</span> <a class="code" href="classgp_1_1client_1_1gp_usage_exception.html">gpUsageException</a>(
<a name="l01687"></a>01687               <span class="stringliteral">&quot;command denied, pipes are disallowed by allowPipes = false; &quot;</span>
<a name="l01688"></a>01688               + <span class="stringliteral">&quot;command: %s&quot;</span> % command);
<a name="l01689"></a>01689         
<a name="l01690"></a>01690         <span class="keywordflow">if</span> source <span class="keywordflow">and</span> (<span class="keywordflow">not</span> re.search(<span class="stringliteral">&#39;:$&#39;</span>, command)):
<a name="l01691"></a>01691             command = command + <span class="stringliteral">&#39;:&#39;</span>
<a name="l01692"></a>01692         
<a name="l01693"></a>01693         <span class="keywordflow">if</span> (<span class="keywordflow">not</span> source) <span class="keywordflow">and</span> re.search(<span class="stringliteral">&#39;:$&#39;</span>, command):
<a name="l01694"></a>01694             source = NullSource.instance
<a name="l01695"></a>01695         
<a name="l01696"></a>01696         <span class="keywordflow">if</span> source <span class="keywordflow">and</span> re.search(<span class="stringliteral">&#39;&lt;&#39;</span>, command):
<a name="l01697"></a>01697             <span class="keywordflow">raise</span> <a class="code" href="classgp_1_1client_1_1gp_usage_exception.html">gpUsageException</a>(
<a name="l01698"></a>01698               <span class="stringliteral">&quot;can&#39;t use data input file and a local data source &quot;</span>
<a name="l01699"></a>01699               + <span class="stringliteral">&quot;at the same time! %s&quot;</span> % command)
<a name="l01700"></a>01700         
<a name="l01701"></a>01701         <span class="keywordflow">if</span> sink <span class="keywordflow">and</span> re.search(<span class="stringliteral">&#39;&gt;&#39;</span>, command):
<a name="l01702"></a>01702             <span class="keywordflow">raise</span> <a class="code" href="classgp_1_1client_1_1gp_usage_exception.html">gpUsageException</a>(
<a name="l01703"></a>01703               <span class="stringliteral">&quot;can&#39;t use data output file and a local data sink &quot;</span>
<a name="l01704"></a>01704               + <span class="stringliteral">&quot;at the same time! %s&quot;</span> % command)
<a name="l01705"></a>01705         
<a name="l01706"></a>01706         self.<a class="code" href="classgp_1_1client_1_1_connection.html#a30cef28b85543ed877f941d2598df768">_trace</a>(__function__(), <span class="stringliteral">&quot;&gt;&gt;&gt; &quot;</span>, command)
<a name="l01707"></a>01707         self.transport.send( command + LINEBREAK )
<a name="l01708"></a>01708         self.<a class="code" href="classgp_1_1client_1_1_connection.html#a30cef28b85543ed877f941d2598df768">_trace</a>(__function__(), <span class="stringliteral">&quot;source&quot;</span>, type(source))
<a name="l01709"></a>01709 
<a name="l01710"></a>01710         <span class="keywordflow">if</span> ( source ):
<a name="l01711"></a>01711             self.<a class="code" href="classgp_1_1client_1_1_connection.html#a1d2f2020abe8f5d0772fd2231d55c5e5">_copyFromSource</a>( source, row_munger = row_munger )
<a name="l01712"></a>01712         
<a name="l01713"></a>01713         rec = self.transport.receive()
<a name="l01714"></a>01714         self.<a class="code" href="classgp_1_1client_1_1_connection.html#a30cef28b85543ed877f941d2598df768">_trace</a>(__function__(), <span class="stringliteral">&quot;&lt;&lt;&lt; &quot;</span>, rec)
<a name="l01715"></a>01715 
<a name="l01716"></a>01716         
<a name="l01717"></a>01717         <span class="keywordflow">if</span> <span class="keywordflow">not</span> rec:
<a name="l01718"></a>01718             self.<a class="code" href="classgp_1_1client_1_1_connection.html#a3bfe981d1c95c8ca45fae1b67350e51c">tainted</a> = <span class="keyword">True</span>;
<a name="l01719"></a>01719             self.<a class="code" href="classgp_1_1client_1_1_connection.html#a67ad2b42739bd0e1355499f7c712b0f3">status</a> = <span class="keywordtype">None</span>;
<a name="l01720"></a>01720             self.<a class="code" href="classgp_1_1client_1_1_connection.html#ae0752c5504ac55bce67978a91a9a845e">statusMessage</a> = <span class="keywordtype">None</span>;
<a name="l01721"></a>01721             self.<a class="code" href="classgp_1_1client_1_1_connection.html#a845bb6cd14500a6a87ef563fb713d326">response</a> = <span class="keywordtype">None</span>;
<a name="l01722"></a>01722             
<a name="l01723"></a>01723             self.<a class="code" href="classgp_1_1client_1_1_connection.html#a30cef28b85543ed877f941d2598df768">_trace</a>(__function__(),
<a name="l01724"></a>01724                        <span class="stringliteral">&quot;peer did not respond! Got value %s&quot;</span> % rec)
<a name="l01725"></a>01725             self.transport.checkPeer()
<a name="l01726"></a>01726             
<a name="l01727"></a>01727             <span class="keywordflow">raise</span> <a class="code" href="classgp_1_1client_1_1gp_protocol_exception.html">gpProtocolException</a>(
<a name="l01728"></a>01728               <span class="stringliteral">&quot;peer did not respond! Got value %s&quot;</span> % str(rec))
<a name="l01729"></a>01729         
<a name="l01730"></a>01730         rec = rec.strip()        
<a name="l01731"></a>01731         self.<a class="code" href="classgp_1_1client_1_1_connection.html#a845bb6cd14500a6a87ef563fb713d326">response</a> = rec
<a name="l01732"></a>01732         
<a name="l01733"></a>01733         match = re.match(<span class="stringliteral">&#39;^([a-zA-Z]+)[.:!](.*?):?$&#39;</span>, rec)
<a name="l01734"></a>01734         <span class="keywordflow">if</span> <span class="keywordflow">not</span> match <span class="keywordflow">or</span> <span class="keywordflow">not</span> match.group(1):
<a name="l01735"></a>01735             self.<a class="code" href="classgp_1_1client_1_1_connection.html#a3bfe981d1c95c8ca45fae1b67350e51c">tainted</a> = <span class="keyword">True</span>
<a name="l01736"></a>01736             self.<a class="code" href="classgp_1_1client_1_1_connection.html#ae5dd97c42ec5ba28939d396ee467c604">close</a>()
<a name="l01737"></a>01737             <span class="keywordflow">raise</span> <a class="code" href="classgp_1_1client_1_1gp_protocol_exception.html">gpProtocolException</a>(
<a name="l01738"></a>01738               <span class="stringliteral">&quot;response should begin with status string like `OK`. Found: `&quot;</span>
<a name="l01739"></a>01739               + rec + <span class="stringliteral">&quot;&#39;&quot;</span>)
<a name="l01740"></a>01740         
<a name="l01741"></a>01741         self.<a class="code" href="classgp_1_1client_1_1_connection.html#a67ad2b42739bd0e1355499f7c712b0f3">status</a> = match.group(1)
<a name="l01742"></a>01742         self.<a class="code" href="classgp_1_1client_1_1_connection.html#ae0752c5504ac55bce67978a91a9a845e">statusMessage</a> = match.group(2).strip()
<a name="l01743"></a>01743         
<a name="l01744"></a>01744         <span class="keywordflow">if</span> self.<a class="code" href="classgp_1_1client_1_1_connection.html#a67ad2b42739bd0e1355499f7c712b0f3">status</a> != <span class="stringliteral">&#39;OK&#39;</span> <span class="keywordflow">and</span> self.<a class="code" href="classgp_1_1client_1_1_connection.html#a67ad2b42739bd0e1355499f7c712b0f3">status</a> != <span class="stringliteral">&#39;NONE&#39;</span> <span class="keywordflow">and</span> self.<a class="code" href="classgp_1_1client_1_1_connection.html#a67ad2b42739bd0e1355499f7c712b0f3">status</a> != <span class="stringliteral">&#39;VALUE&#39;</span>:
<a name="l01745"></a>01745             <span class="keywordflow">raise</span> <a class="code" href="classgp_1_1client_1_1gp_processor_exception.html">gpProcessorException</a>(
<a name="l01746"></a>01746               self.<a class="code" href="classgp_1_1client_1_1_connection.html#a67ad2b42739bd0e1355499f7c712b0f3">status</a>, self.<a class="code" href="classgp_1_1client_1_1_connection.html#ae0752c5504ac55bce67978a91a9a845e">statusMessage</a>, command)
<a name="l01747"></a>01747         
<a name="l01748"></a>01748         self.<a class="code" href="classgp_1_1client_1_1_connection.html#a30cef28b85543ed877f941d2598df768">_trace</a>(__function__(), <span class="stringliteral">&quot;sink&quot;</span>, type(sink))
<a name="l01749"></a>01749         
<a name="l01750"></a>01750         <span class="keywordflow">if</span> re.search(<span class="stringliteral">&#39;: *$&#39;</span>, rec ):
<a name="l01751"></a>01751             <span class="keywordflow">if</span> <span class="keywordflow">not</span> sink:
<a name="l01752"></a>01752                 sink = NullSink.instance
<a name="l01753"></a>01753                 
<a name="l01754"></a>01754             <span class="comment"># note: we need to slurp the result in any case!</span>
<a name="l01755"></a>01755             self.<a class="code" href="classgp_1_1client_1_1_connection.html#a2d2cd4d35d48e0eace73b4477df4b518">_copyToSink</a>(sink, row_munger = row_munger)
<a name="l01756"></a>01756         
<a name="l01757"></a>01757             self.<a class="code" href="classgp_1_1client_1_1_connection.html#a5916a7a275ebac7db2c09e676eef752c">__command_has_output</a> = <span class="keyword">True</span>
<a name="l01758"></a>01758         <span class="keywordflow">else</span>:
<a name="l01759"></a>01759             self.<a class="code" href="classgp_1_1client_1_1_connection.html#a5916a7a275ebac7db2c09e676eef752c">__command_has_output</a> = <span class="keyword">False</span>
<a name="l01760"></a>01760              
<a name="l01761"></a>01761         
<a name="l01762"></a>01762         <span class="keywordflow">if</span> self.transport.eof():        <span class="comment"># closed by peer</span>
<a name="l01763"></a>01763             self.<a class="code" href="classgp_1_1client_1_1_connection.html#a30cef28b85543ed877f941d2598df768">_trace</a>(__function__(),
<a name="l01764"></a>01764                        <span class="stringliteral">&quot;connection closed by peer, closing our side too.&quot;</span>)
<a name="l01765"></a>01765             self.<a class="code" href="classgp_1_1client_1_1_connection.html#ae5dd97c42ec5ba28939d396ee467c604">close</a>()
<a name="l01766"></a>01766         
<a name="l01767"></a>01767         <span class="keywordflow">return</span> self.<a class="code" href="classgp_1_1client_1_1_connection.html#a67ad2b42739bd0e1355499f7c712b0f3">status</a>
<a name="l01768"></a>01768          
<a name="l01769"></a>01769     
<a name="l01770"></a>01770     
<a name="l01771"></a>01771 
<a name="l01772"></a><a class="code" href="classgp_1_1client_1_1_connection.html#afa6144d9cf83663686c4428aee59133a">01772</a>     <span class="keyword">def </span><a class="code" href="classgp_1_1client_1_1_connection.html#afa6144d9cf83663686c4428aee59133a">traverse_successors_without_impl</a>(
<a name="l01773"></a>01773       self, id, depth, without, without_depth, source, sink, row_munger = <span class="keywordtype">None</span>):
<a name="l01774"></a>01774         <span class="stringliteral">&quot;&quot;&quot;Implements a &#39;fake&#39; command traverse-successors-without</span>
<a name="l01775"></a>01775 <span class="stringliteral"></span>
<a name="l01776"></a>01776 <span class="stringliteral">        which returns all decendants of onw nodes</span>
<a name="l01777"></a>01777 <span class="stringliteral">        minus the descendants of some other nodes.</span>
<a name="l01778"></a>01778 <span class="stringliteral">        This is a convenience function for a common case that</span>
<a name="l01779"></a>01779 <span class="stringliteral">        could otherwise only be covered by implementing the</span>
<a name="l01780"></a>01780 <span class="stringliteral">        set operation in php, or by using execute().</span>
<a name="l01781"></a>01781 <span class="stringliteral"></span>
<a name="l01782"></a>01782 <span class="stringliteral">        This method should not be called directly.</span>
<a name="l01783"></a>01783 <span class="stringliteral">        Instead, use the virtual method traverse_successors_without</span>
<a name="l01784"></a>01784 <span class="stringliteral">        in the same way as normal commands are called.</span>
<a name="l01785"></a>01785 <span class="stringliteral">        This include support for modifiers and flexible</span>
<a name="l01786"></a>01786 <span class="stringliteral">        handling of method parameters.</span>
<a name="l01787"></a>01787 <span class="stringliteral"></span>
<a name="l01788"></a>01788 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l01789"></a>01789         <span class="keywordflow">if</span> <span class="keywordflow">not</span> without_depth:
<a name="l01790"></a>01790             without_depth = depth
<a name="l01791"></a>01791         <span class="keywordflow">return</span> self.<a class="code" href="classgp_1_1client_1_1_connection.html#a2eac0c38d4260147555022f04bbab135">execute</a>(
<a name="l01792"></a>01792           ( <span class="stringliteral">&quot;traverse-successors %s %s &quot;</span> +
<a name="l01793"></a>01793           <span class="stringliteral">&quot; &amp;&amp;! traverse-successors %s %s &quot;</span> ) % (id, depth, without, without_depth),
<a name="l01794"></a>01794           source, sink, row_munger = row_munger)
<a name="l01795"></a>01795          
<a name="l01796"></a>01796 
<a name="l01797"></a>01797     @staticmethod
<a name="l01798"></a><a class="code" href="classgp_1_1client_1_1_connection.html#aecb41e586960b56d6f1283acc18ee0d9">01798</a>     <span class="keyword">def </span><a class="code" href="classgp_1_1client_1_1_connection.html#aecb41e586960b56d6f1283acc18ee0d9">isValidCommandName</a>(name):   <span class="comment">#static #OK</span>
<a name="l01799"></a>01799         <span class="stringliteral">&quot;&quot;&quot;Check if the given name is a valid command name.</span>
<a name="l01800"></a>01800 <span class="stringliteral"></span>
<a name="l01801"></a>01801 <span class="stringliteral">        Command names consist of a letter followed by any number of letters,</span>
<a name="l01802"></a>01802 <span class="stringliteral">        numbers, or dashes.</span>
<a name="l01803"></a>01803 <span class="stringliteral">    </span>
<a name="l01804"></a>01804 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l01805"></a>01805         
<a name="l01806"></a>01806         <span class="keywordflow">if</span> type(name) != str:
<a name="l01807"></a>01807             <span class="keywordflow">return</span> <span class="keyword">False</span>
<a name="l01808"></a>01808         
<a name="l01809"></a>01809         <span class="keywordflow">return</span> re.match(<span class="stringliteral">&#39;^[a-zA-Z_][-\w]*$&#39;</span>, name)
<a name="l01810"></a>01810          
<a name="l01811"></a>01811     
<a name="l01812"></a>01812     @staticmethod
<a name="l01813"></a><a class="code" href="classgp_1_1client_1_1_connection.html#ab387db6a8fc080f59c18e4ad74390ed4">01813</a>     <span class="keyword">def </span><a class="code" href="classgp_1_1client_1_1_connection.html#ab387db6a8fc080f59c18e4ad74390ed4">isValidCommandString</a>(command): <span class="comment">#static # fast OK</span>
<a name="l01814"></a>01814         <span class="stringliteral">&quot;&quot;&quot;Check if the given string passes some sanity checks.</span>
<a name="l01815"></a>01815 <span class="stringliteral"></span>
<a name="l01816"></a>01816 <span class="stringliteral">        The command string must start with a valid command, and it must not</span>
<a name="l01817"></a>01817 <span class="stringliteral">        contain any non-printable or non-ascii characters.</span>
<a name="l01818"></a>01818 <span class="stringliteral">    </span>
<a name="l01819"></a>01819 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l01820"></a>01820         
<a name="l01821"></a>01821         <span class="keywordflow">if</span> type(command) != str:
<a name="l01822"></a>01822             <span class="keywordflow">return</span> <span class="keyword">False</span>
<a name="l01823"></a>01823         
<a name="l01824"></a>01824         <span class="keywordflow">if</span> <span class="keywordflow">not</span> re.match(<span class="stringliteral">&#39;^[a-zA-Z_][-\w]*\s*(:?\s*$|[\s!&amp;]+\w|[|&lt;&gt;#])&#39;</span>, command):
<a name="l01825"></a>01825             <span class="keywordflow">return</span> <span class="keyword">False</span>        <span class="comment"># must start with a valid command</span>
<a name="l01826"></a>01826             
<a name="l01827"></a>01827         <span class="keywordflow">if</span> re.search(<span class="stringliteral">&#39;[\0-\x1F\x80-\xFF]&#39;</span>, command):
<a name="l01828"></a>01828             <span class="keywordflow">return</span> <span class="keyword">False</span>        <span class="comment"># bad characters</span>
<a name="l01829"></a>01829 
<a name="l01830"></a>01830         <span class="keywordflow">return</span> <span class="keyword">True</span>
<a name="l01831"></a>01831          
<a name="l01832"></a>01832     
<a name="l01833"></a>01833     @staticmethod
<a name="l01834"></a><a class="code" href="classgp_1_1client_1_1_connection.html#a3839687882c911705dfe3e98ad77554e">01834</a>     <span class="keyword">def </span><a class="code" href="classgp_1_1client_1_1_connection.html#a3839687882c911705dfe3e98ad77554e">isValidCommandArgument</a>(arg, strict=True): <span class="comment">#static #OK</span>
<a name="l01835"></a>01835         <span class="stringliteral">&quot;&quot;&quot; Check if the given string is a valid argument.</span>
<a name="l01836"></a>01836 <span class="stringliteral"></span>
<a name="l01837"></a>01837 <span class="stringliteral">        If strict is set, it checks if arg consists of an alphanumeric</span>
<a name="l01838"></a>01838 <span class="stringliteral">        character followed by any number of alphanumerics, colons or dashes.</span>
<a name="l01839"></a>01839 <span class="stringliteral">        If strict is not set, this just checks that arg doesn&#39;t contain</span>
<a name="l01840"></a>01840 <span class="stringliteral">        any non-printable or non-ascii characters.</span>
<a name="l01841"></a>01841 <span class="stringliteral">     </span>
<a name="l01842"></a>01842 <span class="stringliteral">        @param string arg the argument to check</span>
<a name="l01843"></a>01843 <span class="stringliteral">        @param bool strict whether to perform a strict check (default: True).</span>
<a name="l01844"></a>01844 <span class="stringliteral">    </span>
<a name="l01845"></a>01845 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l01846"></a>01846         
<a name="l01847"></a>01847         <span class="keywordflow">if</span> <span class="keywordflow">not</span> arg:
<a name="l01848"></a>01848             <span class="keywordflow">return</span> <span class="keyword">False</span>
<a name="l01849"></a>01849         
<a name="l01850"></a>01850         <span class="keywordflow">if</span> <span class="keywordflow">not</span> type(arg) <span class="keywordflow">in</span> (str, unicode, int, long):
<a name="l01851"></a>01851             <span class="keywordflow">return</span> <span class="keyword">False</span>
<a name="l01852"></a>01852         
<a name="l01853"></a>01853         <span class="keywordflow">if</span> strict:
<a name="l01854"></a>01854             <span class="keywordflow">return</span> re.match(<span class="stringliteral">&#39;^\w[-\w]*$&#39;</span>, str(arg))
<a name="l01855"></a>01855         <span class="keywordflow">else</span>:
<a name="l01856"></a>01856             <span class="keywordflow">return</span> <span class="keywordflow">not</span> re.search(<span class="stringliteral">&#39;[\s\0-\x1F\x80-\xFF|&lt;&gt;!&amp;#]&#39;</span>, str(arg))
<a name="l01857"></a>01857             <span class="comment"># low chars, high chars, and operators.</span>
<a name="l01858"></a>01858     
<a name="l01859"></a>01859     @staticmethod
<a name="l01860"></a><a class="code" href="classgp_1_1client_1_1_connection.html#ae35b0ccd3bef1730bba1fcdbc3ef7d24">01860</a>     <span class="keyword">def </span><a class="code" href="classgp_1_1client_1_1_connection.html#ae35b0ccd3bef1730bba1fcdbc3ef7d24">splitRow</a>(s):
<a name="l01861"></a>01861         <span class="stringliteral">&quot;&quot;&quot;Convert a line from a data set into a tuple.</span>
<a name="l01862"></a>01862 <span class="stringliteral">    </span>
<a name="l01863"></a>01863 <span class="stringliteral">        If s is empty, this method returns False. if s starts with &quot;#&quot;, it&#39;s</span>
<a name="l01864"></a>01864 <span class="stringliteral">        considered to consist of a single string field. Otherwise, the</span>
<a name="l01865"></a>01865 <span class="stringliteral">        string is split on ocurrances of TAB, semikolon or comma. Numeric</span>
<a name="l01866"></a>01866 <span class="stringliteral">        field values are converted to int, other fields remain strings.</span>
<a name="l01867"></a>01867 <span class="stringliteral">         </span>
<a name="l01868"></a>01868 <span class="stringliteral">        @param string s the row from the data set, as a string</span>
<a name="l01869"></a>01869 <span class="stringliteral">        @return array containing the fields in s, or false if s is empty.</span>
<a name="l01870"></a>01870 <span class="stringliteral">        </span>
<a name="l01871"></a>01871 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l01872"></a>01872         <span class="keywordflow">if</span> <span class="keywordflow">not</span> s:
<a name="l01873"></a>01873             <span class="keywordflow">return</span> <span class="keyword">False</span>
<a name="l01874"></a>01874         <span class="keywordflow">if</span> s[0] == <span class="stringliteral">&#39;#&#39;</span>:
<a name="l01875"></a>01875             row = (s[1],) <span class="comment">#full line string text</span>
<a name="l01876"></a>01876         <span class="keywordflow">else</span>:
<a name="l01877"></a>01877             row = re.split(<span class="stringliteral">&#39; *[;,\t] *&#39;</span>, s)
<a name="l01878"></a>01878             
<a name="l01879"></a>01879             <span class="keywordflow">for</span> i, entry <span class="keywordflow">in</span> enumerate(row):
<a name="l01880"></a>01880                 <span class="keywordflow">if</span> re.match(<span class="stringliteral">&#39;^\d{1,9}$&#39;</span>, entry): <span class="comment">#TODO: port to python: no more than 9 chars for int conversion!</span>
<a name="l01881"></a>01881                     row[i] = int(entry)
<a name="l01882"></a>01882                     
<a name="l01883"></a>01883             row = tuple(row)
<a name="l01884"></a>01884             
<a name="l01885"></a>01885         <span class="keywordflow">return</span> row
<a name="l01886"></a>01886     
<a name="l01887"></a>01887     @staticmethod
<a name="l01888"></a><a class="code" href="classgp_1_1client_1_1_connection.html#ac311cc1784a22bd6a5c788fd68bc2911">01888</a>     <span class="keyword">def </span><a class="code" href="classgp_1_1client_1_1_connection.html#ac311cc1784a22bd6a5c788fd68bc2911">joinRow</a>(row): <span class="comment"># fertig.</span>
<a name="l01889"></a>01889         <span class="stringliteral">&quot;&quot;&quot;Create a string representing the data set `row&#39;.</span>
<a name="l01890"></a>01890 <span class="stringliteral">        </span>
<a name="l01891"></a>01891 <span class="stringliteral">        joinRow tries to convert `row&#39; to a reasonable string</span>
<a name="l01892"></a>01892 <span class="stringliteral">        representation. Numbers can be passed either as int or as str</span>
<a name="l01893"></a>01893 <span class="stringliteral">        types. If a string is passed or the list/tuple has only one</span>
<a name="l01894"></a>01894 <span class="stringliteral">        string which represents no number, this string will be marked</span>
<a name="l01895"></a>01895 <span class="stringliteral">        with a leading `#&#39; and then be returned.</span>
<a name="l01896"></a>01896 <span class="stringliteral">        </span>
<a name="l01897"></a>01897 <span class="stringliteral">        If `row&#39; is a tulple/list containing str or int types, those</span>
<a name="l01898"></a>01898 <span class="stringliteral">        will be returned as comma seperated values.</span>
<a name="l01899"></a>01899 <span class="stringliteral">        </span>
<a name="l01900"></a>01900 <span class="stringliteral">        @type row:  str, or list/tuple of int/str types</span>
<a name="l01901"></a>01901 <span class="stringliteral">        @param row: The data row</span>
<a name="l01902"></a>01902 <span class="stringliteral">        @rtype:  str</span>
<a name="l01903"></a>01903 <span class="stringliteral">        @return: string containing the fields from row</span>
<a name="l01904"></a>01904 <span class="stringliteral">        </span>
<a name="l01905"></a>01905 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l01906"></a>01906         <span class="comment">#if not row:</span>
<a name="l01907"></a>01907         <span class="comment">#    return &#39;&#39; #? This case is covered by join(...).</span>
<a name="l01908"></a>01908         <span class="keywordflow">if</span> isinstance(row, str):
<a name="l01909"></a>01909             <span class="keywordflow">return</span> <span class="stringliteral">&#39;#&#39;</span> + row
<a name="l01910"></a>01910         <span class="keywordflow">if</span> len(row) == 1 <span class="keywordflow">and</span> isinstance(row[0], str) <span class="keywordflow">and</span> \
<a name="l01911"></a>01911           <span class="keywordflow">not</span> re.match(<span class="stringliteral">&#39;^\d+$&#39;</span>, row[0]):
<a name="l01912"></a>01912             <span class="keywordflow">return</span> <span class="stringliteral">&#39;#&#39;</span> + row[0]
<a name="l01913"></a>01913         <span class="keywordflow">try</span>:
<a name="l01914"></a>01914             s = <span class="stringliteral">&#39;,&#39;</span>.join(<span class="stringliteral">&quot;%s&quot;</span> % el <span class="keywordflow">for</span> el <span class="keywordflow">in</span> row)
<a name="l01915"></a>01915         <span class="keywordflow">except</span>:
<a name="l01916"></a>01916             <span class="comment">#print row</span>
<a name="l01917"></a>01917             <span class="keywordflow">raise</span>
<a name="l01918"></a>01918         <span class="keywordflow">return</span> s
<a name="l01919"></a>01919     
<a name="l01920"></a>01920     <span class="keyword">def </span>_copyFromSource(self, source, row_munger = None):
<a name="l01921"></a>01921         <span class="stringliteral">&quot;&quot;&quot;Pass data from source to client line by line.</span>
<a name="l01922"></a>01922 <span class="stringliteral">    </span>
<a name="l01923"></a>01923 <span class="stringliteral">        Copies all data from the given source into the current command stream,</span>
<a name="l01924"></a>01924 <span class="stringliteral">        that is, passes them to the client line by line. </span>
<a name="l01925"></a>01925 <span class="stringliteral">         </span>
<a name="l01926"></a>01926 <span class="stringliteral">        Note that this must only be called after passing a command line</span>
<a name="l01927"></a>01927 <span class="stringliteral">        terminated by &quot;:&quot; to the peer, so the peer expects a data set.</span>
<a name="l01928"></a>01928 <span class="stringliteral">        </span>
<a name="l01929"></a>01929 <span class="stringliteral">        This is implemented by calling the transport&#39;s make_sink() method</span>
<a name="l01930"></a>01930 <span class="stringliteral">        to create a sink for writing to the command stream, and then using</span>
<a name="l01931"></a>01931 <span class="stringliteral">        the copy() method to transfer the data.</span>
<a name="l01932"></a>01932 <span class="stringliteral">        </span>
<a name="l01933"></a>01933 <span class="stringliteral">        Note that source is not automatically closed by this method.</span>
<a name="l01934"></a>01934 <span class="stringliteral">        </span>
<a name="l01935"></a>01935 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l01936"></a>01936         sink = self.transport.make_sink()
<a name="l01937"></a>01937         self.<a class="code" href="classgp_1_1client_1_1_connection.html#a30cef28b85543ed877f941d2598df768">_trace</a>(__function__(), <span class="stringliteral">&quot;source&quot;</span>, type(source))
<a name="l01938"></a>01938         self.<a class="code" href="classgp_1_1client_1_1_connection.html#a123b6b02cb3614083fca1bc82df41d3e">copy</a>(source, sink, <span class="stringliteral">&#39; &gt; &#39;</span>, row_munger = row_munger)
<a name="l01939"></a>01939         <span class="comment"># source.close()        # to close or not to close...</span>
<a name="l01940"></a>01940         self.transport.send( LINEBREAK )     <span class="comment">#XXX: flush again??</span>
<a name="l01941"></a>01941         self.<a class="code" href="classgp_1_1client_1_1_connection.html#a30cef28b85543ed877f941d2598df768">_trace</a>(__function__(), <span class="stringliteral">&quot;copy complete.&quot;</span>)
<a name="l01942"></a>01942         
<a name="l01943"></a>01943         <span class="comment"># #</span>
<a name="l01944"></a>01944         <span class="comment"># while ( $row = $source-&gt;nextRow() )  </span>
<a name="l01945"></a>01945             <span class="comment"># $s = Connection::joinRow( $row );</span>
<a name="l01946"></a>01946             <span class="comment"># </span>
<a name="l01947"></a>01947             <span class="comment"># fputs(self.hout, $s . LINEBREAK);</span>
<a name="l01948"></a>01948             <span class="comment">#  </span>
<a name="l01949"></a>01949         <span class="comment"># </span>
<a name="l01950"></a>01950         <span class="comment"># fputs(self.hout, LINEBREAK); // blank line</span>
<a name="l01951"></a>01951         
<a name="l01952"></a>01952          
<a name="l01953"></a>01953     
<a name="l01954"></a>01954     <span class="keyword">def </span>_copyToSink(self, sink=None, row_munger = None):
<a name="l01955"></a>01955         <span class="stringliteral">&quot;&quot;&quot;Pass data from peer to sink line by line.</span>
<a name="l01956"></a>01956 <span class="stringliteral">    </span>
<a name="l01957"></a>01957 <span class="stringliteral">        Copies all data from the command response into the given sink,</span>
<a name="l01958"></a>01958 <span class="stringliteral">        that is, receives data from the peer line by line. </span>
<a name="l01959"></a>01959 <span class="stringliteral">        </span>
<a name="l01960"></a>01960 <span class="stringliteral">        Note that this must only be called after the peer sent a response</span>
<a name="l01961"></a>01961 <span class="stringliteral">        line that endes with &quot;:&quot;, so we know the peer is waiting to send a</span>
<a name="l01962"></a>01962 <span class="stringliteral">        data set.</span>
<a name="l01963"></a>01963 <span class="stringliteral">        </span>
<a name="l01964"></a>01964 <span class="stringliteral">        This is implemented by calling the transport&#39;s make_source() method</span>
<a name="l01965"></a>01965 <span class="stringliteral">        to create a source for reading from the command stream, and then</span>
<a name="l01966"></a>01966 <span class="stringliteral">        using the copy() method to transfer the data.</span>
<a name="l01967"></a>01967 <span class="stringliteral">        </span>
<a name="l01968"></a>01968 <span class="stringliteral">        Note that sink is flushed but not closed before this method returns.</span>
<a name="l01969"></a>01969 <span class="stringliteral">        </span>
<a name="l01970"></a>01970 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l01971"></a>01971         source = self.transport.make_source()
<a name="l01972"></a>01972         self.<a class="code" href="classgp_1_1client_1_1_connection.html#a30cef28b85543ed877f941d2598df768">_trace</a>(__function__(), <span class="stringliteral">&quot;sink&quot;</span>, type(sink))
<a name="l01973"></a>01973         self.<a class="code" href="classgp_1_1client_1_1_connection.html#a123b6b02cb3614083fca1bc82df41d3e">copy</a>(source, sink, <span class="stringliteral">&#39; &lt; &#39;</span>, row_munger = row_munger )
<a name="l01974"></a>01974         self.<a class="code" href="classgp_1_1client_1_1_connection.html#a30cef28b85543ed877f941d2598df768">_trace</a>(__function__(), <span class="stringliteral">&quot;copy complete.&quot;</span>)
<a name="l01975"></a>01975         <span class="comment"># $source-&gt;close();     # to close or not to close...</span>
<a name="l01976"></a>01976         
<a name="l01977"></a>01977         <span class="comment"># #</span>
<a name="l01978"></a>01978         <span class="comment"># while ( $s = fgets(self.hin) )  </span>
<a name="l01979"></a>01979             <span class="comment"># $s = trim($s);</span>
<a name="l01980"></a>01980             <span class="comment"># if ( $s === &#39;&#39; ) break;</span>
<a name="l01981"></a>01981             <span class="comment"># </span>
<a name="l01982"></a>01982             <span class="comment"># $row = Connection::splitRow( $s );</span>
<a name="l01983"></a>01983             <span class="comment"># </span>
<a name="l01984"></a>01984             <span class="comment"># if ( $sink )  </span>
<a name="l01985"></a>01985                 <span class="comment"># $sink-&gt;putRow( $row );</span>
<a name="l01986"></a>01986                 <span class="comment">#  </span>
<a name="l01987"></a>01987         
<a name="l01988"></a><a class="code" href="classgp_1_1client_1_1_connection.html#a123b6b02cb3614083fca1bc82df41d3e">01988</a>     <span class="keyword">def </span><a class="code" href="classgp_1_1client_1_1_connection.html#a123b6b02cb3614083fca1bc82df41d3e">copy</a>(self, source, sink=None, indicator = &#39;&lt;&gt;&#39;, row_munger = None): <span class="comment">#OK</span>
<a name="l01989"></a>01989         <span class="stringliteral">&quot;&quot;&quot;Transfer all rows from a data source to a data sink.</span>
<a name="l01990"></a>01990 <span class="stringliteral"></span>
<a name="l01991"></a>01991 <span class="stringliteral">        Utility method. If sink is None, all rows are read from the</span>
<a name="l01992"></a>01992 <span class="stringliteral">        source and then discarded.</span>
<a name="l01993"></a>01993 <span class="stringliteral">        Before returning, the sink is flushed to commit any pending data.</span>
<a name="l01994"></a>01994 <span class="stringliteral">    </span>
<a name="l01995"></a>01995 <span class="stringliteral">        @type source:  DataSource</span>
<a name="l01996"></a>01996 <span class="stringliteral">        @param source: source of the data rows</span>
<a name="l01997"></a>01997 <span class="stringliteral">        @type sink:  DataSink</span>
<a name="l01998"></a>01998 <span class="stringliteral">        @param sink: sink where the rows are transferred to.</span>
<a name="l01999"></a>01999 <span class="stringliteral">        @type indicator:  str</span>
<a name="l02000"></a>02000 <span class="stringliteral">        @param indicator: the message prefix to show in debug-mode</span>
<a name="l02001"></a>02001 <span class="stringliteral">        @param row_munger: a callback function to be invoked for every row copied.</span>
<a name="l02002"></a>02002 <span class="stringliteral">               the return value from the munger replaces the original row.</span>
<a name="l02003"></a>02003 <span class="stringliteral">               If the munger function returns None or False, the row is skipped.</span>
<a name="l02004"></a>02004 <span class="stringliteral">        </span>
<a name="l02005"></a>02005 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l02006"></a>02006         <span class="keywordflow">for</span> row <span class="keywordflow">in</span> source:
<a name="l02007"></a>02007             <span class="keywordflow">if</span> row_munger: <span class="comment">#TODO: PORT TO PHP</span>
<a name="l02008"></a>02008                 row = row_munger(row)
<a name="l02009"></a>02009                 
<a name="l02010"></a>02010                 <span class="keywordflow">if</span> <span class="keywordflow">not</span> row:
<a name="l02011"></a>02011                     <span class="keywordflow">continue</span>
<a name="l02012"></a>02012                 
<a name="l02013"></a>02013             <span class="keywordflow">if</span> sink:
<a name="l02014"></a>02014                 self.<a class="code" href="classgp_1_1client_1_1_connection.html#a30cef28b85543ed877f941d2598df768">_trace</a>(__name__, indicator, row)
<a name="l02015"></a>02015                 sink.putRow(row)
<a name="l02016"></a>02016             <span class="keywordflow">else</span>:
<a name="l02017"></a>02017                 self.<a class="code" href="classgp_1_1client_1_1_connection.html#a30cef28b85543ed877f941d2598df768">_trace</a>(Connection.copy, <span class="stringliteral">&quot;#&quot;</span>, row)
<a name="l02018"></a>02018                 
<a name="l02019"></a>02019         <span class="keywordflow">if</span> ( sink ):
<a name="l02020"></a>02020             sink.flush()
<a name="l02021"></a>02021     
<a name="l02022"></a><a class="code" href="classgp_1_1client_1_1_connection.html#ae5dd97c42ec5ba28939d396ee467c604">02022</a>     <span class="keyword">def </span><a class="code" href="classgp_1_1client_1_1_connection.html#ae5dd97c42ec5ba28939d396ee467c604">close</a>(self): <span class="comment">#OK</span>
<a name="l02023"></a>02023         <span class="stringliteral">&quot;&quot;&quot;Closes this connection by closing the underlying transport.&quot;&quot;&quot;</span>
<a name="l02024"></a>02024         self.transport.close()
<a name="l02025"></a>02025 
<a name="l02026"></a>02026     @staticmethod
<a name="l02027"></a><a class="code" href="classgp_1_1client_1_1_connection.html#a8cefe2637d419c20355de7d331b91d33">02027</a>     <span class="keyword">def </span><a class="code" href="classgp_1_1client_1_1_connection.html#a8cefe2637d419c20355de7d331b91d33">new_client_connection</a>(graphname, host=False, port=False): <span class="comment"># static #OK</span>
<a name="l02028"></a>02028         <span class="stringliteral">&quot;&quot;&quot;Return a new ClientTransport connection.</span>
<a name="l02029"></a>02029 <span class="stringliteral">        </span>
<a name="l02030"></a>02030 <span class="stringliteral">        Create a new connection for accessing a remote graph</span>
<a name="l02031"></a>02031 <span class="stringliteral">        managed by a GraphServ service. Returns a Connection</span>
<a name="l02032"></a>02032 <span class="stringliteral">        that uses a ClientTransport to talk to the remote graph.</span>
<a name="l02033"></a>02033 <span class="stringliteral">     </span>
<a name="l02034"></a>02034 <span class="stringliteral">        @param string graphname the name of the graph to connect to</span>
<a name="l02035"></a>02035 <span class="stringliteral">        @param string host (default: &#39;localhost&#39;) the host the</span>
<a name="l02036"></a>02036 <span class="stringliteral">        GraphServ process is located on.</span>
<a name="l02037"></a>02037 <span class="stringliteral">        @param int port (default: PORT) the TCP port the</span>
<a name="l02038"></a>02038 <span class="stringliteral">        GraphServ process is listening on.</span>
<a name="l02039"></a>02039 <span class="stringliteral">    </span>
<a name="l02040"></a>02040 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l02041"></a>02041         conn = <a class="code" href="classgp_1_1client_1_1_connection.html">Connection</a>( <a class="code" href="classgp_1_1client_1_1_client_transport.html">ClientTransport</a>(host, port), graphname ) <span class="comment">#FIXME: PORT graphname stuff to PHP!</span>
<a name="l02042"></a>02042         
<a name="l02043"></a>02043         <span class="keywordflow">return</span> conn
<a name="l02044"></a>02044     
<a name="l02045"></a>02045     @staticmethod
<a name="l02046"></a><a class="code" href="classgp_1_1client_1_1_connection.html#a41883866817011f0058f6ff130135450">02046</a>     <span class="keyword">def </span><a class="code" href="classgp_1_1client_1_1_connection.html#a41883866817011f0058f6ff130135450">new_slave_connection</a>(command, cwd=None, env=None): <span class="comment">#static #OK</span>
<a name="l02047"></a>02047         <span class="stringliteral">&quot;&quot;&quot;Return a new SlaveTransport connection.</span>
<a name="l02048"></a>02048 <span class="stringliteral">        </span>
<a name="l02049"></a>02049 <span class="stringliteral">        Create a new connection for accessing a graph managed by a </span>
<a name="l02050"></a>02050 <span class="stringliteral">        slave GraphCore process. Returns a Connection that uses a </span>
<a name="l02051"></a>02051 <span class="stringliteral">        SlaveTransport to talk to the local graph.</span>
<a name="l02052"></a>02052 <span class="stringliteral">     </span>
<a name="l02053"></a>02053 <span class="stringliteral">        @param mixed command the command line to start GraphCore.</span>
<a name="l02054"></a>02054 <span class="stringliteral">               May be given as a string or as an array.</span>
<a name="l02055"></a>02055 <span class="stringliteral">               If given as a string, all parameters must be duely</span>
<a name="l02056"></a>02056 <span class="stringliteral">               escaped #?. If given as an array, command[0] must be</span>
<a name="l02057"></a>02057 <span class="stringliteral">               the path to the GraphCore executable.</span>
<a name="l02058"></a>02058 <span class="stringliteral">               See Slavetransport.makeCommand() for more details.</span>
<a name="l02059"></a>02059 <span class="stringliteral">        @param string cwd (default: None) the working dir to run</span>
<a name="l02060"></a>02060 <span class="stringliteral">               the slave process in. Defaults to the current working directory.</span>
<a name="l02061"></a>02061 <span class="stringliteral">        @param int env (default: None) the environment variables</span>
<a name="l02062"></a>02062 <span class="stringliteral">               to pass to the slave process. Defaults to inheriting</span>
<a name="l02063"></a>02063 <span class="stringliteral">               the PHP script&#39;s environment.</span>
<a name="l02064"></a>02064 <span class="stringliteral">    </span>
<a name="l02065"></a>02065 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l02066"></a>02066         <span class="keywordflow">return</span> <a class="code" href="classgp_1_1client_1_1_connection.html">Connection</a>(<a class="code" href="classgp_1_1client_1_1_slave_transport.html">SlaveTransport</a>(command, cwd, env))
<a name="l02067"></a>02067 
<a name="l02068"></a><a class="code" href="namespacegp_1_1client.html#a3c6bb5a4a06c3307a32bbef405da585b">02068</a> <span class="keyword">def </span><a class="code" href="namespacegp_1_1client.html#a3c6bb5a4a06c3307a32bbef405da585b">array_column</a>(a, col):
<a name="l02069"></a>02069     <span class="stringliteral">&quot;&quot;&quot;Extracts a column from a tabular structure</span>
<a name="l02070"></a>02070 <span class="stringliteral"> </span>
<a name="l02071"></a>02071 <span class="stringliteral">    @type a:  list/tuple</span>
<a name="l02072"></a>02072 <span class="stringliteral">    @param a: an array of equal-sized arrays, representing</span>
<a name="l02073"></a>02073 <span class="stringliteral">              a table as a list of rows.</span>
<a name="l02074"></a>02074 <span class="stringliteral">    @type col:  usually int or str</span>
<a name="l02075"></a>02075 <span class="stringliteral">    @param col: the column key of the column to extract</span>
<a name="l02076"></a>02076 <span class="stringliteral"></span>
<a name="l02077"></a>02077 <span class="stringliteral">    @rtype:  list</span>
<a name="l02078"></a>02078 <span class="stringliteral">    @return: the values of column col from each row in a</span>
<a name="l02079"></a>02079 <span class="stringliteral"></span>
<a name="l02080"></a>02080 <span class="stringliteral">    &quot;&quot;&quot;</span>
<a name="l02081"></a>02081     column = []
<a name="l02082"></a>02082     
<a name="l02083"></a>02083     <span class="keywordflow">for</span> r <span class="keywordflow">in</span> a:
<a name="l02084"></a>02084         column.append( r[col] )
<a name="l02085"></a>02085     
<a name="l02086"></a>02086     <span class="keywordflow">return</span> column
<a name="l02087"></a>02087 
<a name="l02088"></a><a class="code" href="namespacegp_1_1client.html#a93b2c77961a74a0c938f0bed8a20965b">02088</a> <span class="keyword">def </span><a class="code" href="namespacegp_1_1client.html#a93b2c77961a74a0c938f0bed8a20965b">pairs2map</a>( pairs, key_col=0, value_col=1):
<a name="l02089"></a>02089     <span class="stringliteral">&quot;&quot;&quot;Converts a list of key value pairs to a dictionary.</span>
<a name="l02090"></a>02090 <span class="stringliteral"></span>
<a name="l02091"></a>02091 <span class="stringliteral">    @type pairs:  array</span>
<a name="l02092"></a>02092 <span class="stringliteral">    @param pairs: an array of key value paris,</span>
<a name="l02093"></a>02093 <span class="stringliteral">                  representing a map as a list of tuples.</span>
<a name="l02094"></a>02094 <span class="stringliteral">    @type key_col:  mixed</span>
<a name="l02095"></a>02095 <span class="stringliteral">    @param key_col: the column that contains the key (default: 0)</span>
<a name="l02096"></a>02096 <span class="stringliteral">    @type value_col:  mixed</span>
<a name="l02097"></a>02097 <span class="stringliteral">    @param value_col: the column that contains the value (default: 1)</span>
<a name="l02098"></a>02098 <span class="stringliteral"></span>
<a name="l02099"></a>02099 <span class="stringliteral">    @rtype:  dictionary</span>
<a name="l02100"></a>02100 <span class="stringliteral">    @return: the key value pairs in pairs.</span>
<a name="l02101"></a>02101 <span class="stringliteral"></span>
<a name="l02102"></a>02102 <span class="stringliteral">    &quot;&quot;&quot;</span>
<a name="l02103"></a>02103     
<a name="l02104"></a>02104     m = {}
<a name="l02105"></a>02105     <span class="keywordflow">for</span> p <span class="keywordflow">in</span> pairs:
<a name="l02106"></a>02106         k = p[key_col]
<a name="l02107"></a>02107         m[ k ] = p[value_col]
<a name="l02108"></a>02108         
<a name="l02109"></a>02109     <span class="keywordflow">return</span> m
<a name="l02110"></a>02110      
<a name="l02111"></a>02111 <span class="keyword">def </span>escapeshellcmd(command):
<a name="l02112"></a>02112     <span class="keywordflow">return</span> <span class="stringliteral">&#39;&quot;%s&quot;&#39;</span> % (
<a name="l02113"></a>02113         command
<a name="l02114"></a>02114         .replace(<span class="stringliteral">&#39;#&#39;</span>, <span class="stringliteral">&#39;\#&#39;</span>)
<a name="l02115"></a>02115         .replace(<span class="stringliteral">&#39;&amp;&#39;</span>, <span class="stringliteral">&#39;\&amp;&#39;</span>)
<a name="l02116"></a>02116         .replace(<span class="stringliteral">&#39;;&#39;</span>, <span class="stringliteral">&#39;\.&#39;</span>)
<a name="l02117"></a>02117         .replace(<span class="stringliteral">&#39;`&#39;</span>, <span class="stringliteral">&#39;\`&#39;</span>)
<a name="l02118"></a>02118         .replace(<span class="stringliteral">&#39;|&#39;</span>, <span class="stringliteral">&#39;\|&#39;</span>)
<a name="l02119"></a>02119         .replace(<span class="stringliteral">&#39;*&#39;</span>, <span class="stringliteral">&#39;\*&#39;</span>)
<a name="l02120"></a>02120         .replace(<span class="stringliteral">&#39;~&#39;</span>, <span class="stringliteral">&#39;\~&#39;</span>)
<a name="l02121"></a>02121         .replace(<span class="stringliteral">&#39;&lt;&#39;</span>, <span class="stringliteral">&#39;&lt;&#39;</span>)
<a name="l02122"></a>02122         .replace(<span class="stringliteral">&#39;&gt;&#39;</span>, <span class="stringliteral">&#39;&gt;&#39;</span>)
<a name="l02123"></a>02123         .replace(<span class="stringliteral">&#39;^&#39;</span>, <span class="stringliteral">&#39;\^&#39;</span>)
<a name="l02124"></a>02124         .replace(<span class="stringliteral">&#39;(&#39;</span>, <span class="stringliteral">&#39;\(&#39;</span>)
<a name="l02125"></a>02125         .replace(<span class="stringliteral">&#39;)&#39;</span>, <span class="stringliteral">&#39;\)&#39;</span>)
<a name="l02126"></a>02126         .replace(<span class="stringliteral">&#39;[&#39;</span>, <span class="stringliteral">&#39;\[&#39;</span>)
<a name="l02127"></a>02127         .replace(<span class="stringliteral">&#39;]&#39;</span>, <span class="stringliteral">&#39;\]&#39;</span>)
<a name="l02128"></a>02128         .replace(<span class="stringliteral">&#39;{&#39;</span>, <span class="stringliteral">&#39;\{&#39;</span>)
<a name="l02129"></a>02129         .replace(<span class="stringliteral">&#39;}&#39;</span>, <span class="stringliteral">&#39;\}&#39;</span>)
<a name="l02130"></a>02130         .replace(<span class="stringliteral">&#39;$&#39;</span>, <span class="stringliteral">&#39;\$&#39;</span>)
<a name="l02131"></a>02131         .replace(<span class="stringliteral">&#39;,&#39;</span>, <span class="stringliteral">&#39;\,&#39;</span>)
<a name="l02132"></a>02132         .replace(<span class="stringliteral">&#39;\&#39;&#39;</span>, <span class="stringliteral">&#39;\\\&#39;&#39;</span>)
<a name="l02133"></a>02133         .replace(<span class="stringliteral">&#39;\&quot;&#39;</span>, <span class="stringliteral">&#39;\\&quot;&#39;</span>)
<a name="l02134"></a>02134     )
<a name="l02135"></a>02135 <span class="keyword">def </span>escapeshellarg(arg):
<a name="l02136"></a>02136    <span class="keywordflow">return</span> <span class="stringliteral">&#39;\&#39;&#39;</span> + arg.replace(<span class="stringliteral">&#39;\&#39;&#39;</span>, <span class="stringliteral">&#39;\&#39;&#39;</span> + <span class="stringliteral">&#39;\\&#39;</span> + <span class="stringliteral">&#39;\&#39;&#39;</span> + <span class="stringliteral">&#39;\&#39;&#39;</span>) + <span class="stringliteral">&#39;\&#39;&#39;</span>
</pre></div></div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><b>client.py</b>      </li>

    <li class="footer">Generated on Wed Sep 12 2012 13:00:17 for Task List Generator Backend by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
